/**
 * Noticeable JavaScript SDK - Every change matters.
 *
 * @author Noticeable Team (https://noticeable.io)
 * @date Thu Mar 28 2024 06:45:45 GMT+0000 (Coordinated Universal Time)
 * @version 3.2.1 (commit ef6a5a4)
 *
 * Copyright (c) 2017-2024 Noticeable 
 */
!function(){function e(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function t(t){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?e(Object(r),!0).forEach((function(e){n(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):e(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function i(e){var t=function(e,t){if('object'!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var n=i.call(e,t||'default');if('object'!=typeof n)return n;throw new TypeError('@@toPrimitive must return a primitive value.')}return('string'===t?String:Number)(e)}(e,'string');return'symbol'==typeof t?t:t+''}function n(e,t,n){return(t=i(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let r=function(e){return e.PLAN_UPGRADE_REQUIRED='plan-upgrade-required',e.PROJECT_DATA_MISSING='project-data-missing',e.WIDGET_ALREADY_RENDERED='widget-already-rendered',e.WIDGET_DATA_MISSING='widget-data-missing',e.WIDGET_DISABLED='widget-disabled',e.WIDGET_DISABLED_MOBILE='widget-disabled-mobile',e}({});function o(e){throw new Error(e)}let a=function(e){return e.WIDGET_CLOSED='widget:closed',e.WIDGET_HIDDEN='widget:hidden',e.WIDGET_HEADER_LINK_CLICKED='widget:header:link:clicked',e.WIDGET_NOTIFICATION_EMAIL_SUBSCRIBED='widget:notification:email:subscribed',e.WIDGET_NOTIFICATION_PUSH_SUBSCRIBED='widget:notification:push:subscribed',e.WIDGET_OPENED='widget:opened',e.WIDGET_PUBLICATION_COMMENT_CREATED='widget:publication:comment:created',e.WIDGET_PUBLICATION_REACTION_CREATED='widget:publication:reaction:created',e.WIDGET_PUBLICATION_REACTION_UPDATED='widget:publication:reaction:updated',e.WIDGET_PUBLICATION_SUMMARY_CLICKED='widget:publication_summary:clicked',e.WIDGET_PUBLICATION_UNREAD_COUNT_CHANGED='widget:publication:unread_count:changed',e.WIDGET_PUBLICATION_UNSEEN_COUNT_CHANGED='widget:publication:unseen_count:changed',e.WIDGET_READY='widget:ready',e.WIDGET_REFRESHED='widget:refreshed',e.WIDGET_RENDERING_ABORTED='widget:rendering:aborted',e.WIDGET_TRIGGER_READY='widget:trigger:ready',e.WIDGET_TRIGGER_REFRESHED='widget:trigger:refreshed',e.WIDGET_TRIGGER_VIEW_CLICKED='widget:trigger_view:clicked',e.WIDGET_TRIGGER_VIEW_MOUSE_ENTERED='widget:trigger_view:mouse_entered',e.WIDGET_TRIGGER_VIEW_MOUSE_LEFT='widget:trigger_view:mouse_left',e.WIDGET_VISIBLE='widget:visible',e.WIDGET_WIDGET_VIEW_MOUSE_ENTERED='widget:widget_view:mouse_entered',e.WIDGET_WIDGET_VIEW_MOUSE_LEFT='widget:widget_view:mouse_left',e}({});class s{constructor(){n(this,'_listeners',void 0),this._listeners=new Map}static _checkEventSupported(e){Object.values(a).includes(e)||o('Unknown event name: '+e)}dispatchEvent(e,t,i){const n=this._listeners.get(e);if(!n)return;const r=n.get(t);r&&r({detail:i,resourceId:e,type:t})}hasListener(e){const t=this._listeners.get(e);if(!t)return!1;for(var i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];for(const e of n)if(void 0!==t.get(e))return!0;return!1}removeListener(e,t){s._checkEventSupported(t);const i=this._listeners.get(e);return!!i&&i.delete(t)}removeListeners(e){return this._listeners.delete(e)}removeListenersByEventType(e){let t=!1;for(const[i,n]of this._listeners)t=t||this._listeners[i].delete(e);return t}setListener(e,t,i){s._checkEventSupported(e);let n=this._listeners.get(t);n||(n=new Map),n.set(e,i),this._listeners.set(t,n)}}let c=function(e){return e[e.DEBUG=0]='DEBUG',e[e.INFO=1]='INFO',e[e.WARNING=2]='WARNING',e[e.ERROR=3]='ERROR',e}({});class l{static debug(e){if(this._level<=c.DEBUG){for(var t=arguments.length,i=new Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];l._log('debug',e,i)}}static error(e){if(this._level<=c.ERROR){for(var t=arguments.length,i=new Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];l._log('error',e,i)}}static info(e){if(this._level<=c.INFO){for(var t=arguments.length,i=new Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];l._log('info',e,i)}}static setLevel(e){this._level=e}static warn(e){if(this._level<=c.WARNING){for(var t=arguments.length,i=new Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];l._log('warn',e,i)}}static _log(e,t,i){window.console&&console[e]&&console[e].apply(console,[''.concat(l.PREFIX).concat(t),...i])}}n(l,'PREFIX','[noticeable] '),n(l,'_level',c.INFO);var u;!function(e){var t=function(e){var t,i=Object.prototype,n=i.hasOwnProperty,r=Object.defineProperty||function(e,t,i){e[t]=i.value},o='function'==typeof Symbol?Symbol:{},a=o.iterator||'@@iterator',s=o.asyncIterator||'@@asyncIterator',c=o.toStringTag||'@@toStringTag';function l(e,t,i){return Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},'')}catch(e){l=function(e,t,i){return e[t]=i}}function u(e,t,i,n){var o=t&&t.prototype instanceof f?t:f,a=Object.create(o.prototype),s=new R(n||[]);return r(a,'_invoke',{value:O(e,i,s)}),a}function d(e,t,i){try{return{type:'normal',arg:e.call(t,i)}}catch(e){return{type:'throw',arg:e}}}e.wrap=u;var _='suspendedStart',h='suspendedYield',p='executing',g='completed',m={};function f(){}function y(){}function v(){}var E={};l(E,a,(function(){return this}));var I=Object.getPrototypeOf,w=I&&I(I(D([])));w&&w!==i&&n.call(w,a)&&(E=w);var b=v.prototype=f.prototype=Object.create(E);function T(e){['next','throw','return'].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function S(e,t){function i(r,o,a,s){var c=d(e[r],e,o);if('throw'!==c.type){var l=c.arg,u=l.value;return u&&'object'==typeof u&&n.call(u,'__await')?t.resolve(u.__await).then((function(e){i('next',e,a,s)}),(function(e){i('throw',e,a,s)})):t.resolve(u).then((function(e){l.value=e,a(l)}),(function(e){return i('throw',e,a,s)}))}s(c.arg)}var o;r(this,'_invoke',{value:function(e,n){function r(){return new t((function(t,r){i(e,n,t,r)}))}return o=o?o.then(r,r):r()}})}function O(e,i,n){var r=_;return function(o,a){if(r===p)throw new Error('Generator is already running');if(r===g){if('throw'===o)throw a;return{value:t,done:!0}}for(n.method=o,n.arg=a;;){var s=n.delegate;if(s){var c=C(s,n);if(c){if(c===m)continue;return c}}if('next'===n.method)n.sent=n._sent=n.arg;else if('throw'===n.method){if(r===_)throw r=g,n.arg;n.dispatchException(n.arg)}else'return'===n.method&&n.abrupt('return',n.arg);r=p;var l=d(e,i,n);if('normal'===l.type){if(r=n.done?g:h,l.arg===m)continue;return{value:l.arg,done:n.done}}'throw'===l.type&&(r=g,n.method='throw',n.arg=l.arg)}}}function C(e,i){var n=i.method,r=e.iterator[n];if(r===t)return i.delegate=null,'throw'===n&&e.iterator.return&&(i.method='return',i.arg=t,C(e,i),'throw'===i.method)||'return'!==n&&(i.method='throw',i.arg=new TypeError('The iterator does not provide a \''+n+'\' method')),m;var o=d(r,e.iterator,i.arg);if('throw'===o.type)return i.method='throw',i.arg=o.arg,i.delegate=null,m;var a=o.arg;return a?a.done?(i[e.resultName]=a.value,i.next=e.nextLoc,'return'!==i.method&&(i.method='next',i.arg=t),i.delegate=null,m):a:(i.method='throw',i.arg=new TypeError('iterator result is not an object'),i.delegate=null,m)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function N(e){var t=e.completion||{};t.type='normal',delete t.arg,e.completion=t}function R(e){this.tryEntries=[{tryLoc:'root'}],e.forEach(A,this),this.reset(!0)}function D(e){if(null!=e){var i=e[a];if(i)return i.call(e);if('function'==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,o=function i(){for(;++r<e.length;)if(n.call(e,r))return i.value=e[r],i.done=!1,i;return i.value=t,i.done=!0,i};return o.next=o}}throw new TypeError(typeof e+' is not iterable')}return y.prototype=v,r(b,'constructor',{value:v,configurable:!0}),r(v,'constructor',{value:y,configurable:!0}),y.displayName=l(v,c,'GeneratorFunction'),e.isGeneratorFunction=function(e){var t='function'==typeof e&&e.constructor;return!!t&&(t===y||'GeneratorFunction'===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,l(e,c,'GeneratorFunction')),e.prototype=Object.create(b),e},e.awrap=function(e){return{__await:e}},T(S.prototype),l(S.prototype,s,(function(){return this})),e.AsyncIterator=S,e.async=function(t,i,n,r,o){void 0===o&&(o=Promise);var a=new S(u(t,i,n,r),o);return e.isGeneratorFunction(i)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},T(b),l(b,c,'Generator'),l(b,a,(function(){return this})),l(b,'toString',(function(){return'[object Generator]'})),e.keys=function(e){var t=Object(e),i=[];for(var n in t)i.push(n);return i.reverse(),function e(){for(;i.length;){var n=i.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},e.values=D,R.prototype={constructor:R,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method='next',this.arg=t,this.tryEntries.forEach(N),!e)for(var i in this)'t'===i.charAt(0)&&n.call(this,i)&&!isNaN(+i.slice(1))&&(this[i]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if('throw'===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var i=this;function r(n,r){return s.type='throw',s.arg=e,i.next=n,r&&(i.method='next',i.arg=t),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if('root'===a.tryLoc)return r('end');if(a.tryLoc<=this.prev){var c=n.call(a,'catchLoc'),l=n.call(a,'finallyLoc');if(c&&l){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!l)throw new Error('try statement without catch or finally');if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var i=this.tryEntries.length-1;i>=0;--i){var r=this.tryEntries[i];if(r.tryLoc<=this.prev&&n.call(r,'finallyLoc')&&this.prev<r.finallyLoc){var o=r;break}}o&&('break'===e||'continue'===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method='next',this.next=o.finallyLoc,m):this.complete(a)},complete:function(e,t){if('throw'===e.type)throw e.arg;return'break'===e.type||'continue'===e.type?this.next=e.arg:'return'===e.type?(this.rval=this.arg=e.arg,this.method='return',this.next='end'):'normal'===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.finallyLoc===e)return this.complete(i.completion,i.afterLoc),N(i),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.tryLoc===e){var n=i.completion;if('throw'===n.type){var r=n.arg;N(i)}return r}}throw new Error('illegal catch attempt')},delegateYield:function(e,i,n){return this.delegate={iterator:D(e),resultName:i,nextLoc:n},'next'===this.method&&(this.arg=t),m}},e}(e.exports);try{regeneratorRuntime=t}catch(e){'object'==typeof globalThis?globalThis.regeneratorRuntime=t:Function('r','regeneratorRuntime = r')(t)}}({exports:{}});class d{constructor(e){n(this,'_autoRefreshTimer',void 0),n(this,'_projects',void 0),n(this,'_publicationDataCache',void 0),n(this,'_widgets',void 0),this._projects=new Set,this._widgets=e,this._configurePageVisibilityListener()}_configurePageVisibilityListener(){let e;void 0!==document.hidden?e='visibilitychange':void 0!==document.msHidden?e='msvisibilitychange':void 0!==document.webkitHidden&&(e='webkitvisibilitychange'),void 0===document.addEventListener||void 0===document.hidden?l.warn('Your browser does not support the Page Visibility API. We suggest upgrading your browser to get a full experience'):document.addEventListener(e,this._onPageVisibilityChange.bind(this),!1)}_onPageVisibilityChange(){document.hidden?this.stop():this.start(!0)}async _refresh(){if(!this._publicationDataCache)return;l.debug('Starting auto-refresh iteration...');const e=new Map;for(const[t,i]of this._widgets)if(this._projects.has(i.projectId)){const n=await i.getPublicationState();e.set(t,n)}for(const e of this._projects)l.debug('Invalidating publication data for project '.concat(e)),this._publicationDataCache.invalidate(e);for(const[t,i]of this._widgets)if(this._projects.has(i.projectId)){const n=e.get(t);l.debug('Refreshing widget '.concat(t)),await i.refresh();const r=await i.getPublicationState();(null==n?void 0:n.unreadCount)!==r.unreadCount&&i.eventRegistry.dispatchEvent(i.id,a.WIDGET_PUBLICATION_UNREAD_COUNT_CHANGED,{value:r.unreadCount}),(null==n?void 0:n.unseenCount)!==r.unseenCount&&i.eventRegistry.dispatchEvent(i.id,a.WIDGET_PUBLICATION_UNSEEN_COUNT_CHANGED,{value:r.unseenCount})}}add(e){this._projects.add(e),this.start()}delete(e){this._projects.delete(e),this._autoRefreshTimer&&0===this._projects.size&&this.stop()}start(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];!this._autoRefreshTimer&&this._projects.size>0&&(l.debug('Starting auto-refresh...'),this._autoRefreshTimer=setInterval((async()=>this._refresh()),d.AUTO_REFRESH_INTERVAL),e&&this._refresh())}stop(){this._autoRefreshTimer&&(l.debug('Stopping auto-refresh...'),clearInterval(this._autoRefreshTimer),this._autoRefreshTimer=void 0)}set publicationDataCache(e){this._publicationDataCache=e}}n(d,'AUTO_REFRESH_INTERVAL',3e5);class _{static getDirection(e){switch(e){case'ar':case'ar-001':case'ar-AE':case'ar-BH':case'ar-DJ':case'ar-DZ':case'ar-EG':case'ar-EH':case'ar-ER':case'ar-IL':case'ar-IQ':case'ar-JO':case'ar-KM':case'ar-KW':case'ar-LB':case'ar-LY':case'ar-MA':case'ar-MR':case'ar-OM':case'ar-PS':case'ar-QA':case'ar-SA':case'ar-SD':case'ar-SO':case'ar-SS':case'ar-SY':case'ar-TD':case'ar-TN':case'ar-YE':case'ckb':case'ckb-IQ':case'ckb-IR':case'fa':case'fa-AF':case'fa-IR':case'he':case'he-IL':case'ks':case'ks-IN':case'lrc':case'lrc-IQ':case'lrc-IR':case'mzn':case'mzn-IR':case'pa-Arab':case'pa-Arab-PK':case'ps':case'ps-AF':case'sd':case'sd-PK':case'ug':case'ug-CN':case'ur':case'ur-IN':case'ur-PK':case'uz-Arab':case'uz-Arab-AF':case'yi':case'yi-001':return u.RTL;default:return u.LTR}}}!function(e){e.LTR='ltr',e.RTL='rtl'}(u||(u={}));const h=new Map;var p;!function(e){e.NEWSPAGE='newspage',e.TRIGGER_VIEW='trigger',e.WIDGET_VIEW='widget'}(p||(p={}));class g{constructor(e,t){this.DEFAULT_LANGUAGE_TAG='en-US',this.metadata=e,this.phrasesByLanguageTag=t}static format(e,t,i='en',n={}){let r=null==e?t:e;if(Object.keys(n).length>0)for(const e in n){const t=`{${e}}`;r=r.replace(new RegExp(t,'g'),n[e])}return r}static async load(e,t){if('none'===t)return new g({id:'none',languages:[]},h);const i='https://phrases.noticeable.io/4.0.1/'+e,n=await g.fetch(`${i}/${t}/metadata.json`),r=new Map,o=[];for(const e of n.languages)o.push(g.fetch(`${i}/${t}/${t}.${e}.json`).catch((e=>(console.error(e),{}))));const a=await Promise.all(o);let s=0;for(const e of n.languages){const t=a[s],i=Object.entries(t),n=new Map;for(const[e,t]of i)t.key=e,n.set(e,t);r.set(e,n),s++}return new g(n,r)}static async fetch(e){return await(await fetch(e)).json()}phrases(e=this.DEFAULT_LANGUAGE_TAG){let t=this.phrasesByLanguageTag.get(e);return t||(t=this.phrasesByLanguageTag.get(this.DEFAULT_LANGUAGE_TAG),t)?t:h}phrase(e,t){return this.phrases(e).get(t)}}function m(e){if(!e)return 0;let t=0;for(let i=0;i<e.length;i++)t=(t<<5)-t+e.charCodeAt(i)|0;return t}function f(){const e=navigator.userAgent;return!!/iPad|iPhone|iPod/.test(e)||(!!/android/i.test(e)||(!!/windows phone/i.test(e)||!!window.matchMedia('only screen and (max-width: 768px)').matches))}function y(e){return _.getDirection(e)===u.RTL}function v(e){return e+'px'}class E{constructor(e,t){n(this,'_autoRefresher',void 0),n(this,'_emailSubscriptionFetcher',void 0),n(this,'_projectDataCache',void 0),n(this,'_projectDataFetcher',void 0),n(this,'_publicationDataCache',void 0),n(this,'_publicationDataFetcher',void 0),n(this,'_widgetDataCache',void 0),n(this,'_widgetDataFetcher',void 0),this._autoRefresher=e,this._emailSubscriptionFetcher=new w(t),this._projectDataCache=new b,this._projectDataFetcher=new C(t),this._publicationDataCache=new T,this._publicationDataFetcher=new A(t),this._widgetDataCache=new S,this._widgetDataFetcher=new N(t),this._autoRefresher.publicationDataCache=this._publicationDataCache}async getEmailSubscription(e,t){return this._emailSubscriptionFetcher.getEmailSubscription(e,t)}async getProjectData(e){return this._projectDataCache.getOrCompute(e,((t,i)=>this._projectDataFetcher.fetch(e)))}async getPublicationData(e,t){var i,n;return this._publicationDataCache.getOrCompute({projectId:e,labels:null!==(i=null==t?void 0:t.labels)&&void 0!==i?i:[],segments:null!==(n=null==t?void 0:t.segments)&&void 0!==n?n:[]},((i,n)=>this._publicationDataFetcher.fetch(e,t)))}async getWidgetData(e){return this._widgetDataCache.getOrCompute(e,(async(t,i)=>{var n;const r=await this._widgetDataFetcher.fetch(e);return null!=r&&null!==(n=r.widgetViewSettings)&&void 0!==n&&n.autoRefresh&&r.widgetViewSettings.autoRefresh>0?this._autoRefresher.add(r.projectId):null!=r&&r.projectId&&this._autoRefresher.delete(r.projectId),r}))}invalidateProjectData(e){return this._projectDataCache.invalidate(e)}invalidatePublicationData(e){return this._publicationDataCache.invalidate(e)}invalidateWidgetData(e){return this._widgetDataCache.invalidate(e)}setProjectCacheControl(e){this._projectDataFetcher.setCacheControl(e)}setPublicationCacheControl(e){this._publicationDataFetcher.setCacheControl(e)}setWidgetCacheControl(e){this._widgetDataFetcher.setCacheControl(e)}}class I{constructor(){n(this,'_data',void 0),this._data=new Map}async getOrCompute(e,t){const i=this._id(e);let n=this._data.get(i);return void 0===n&&(n=await this._compute(i,e,t)),n}invalidate(e){return this._data.delete(this._id(e))}async _compute(e,t,i){const n=await i(e,t);return n&&this._data.set(e,n),n}}class w{constructor(e){n(this,'_endpoint',void 0),this._endpoint=e.widgetsData}async getEmailSubscription(e,t){try{const i=await fetch(this._endpoint+'/projects/'+e+'/email_subscriptions/'+t);return await i.json()}catch(e){return{email:t}}}}class b extends I{_id(e){return m(e)}}class T extends I{constructor(){super(),n(this,'_dataByProjectId',void 0),this._dataByProjectId=new Map}invalidate(e){if(void 0===e){const e=this._data.size>0;return this._dataByProjectId.clear(),this._data.clear(),e}if('string'==typeof e){const t=this._dataByProjectId.get(e);if(t){for(const e of t)this._data.delete(e);return this._dataByProjectId.delete(e),!0}return!1}{const t=e.projectId;if(t){const i=this._id(e);this._data.delete(i);const n=this._dataByProjectId.get(t);return n&&(1===n.size&&n.has(i)?this._dataByProjectId.delete(t):n.delete(i)),!0}return!1}}async _compute(e,t,i){const n=await super._compute(e,t,i);if(n){const i=t.projectId;let n=this._dataByProjectId.get(i);n||(n=new Set,this._dataByProjectId.set(i,n)),n.add(e)}return n}_id(e){let t='';for(const[i,n]of Object.entries(e)){const r=typeof n;'string'===r?t+=''.concat(i,'=').concat(n,';'):Array.isArray(n)?t+=''.concat(i,'=').concat([...n].sort().join(','),';'):'boolean'===r?t+=''.concat(i,'=').concat(n?'0':'1',';'):'number'===r?t+=''.concat(i,'=').concat(n,';'):l.warn('Skipping unsupported property '.concat(i,' while computing resourceId for ').concat(e))}return m(t)}}class S extends I{_id(e){return m(e)}}class O{constructor(e,t,i){n(this,'_cacheControl',void 0),n(this,'_endpoints',void 0),n(this,'_resourceName',void 0),n(this,'_resourceUrlBuilder',void 0),this._cacheControl=!0,this._endpoints=e,this._resourceName=t,this._resourceUrlBuilder=i}async fetch(e,t){return await this._fetch(e,t)}setCacheControl(e){this._cacheControl=e}_fetchHeaders(e,t){return new Headers}async _fetch(e,t){const i=this._resourceUrl(e,t);l.debug('Fetching resource '.concat(e,' with options=').concat(JSON.stringify(t),': ').concat(i));try{const e=await fetch(i,{headers:this._fetchHeaders(this._cacheControl,t)});return await e.json()}catch(e){return void l.error('Error while updating '.concat(this._resourceName,' data from url: ').concat(i))}}_resourceUrl(e,t){return this._resourceUrlBuilder(e,t)}}class C extends O{constructor(e){super(e,'project',(t=>e.widgetsData+'/projects/'+t))}}class A extends O{constructor(e){super(e,'publication',((t,i)=>{let n=e.widgetsData+'/projects/'+t+'/publications';if(null!=i&&i.aggregation||null!=i&&i.labels||null!=i&&i.limit||null!=i&&i.segments){var r,o;n+='?';const e=[];null!=i&&i.aggregation&&'nspms'!=i.aggregation&&e.push('a='.concat(i.aggregation)),null!=i&&null!==(r=i.labels)&&void 0!==r&&r.length&&i.labels.length>0&&e.push('l='.concat(i.labels.join(','))),null!=i&&i.limit&&e.push('m='.concat(i.limit.toString())),null!=i&&null!==(o=i.segments)&&void 0!==o&&o.length&&i.segments.length>0&&e.push('s='.concat(i.segments.join(','))),n+=e.join('&')}return n}))}async fetch(e,t){return t&&void 0!==t.limit&&t.limit<=0?[]:super.fetch(e,t)}_fetchHeaders(e,t){var i,n;const r=super._fetchHeaders(e,t);return null!=t&&t.aggregation&&'nspms'!=t.aggregation&&r.append('noticeable-aggregation',t.aggregation),null!=t&&null!==(i=t.labels)&&void 0!==i&&i.length&&t.labels.length>0&&r.append('noticeable-labels',t.labels.join(',')),null!=t&&t.limit&&r.append('noticeable-limit',t.limit.toString()),null!=t&&null!==(n=t.segments)&&void 0!==n&&n.length&&t.segments.length>0&&r.append('noticeable-segments',t.segments.join(',')),r}}class N extends O{constructor(e){super(e,'widget',(t=>e.widgetsData+'/widgets/'+t))}}let R=function(e){return e.IDENTITY_PUBLICATION_READ_INVALIDATE='identity:publication_read:invalidate',e.IDENTITY_PUBLICATION_SEEN_INVALIDATE='identity:publication_seen:invalidate',e.PROJECT_DATA_INVALIDATE='project_data:invalidate',e.PUBLICATION_DATA_INVALIDATE='publication_data:invalidate',e.WIDGET_DATA_INVALIDATE='widget_data:invalidate',e.WIDGET_CLOSE='widget:close',e.WIDGET_HIDE='widget:hide',e.WIDGET_OPEN='widget:open',e.WIDGET_REFRESH='widget:refresh',e.WIDGET_SHOW='widget:show',e.WIDGET_TOGGLE='widget:toggle',e}({}),D=function(e){return e.WIDGET_PUBLICATION_READ='widget:publication:read',e.WIDGET_PUBLICATION_SEEN='widget:publication:seen',e.WIDGET_PUBLICATION_UNREAD_COUNT='widget:publication:unread_count',e.WIDGET_PUBLICATION_UNSEEN_COUNT='widget:publication:unseen_count',e}({}),P=function(e){return e.WIDGET_CLOSED='widget:closed',e.WIDGET_HIDDEN='widget:hidden',e.WIDGET_OPENED='widget:opened',e.WIDGET_VISIBLE='widget:visible',e}({}),L=function(e){return e.LOG_LEVEL='log_level',e.PREFERENCES='preferences',e.WIDGET_PUBLICATION_READ='widget:publication:read',e.WIDGET_PUBLICATION_SEEN='widget:publication:seen',e.WIDGET_TRIGGER_VIEW_SETTINGS='widget:trigger_view:settings',e.WIDGET_WIDGET_VIEW_SETTINGS='widget:widget_view:settings',e}({});const U={production:{prices:{data:[{id:'price_1MAFtIC99y1TMnUurKJzuAVf',currency:'gbp',product:{id:'prod_LLOwqUMCwogcBI'},recurring:{interval:'year'},unit_amount_decimal:'8000',tiers:null},{id:'price_1MAFt8C99y1TMnUuJ24cf23T',currency:'eur',product:{id:'prod_LLOwqUMCwogcBI'},recurring:{interval:'year'},unit_amount_decimal:'9000',tiers:null},{id:'price_1MAFsyC99y1TMnUuy5Df7UlU',currency:'usd',product:{id:'prod_LLOwqUMCwogcBI'},recurring:{interval:'year'},unit_amount_decimal:'9000',tiers:null},{id:'price_1MAFqOC99y1TMnUubccD6Lr9',currency:'eur',product:{id:'prod_ItN1OD9KRBOAxi'},recurring:{interval:'year'},unit_amount_decimal:'30000',tiers:null},{id:'price_1MAFqFC99y1TMnUu6LEG2Aqi',currency:'eur',product:{id:'prod_ItN1OD9KRBOAxi'},recurring:{interval:'month'},unit_amount_decimal:'3000',tiers:null},{id:'price_1MAFnxC99y1TMnUuweGJ7eWI',currency:'gbp',product:{id:'prod_ItNKx6Uu3cJvZB'},recurring:{interval:'year'},unit_amount_decimal:'6000',tiers:null},{id:'price_1MAFnmC99y1TMnUuW0DgJoIK',currency:'gbp',product:{id:'prod_ItNKx6Uu3cJvZB'},recurring:{interval:'month'},unit_amount_decimal:'600',tiers:null},{id:'price_1MAFnJC99y1TMnUukXq2mR5O',currency:'eur',product:{id:'prod_ItNKx6Uu3cJvZB'},recurring:{interval:'year'},unit_amount_decimal:'7000',tiers:null},{id:'price_1MAFn9C99y1TMnUuSzq3BW8E',currency:'eur',product:{id:'prod_ItNKx6Uu3cJvZB'},recurring:{interval:'month'},unit_amount_decimal:'700',tiers:null},{id:'price_1M6Ke6C99y1TMnUu0fMxGTXn',currency:'gbp',product:{id:'v3-business'},recurring:{interval:'year'},unit_amount_decimal:'145000',tiers:null},{id:'price_1M6KdrC99y1TMnUuCUerHlgk',currency:'eur',product:{id:'v3-business'},recurring:{interval:'year'},unit_amount_decimal:'159000',tiers:null},{id:'price_1M6KdjC99y1TMnUu3YgOpvSl',currency:'usd',product:{id:'v3-business'},recurring:{interval:'year'},unit_amount_decimal:'159000',tiers:null},{id:'price_1M6KdYC99y1TMnUu7tRFAkLq',currency:'gbp',product:{id:'v3-business'},recurring:{interval:'month'},unit_amount_decimal:'14500',tiers:null},{id:'price_1M6KdNC99y1TMnUuRDFherFr',currency:'eur',product:{id:'v3-business'},recurring:{interval:'month'},unit_amount_decimal:'15900',tiers:null},{id:'price_1M6KdFC99y1TMnUuvfDSZ6b1',currency:'usd',product:{id:'v3-business'},recurring:{interval:'month'},unit_amount_decimal:'15900',tiers:null},{id:'price_1M6KaZC99y1TMnUuKPQPb6d8',currency:'gbp',product:{id:'v3-growth'},recurring:{interval:'year'},unit_amount_decimal:'72000',tiers:null},{id:'price_1M6KaLC99y1TMnUuDzjiyhbA',currency:'eur',product:{id:'v3-growth'},recurring:{interval:'year'},unit_amount_decimal:'79000',tiers:null},{id:'price_1M6KaAC99y1TMnUuHmHgbh8q',currency:'usd',product:{id:'v3-growth'},recurring:{interval:'year'},unit_amount_decimal:'79000',tiers:null},{id:'price_1M6KZfC99y1TMnUuUuXfSFBW',currency:'gbp',product:{id:'v3-growth'},recurring:{interval:'month'},unit_amount_decimal:'7200',tiers:null},{id:'price_1M6KZQC99y1TMnUunjBxxXPk',currency:'eur',product:{id:'v3-growth'},recurring:{interval:'month'},unit_amount_decimal:'7900',tiers:null},{id:'price_1M6KZGC99y1TMnUulFT3cTqb',currency:'usd',product:{id:'v3-growth'},recurring:{interval:'month'},unit_amount_decimal:'7900',tiers:null},{id:'price_1M6KWrC99y1TMnUuPRY9IfOC',currency:'gbp',product:{id:'v3-starter'},recurring:{interval:'year'},unit_amount_decimal:'27000',tiers:null},{id:'price_1M6KWUC99y1TMnUuA0DNewdz',currency:'eur',product:{id:'v3-starter'},recurring:{interval:'year'},unit_amount_decimal:'29000',tiers:null},{id:'price_1M6KWJC99y1TMnUuKDCHkhG3',currency:'usd',product:{id:'v3-starter'},recurring:{interval:'year'},unit_amount_decimal:'29000',tiers:null},{id:'price_1M6KWCC99y1TMnUu8qvmaY2o',currency:'gbp',product:{id:'v3-starter'},recurring:{interval:'month'},unit_amount_decimal:'2700',tiers:null},{id:'price_1M6KW2C99y1TMnUu3aEllv95',currency:'eur',product:{id:'v3-starter'},recurring:{interval:'month'},unit_amount_decimal:'2900',tiers:null},{id:'price_1M6KVsC99y1TMnUu4iNxDH2w',currency:'usd',product:{id:'v3-starter'},recurring:{interval:'month'},unit_amount_decimal:'2900',tiers:null},{id:'price_1M5AiJC99y1TMnUuYwo5KQlp',currency:'usd',product:{id:'prod_LFr36mXdpQZzUo'},recurring:{interval:'year'},unit_amount_decimal:null,tiers:[{flat_amount:null,flat_amount_decimal:null,unit_amount:null,unit_amount_decimal:'0.5',up_to:1e3},{flat_amount:null,flat_amount_decimal:null,unit_amount:null,unit_amount_decimal:'0.2',up_to:1e4},{flat_amount:null,flat_amount_decimal:null,unit_amount:null,unit_amount_decimal:'0.1',up_to:1e5},{flat_amount:null,flat_amount_decimal:null,unit_amount:null,unit_amount_decimal:'0.09',up_to:1e6},{flat_amount:null,flat_amount_decimal:null,unit_amount:null,unit_amount_decimal:'0.08',up_to:null}]},{id:'price_1Kei95C99y1TMnUupxojfxlM',currency:'usd',product:{id:'prod_LLOwqUMCwogcBI'},recurring:{interval:'month'},unit_amount_decimal:'900',tiers:null},{id:'price_1Kei95C99y1TMnUudBsBUgfX',currency:'eur',product:{id:'prod_LLOwqUMCwogcBI'},recurring:{interval:'month'},unit_amount_decimal:'900',tiers:null},{id:'price_1Kei95C99y1TMnUuhmZvLUBS',currency:'gbp',product:{id:'prod_LLOwqUMCwogcBI'},recurring:{interval:'month'},unit_amount_decimal:'800',tiers:null},{id:'price_1KZLLoC99y1TMnUueFa8pZLU',currency:'eur',product:{id:'prod_LFr36mXdpQZzUo'},recurring:{interval:'month'},unit_amount_decimal:null,tiers:[{flat_amount:0,flat_amount_decimal:'0',unit_amount:null,unit_amount_decimal:'0.5',up_to:1e3},{flat_amount:0,flat_amount_decimal:'0',unit_amount:null,unit_amount_decimal:'0.2',up_to:1e4},{flat_amount:0,flat_amount_decimal:'0',unit_amount:null,unit_amount_decimal:'0.1',up_to:1e5},{flat_amount:0,flat_amount_decimal:'0',unit_amount:null,unit_amount_decimal:'0.09',up_to:1e6},{flat_amount:0,flat_amount_decimal:'0',unit_amount:null,unit_amount_decimal:'0.08',up_to:null}]},{id:'price_1KZLLoC99y1TMnUu0ZrpdQ6F',currency:'gbp',product:{id:'prod_LFr36mXdpQZzUo'},recurring:{interval:'month'},unit_amount_decimal:null,tiers:[{flat_amount:0,flat_amount_decimal:'0',unit_amount:null,unit_amount_decimal:'0.45',up_to:1e3},{flat_amount:0,flat_amount_decimal:'0',unit_amount:null,unit_amount_decimal:'0.18',up_to:1e4},{flat_amount:0,flat_amount_decimal:'0',unit_amount:null,unit_amount_decimal:'0.09',up_to:1e5},{flat_amount:0,flat_amount_decimal:'0',unit_amount:null,unit_amount_decimal:'0.08',up_to:1e6},{flat_amount:0,flat_amount_decimal:'0',unit_amount:null,unit_amount_decimal:'0.075',up_to:null}]},{id:'price_1KZLLoC99y1TMnUuSwTEoz6W',currency:'usd',product:{id:'prod_LFr36mXdpQZzUo'},recurring:{interval:'month'},unit_amount_decimal:null,tiers:[{flat_amount:null,flat_amount_decimal:null,unit_amount:null,unit_amount_decimal:'0.5',up_to:1e3},{flat_amount:null,flat_amount_decimal:null,unit_amount:null,unit_amount_decimal:'0.2',up_to:1e4},{flat_amount:null,flat_amount_decimal:null,unit_amount:null,unit_amount_decimal:'0.1',up_to:1e5},{flat_amount:null,flat_amount_decimal:null,unit_amount:null,unit_amount_decimal:'0.09',up_to:1e6},{flat_amount:null,flat_amount_decimal:null,unit_amount:null,unit_amount_decimal:'0.08',up_to:null}]},{id:'price_1KZLLoC99y1TMnUuM1ir8VLE',currency:'gbp',product:{id:'prod_LFr36mXdpQZzUo'},recurring:{interval:'year'},unit_amount_decimal:null,tiers:[{flat_amount:null,flat_amount_decimal:null,unit_amount:null,unit_amount_decimal:'0.45',up_to:1e3},{flat_amount:null,flat_amount_decimal:null,unit_amount:null,unit_amount_decimal:'0.18',up_to:1e4},{flat_amount:null,flat_amount_decimal:null,unit_amount:null,unit_amount_decimal:'0.09',up_to:1e5},{flat_amount:null,flat_amount_decimal:null,unit_amount:null,unit_amount_decimal:'0.08',up_to:1e6},{flat_amount:null,flat_amount_decimal:null,unit_amount:null,unit_amount_decimal:'0.075',up_to:null}]},{id:'price_1KZLLnC99y1TMnUuDk5ZDgs1',currency:'eur',product:{id:'prod_LFr36mXdpQZzUo'},recurring:{interval:'year'},unit_amount_decimal:null,tiers:[{flat_amount:null,flat_amount_decimal:null,unit_amount:null,unit_amount_decimal:'0.5',up_to:1e3},{flat_amount:null,flat_amount_decimal:null,unit_amount:null,unit_amount_decimal:'0.2',up_to:1e4},{flat_amount:null,flat_amount_decimal:null,unit_amount:null,unit_amount_decimal:'0.1',up_to:1e5},{flat_amount:null,flat_amount_decimal:null,unit_amount:null,unit_amount_decimal:'0.09',up_to:1e6},{flat_amount:null,flat_amount_decimal:null,unit_amount:null,unit_amount_decimal:'0.08',up_to:null}]},{id:'v3-extra_collaborator-usd-month',currency:'usd',product:{id:'prod_ItNKx6Uu3cJvZB'},recurring:{interval:'month'},unit_amount_decimal:'700',tiers:null},{id:'v3-extra_collaborator-usd-year',currency:'usd',product:{id:'prod_ItNKx6Uu3cJvZB'},recurring:{interval:'year'},unit_amount_decimal:'7000',tiers:null},{id:'v3-extra_project-usd-year',currency:'usd',product:{id:'prod_ItN1OD9KRBOAxi'},recurring:{interval:'year'},unit_amount_decimal:'30000',tiers:null},{id:'v3-extra_project-usd-month',currency:'usd',product:{id:'prod_ItN1OD9KRBOAxi'},recurring:{interval:'month'},unit_amount_decimal:'3000',tiers:null},{id:'v3-extra_project-gbp-year',currency:'gbp',product:{id:'prod_ItN1OD9KRBOAxi'},recurring:{interval:'year'},unit_amount_decimal:'25000',tiers:null},{id:'v3-extra_project-gbp-month',currency:'gbp',product:{id:'prod_ItN1OD9KRBOAxi'},recurring:{interval:'month'},unit_amount_decimal:'2500',tiers:null},{id:'v3-enterprise-eur-year',currency:'eur',product:{id:'prod_GukNYbXAooLiCr'},recurring:{interval:'year'},unit_amount_decimal:'399900',tiers:null},{id:'v3-enterprise-eur-month',currency:'eur',product:{id:'prod_GukNYbXAooLiCr'},recurring:{interval:'month'},unit_amount_decimal:'39900',tiers:null},{id:'v3-enterprise-gbp-year',currency:'gbp',product:{id:'prod_GukNYbXAooLiCr'},recurring:{interval:'year'},unit_amount_decimal:'399900',tiers:null},{id:'v3-enterprise-gbp-month',currency:'gbp',product:{id:'prod_GukNYbXAooLiCr'},recurring:{interval:'month'},unit_amount_decimal:'39900',tiers:null},{id:'v3-enterprise-usd-year',currency:'usd',product:{id:'prod_GukNYbXAooLiCr'},recurring:{interval:'year'},unit_amount_decimal:'399900',tiers:null},{id:'v3-enterprise-usd-month',currency:'usd',product:{id:'prod_GukNYbXAooLiCr'},recurring:{interval:'month'},unit_amount_decimal:'39900',tiers:null},{id:'v3-extra-collaborator-usd-year',currency:'usd',product:{id:'v3-extra-collaborator'},recurring:{interval:'year'},unit_amount_decimal:'3990',tiers:null},{id:'v3-extra-collaborator-usd-month',currency:'usd',product:{id:'v3-extra-collaborator'},recurring:{interval:'month'},unit_amount_decimal:'399',tiers:null},{id:'v3-extra-collaborator-eur-year',currency:'eur',product:{id:'v3-extra-collaborator'},recurring:{interval:'year'},unit_amount_decimal:'3990',tiers:null},{id:'v3-extra-collaborator-gbp-year',currency:'gbp',product:{id:'v3-extra-collaborator'},recurring:{interval:'year'},unit_amount_decimal:'3990',tiers:null},{id:'v3-extra-collaborator-gbp-month',currency:'gbp',product:{id:'v3-extra-collaborator'},recurring:{interval:'month'},unit_amount_decimal:'399',tiers:null},{id:'v3-extra-collaborator-eur-month',currency:'eur',product:{id:'v3-extra-collaborator'},recurring:{interval:'month'},unit_amount_decimal:'399',tiers:null},{id:'v3-opensource-gbp-month',currency:'gbp',product:{id:'v3-opensource'},recurring:{interval:'month'},unit_amount_decimal:'0',tiers:null},{id:'v3-opensource-gbp-year',currency:'gbp',product:{id:'v3-opensource'},recurring:{interval:'year'},unit_amount_decimal:'0',tiers:null},{id:'v3-opensource-usd-year',currency:'usd',product:{id:'v3-opensource'},recurring:{interval:'year'},unit_amount_decimal:'0',tiers:null},{id:'v3-opensource-eur-year',currency:'eur',product:{id:'v3-opensource'},recurring:{interval:'year'},unit_amount_decimal:'0',tiers:null},{id:'v3-opensource-usd-month',currency:'usd',product:{id:'v3-opensource'},recurring:{interval:'month'},unit_amount_decimal:'0',tiers:null},{id:'v3-opensource-eur-month',currency:'eur',product:{id:'v3-opensource'},recurring:{interval:'month'},unit_amount_decimal:'0',tiers:null},{id:'v3-free-gbp-year',currency:'gbp',product:{id:'v3-free'},recurring:{interval:'year'},unit_amount_decimal:'0',tiers:null},{id:'v3-free-usd-year',currency:'usd',product:{id:'v3-free'},recurring:{interval:'year'},unit_amount_decimal:'0',tiers:null},{id:'v3-free-gbp-month',currency:'gbp',product:{id:'v3-free'},recurring:{interval:'month'},unit_amount_decimal:'0',tiers:null},{id:'v3-free-eur-year',currency:'eur',product:{id:'v3-free'},recurring:{interval:'year'},unit_amount_decimal:'0',tiers:null},{id:'v3-free-usd-month',currency:'usd',product:{id:'v3-free'},recurring:{interval:'month'},unit_amount_decimal:'0',tiers:null},{id:'v3-free-eur-month',currency:'eur',product:{id:'v3-free'},recurring:{interval:'month'},unit_amount_decimal:'0',tiers:null},{id:'v3-academic-gbp-month',currency:'gbp',product:{id:'v3-academic'},recurring:{interval:'month'},unit_amount_decimal:'0',tiers:null},{id:'v3-academic-usd-month',currency:'usd',product:{id:'v3-academic'},recurring:{interval:'month'},unit_amount_decimal:'0',tiers:null},{id:'v3-academic-usd-year',currency:'usd',product:{id:'v3-academic'},recurring:{interval:'year'},unit_amount_decimal:'0',tiers:null},{id:'v3-academic-eur-year',currency:'eur',product:{id:'v3-academic'},recurring:{interval:'year'},unit_amount_decimal:'0',tiers:null},{id:'v3-academic-gbp-year',currency:'gbp',product:{id:'v3-academic'},recurring:{interval:'year'},unit_amount_decimal:'0',tiers:null},{id:'v3-academic-eur-month',currency:'eur',product:{id:'v3-academic'},recurring:{interval:'month'},unit_amount_decimal:'0',tiers:null}]},products:{data:[{id:'prod_LLOwqUMCwogcBI',name:'Extra widget',metadata:{slug:'extra-widget'}},{id:'prod_LFr36mXdpQZzUo',name:'Emails',metadata:{slug:'emails'}},{id:'prod_ItNKx6Uu3cJvZB',name:'Extra Collaborator',metadata:{slug:'extra-collaborator'}},{id:'prod_ItN1OD9KRBOAxi',name:'Extra Project',metadata:{slug:'extra-project'}},{id:'prod_GukNYbXAooLiCr',name:'Enterprise Plan',metadata:{plan:'true',slug:'enterprise'}},{id:'v3-starter',name:'Starter Plan',metadata:{plan:'true',slug:'starter'}},{id:'v3-opensource',name:'Open Source Plan',metadata:{hidden:'true',plan:'true',slug:'opensource'}},{id:'v3-growth',name:'Growth Plan',metadata:{plan:'true',slug:'growth'}},{id:'v3-free',name:'Free Plan',metadata:{plan:'true',slug:'free'}},{id:'v3-business',name:'Business Plan',metadata:{plan:'true',slug:'business'}},{id:'v3-academic',name:'Academic Plan',metadata:{hidden:'true',plan:'true',slug:'academic'}}]}},staging:{prices:{data:[{id:'price_1MAFv3C99y1TMnUujPJKJJYV',currency:'gbp',product:{id:'prod_JTa0oRB0KIDiFJ'},recurring:{interval:'year'},unit_amount_decimal:'8000',tiers:null},{id:'price_1MAFutC99y1TMnUuaIgafC5q',currency:'eur',product:{id:'prod_JTa0oRB0KIDiFJ'},recurring:{interval:'year'},unit_amount_decimal:'9000',tiers:null},{id:'price_1MAFukC99y1TMnUu8eg21Pg2',currency:'usd',product:{id:'prod_JTa0oRB0KIDiFJ'},recurring:{interval:'year'},unit_amount_decimal:'9000',tiers:null},{id:'price_1MAFucC99y1TMnUub7MhuQcy',currency:'gbp',product:{id:'prod_JTa0oRB0KIDiFJ'},recurring:{interval:'month'},unit_amount_decimal:'800',tiers:null},{id:'price_1MAFuVC99y1TMnUuVdzNAqic',currency:'eur',product:{id:'prod_JTa0oRB0KIDiFJ'},recurring:{interval:'month'},unit_amount_decimal:'900',tiers:null},{id:'price_1MAFuPC99y1TMnUuhHbKIicg',currency:'usd',product:{id:'prod_JTa0oRB0KIDiFJ'},recurring:{interval:'month'},unit_amount_decimal:'900',tiers:null},{id:'price_1MAFrzC99y1TMnUuBGOCPGka',currency:'gbp',product:{id:'v3-extra-project'},recurring:{interval:'year'},unit_amount_decimal:'25000',tiers:null},{id:'price_1MAFrqC99y1TMnUunP3s8SkB',currency:'gbp',product:{id:'v3-extra-project'},recurring:{interval:'month'},unit_amount_decimal:'2500',tiers:null},{id:'price_1MAFraC99y1TMnUuDy8Q2UIi',currency:'eur',product:{id:'v3-extra-project'},recurring:{interval:'year'},unit_amount_decimal:'30000',tiers:null},{id:'price_1MAFrRC99y1TMnUub8EX0viP',currency:'eur',product:{id:'v3-extra-project'},recurring:{interval:'month'},unit_amount_decimal:'3000',tiers:null},{id:'price_1MAFrJC99y1TMnUuGioQM3VH',currency:'usd',product:{id:'v3-extra-project'},recurring:{interval:'year'},unit_amount_decimal:'30000',tiers:null},{id:'price_1MAFrCC99y1TMnUuWXtyUVC0',currency:'usd',product:{id:'v3-extra-project'},recurring:{interval:'month'},unit_amount_decimal:'3000',tiers:null},{id:'price_1MAFp1C99y1TMnUuWrt4pzOe',currency:'gbp',product:{id:'v3-extra-collaborator'},recurring:{interval:'year'},unit_amount_decimal:'6000',tiers:null},{id:'price_1MAFoqC99y1TMnUuPkDc5jn3',currency:'gbp',product:{id:'v3-extra-collaborator'},recurring:{interval:'month'},unit_amount_decimal:'600',tiers:null},{id:'price_1MAFohC99y1TMnUuVBjrN3nJ',currency:'eur',product:{id:'v3-extra-collaborator'},recurring:{interval:'year'},unit_amount_decimal:'7000',tiers:null},{id:'price_1MAFoWC99y1TMnUu6TqNEkIC',currency:'eur',product:{id:'v3-extra-collaborator'},recurring:{interval:'month'},unit_amount_decimal:'700',tiers:null},{id:'price_1MAFoMC99y1TMnUugNvVOFlf',currency:'usd',product:{id:'v3-extra-collaborator'},recurring:{interval:'year'},unit_amount_decimal:'7000',tiers:null},{id:'price_1MAFmJC99y1TMnUuqxahXXM5',currency:'usd',product:{id:'v3-extra-collaborator'},recurring:{interval:'month'},unit_amount_decimal:'700',tiers:null},{id:'price_1M6JqKC99y1TMnUu6TUpE2AO',currency:'eur',product:{id:'v3-business'},recurring:{interval:'year'},unit_amount_decimal:'159000',tiers:null},{id:'price_1M6Jq7C99y1TMnUuRVJ86o4L',currency:'usd',product:{id:'v3-business'},recurring:{interval:'year'},unit_amount_decimal:'159000',tiers:null},{id:'price_1M6JpxC99y1TMnUu9NzVNYHe',currency:'gbp',product:{id:'v3-business'},recurring:{interval:'year'},unit_amount_decimal:'145000',tiers:null},{id:'price_1M6JpPC99y1TMnUuf3bmwgLt',currency:'gbp',product:{id:'v3-business'},recurring:{interval:'month'},unit_amount_decimal:'14500',tiers:null},{id:'price_1M6JnxC99y1TMnUuqOkRHbTV',currency:'eur',product:{id:'v3-business'},recurring:{interval:'month'},unit_amount_decimal:'15900',tiers:null},{id:'price_1M6JnoC99y1TMnUurm3pxv6x',currency:'usd',product:{id:'v3-business'},recurring:{interval:'month'},unit_amount_decimal:'15900',tiers:null},{id:'price_1M6JjcC99y1TMnUuBsynN8pu',currency:'gbp',product:{id:'v3-growth'},recurring:{interval:'year'},unit_amount_decimal:'72000',tiers:null},{id:'price_1M6JjQC99y1TMnUuuSZyJdL9',currency:'eur',product:{id:'v3-growth'},recurring:{interval:'year'},unit_amount_decimal:'79000',tiers:null},{id:'price_1M6Jj9C99y1TMnUutRdedTGK',currency:'usd',product:{id:'v3-growth'},recurring:{interval:'year'},unit_amount_decimal:'79000',tiers:null},{id:'price_1M6JiqC99y1TMnUuAhMjYiYU',currency:'gbp',product:{id:'v3-growth'},recurring:{interval:'month'},unit_amount_decimal:'7200',tiers:null},{id:'price_1M6JiBC99y1TMnUuWIlN9GNv',currency:'eur',product:{id:'v3-growth'},recurring:{interval:'month'},unit_amount_decimal:'7900',tiers:null},{id:'price_1M6Ji0C99y1TMnUuKuQXASE9',currency:'usd',product:{id:'v3-growth'},recurring:{interval:'month'},unit_amount_decimal:'7900',tiers:null},{id:'price_1M6JhTC99y1TMnUu2yIfV3uw',currency:'eur',product:{id:'v3-starter'},recurring:{interval:'year'},unit_amount_decimal:'29000',tiers:null},{id:'price_1M6JgzC99y1TMnUuZovm9ejw',currency:'usd',product:{id:'v3-starter'},recurring:{interval:'year'},unit_amount_decimal:'29000',tiers:null},{id:'price_1M6JdgC99y1TMnUuHwOIwjd6',currency:'gbp',product:{id:'v3-starter'},recurring:{interval:'year'},unit_amount_decimal:'27000',tiers:null},{id:'price_1M6JbhC99y1TMnUugLzYMQS2',currency:'gbp',product:{id:'v3-starter'},recurring:{interval:'month'},unit_amount_decimal:'2700',tiers:null},{id:'price_1M6Jb8C99y1TMnUuDug6PPIY',currency:'eur',product:{id:'v3-starter'},recurring:{interval:'month'},unit_amount_decimal:'2900',tiers:null},{id:'price_1M6JaXC99y1TMnUuKhrqhGK1',currency:'usd',product:{id:'v3-starter'},recurring:{interval:'month'},unit_amount_decimal:'2900',tiers:null},{id:'price_1KZKr0C99y1TMnUunUIa4cRk',currency:'eur',product:{id:'prod_L9QViFub93Te3N'},recurring:{interval:'year'},unit_amount_decimal:null,tiers:[{flat_amount:null,flat_amount_decimal:null,unit_amount:null,unit_amount_decimal:'0.5',up_to:1e3},{flat_amount:null,flat_amount_decimal:null,unit_amount:null,unit_amount_decimal:'0.2',up_to:1e4},{flat_amount:null,flat_amount_decimal:null,unit_amount:null,unit_amount_decimal:'0.1',up_to:1e5},{flat_amount:null,flat_amount_decimal:null,unit_amount:null,unit_amount_decimal:'0.09',up_to:1e6},{flat_amount:null,flat_amount_decimal:null,unit_amount:null,unit_amount_decimal:'0.08',up_to:null}]},{id:'price_1KZKp6C99y1TMnUueHIRpsU6',currency:'gbp',product:{id:'prod_L9QViFub93Te3N'},recurring:{interval:'year'},unit_amount_decimal:null,tiers:[{flat_amount:null,flat_amount_decimal:null,unit_amount:null,unit_amount_decimal:'0.45',up_to:1e3},{flat_amount:null,flat_amount_decimal:null,unit_amount:null,unit_amount_decimal:'0.18',up_to:1e4},{flat_amount:null,flat_amount_decimal:null,unit_amount:null,unit_amount_decimal:'0.09',up_to:1e5},{flat_amount:null,flat_amount_decimal:null,unit_amount:null,unit_amount_decimal:'0.08',up_to:1e6},{flat_amount:null,flat_amount_decimal:null,unit_amount:null,unit_amount_decimal:'0.075',up_to:null}]},{id:'price_1KZKnDC99y1TMnUuSkPq8lcz',currency:'usd',product:{id:'prod_L9QViFub93Te3N'},recurring:{interval:'year'},unit_amount_decimal:null,tiers:[{flat_amount:null,flat_amount_decimal:null,unit_amount:null,unit_amount_decimal:'0.5',up_to:1e3},{flat_amount:null,flat_amount_decimal:null,unit_amount:null,unit_amount_decimal:'0.2',up_to:1e4},{flat_amount:null,flat_amount_decimal:null,unit_amount:null,unit_amount_decimal:'0.1',up_to:1e5},{flat_amount:null,flat_amount_decimal:null,unit_amount:null,unit_amount_decimal:'0.09',up_to:1e6},{flat_amount:null,flat_amount_decimal:null,unit_amount:null,unit_amount_decimal:'0.08',up_to:null}]},{id:'price_1KZKSbC99y1TMnUu0K6uACI3',currency:'usd',product:{id:'prod_L9QViFub93Te3N'},recurring:{interval:'month'},unit_amount_decimal:null,tiers:[{flat_amount:null,flat_amount_decimal:null,unit_amount:null,unit_amount_decimal:'0.5',up_to:1e3},{flat_amount:null,flat_amount_decimal:null,unit_amount:null,unit_amount_decimal:'0.2',up_to:1e4},{flat_amount:null,flat_amount_decimal:null,unit_amount:null,unit_amount_decimal:'0.1',up_to:1e5},{flat_amount:null,flat_amount_decimal:null,unit_amount:null,unit_amount_decimal:'0.09',up_to:1e6},{flat_amount:null,flat_amount_decimal:null,unit_amount:null,unit_amount_decimal:'0.08',up_to:null}]},{id:'price_1KT7epC99y1TMnUu1cifI4Jh',currency:'gbp',product:{id:'prod_L9QViFub93Te3N'},recurring:{interval:'month'},unit_amount_decimal:null,tiers:[{flat_amount:0,flat_amount_decimal:'0',unit_amount:null,unit_amount_decimal:'0.45',up_to:1e3},{flat_amount:0,flat_amount_decimal:'0',unit_amount:null,unit_amount_decimal:'0.18',up_to:1e4},{flat_amount:0,flat_amount_decimal:'0',unit_amount:null,unit_amount_decimal:'0.09',up_to:1e5},{flat_amount:0,flat_amount_decimal:'0',unit_amount:null,unit_amount_decimal:'0.08',up_to:1e6},{flat_amount:0,flat_amount_decimal:'0',unit_amount:null,unit_amount_decimal:'0.075',up_to:null}]},{id:'price_1KT7epC99y1TMnUu2EvRuMFn',currency:'eur',product:{id:'prod_L9QViFub93Te3N'},recurring:{interval:'month'},unit_amount_decimal:null,tiers:[{flat_amount:0,flat_amount_decimal:'0',unit_amount:null,unit_amount_decimal:'0.5',up_to:1e3},{flat_amount:0,flat_amount_decimal:'0',unit_amount:null,unit_amount_decimal:'0.2',up_to:1e4},{flat_amount:0,flat_amount_decimal:'0',unit_amount:null,unit_amount_decimal:'0.1',up_to:1e5},{flat_amount:0,flat_amount_decimal:'0',unit_amount:null,unit_amount_decimal:'0.09',up_to:1e6},{flat_amount:0,flat_amount_decimal:'0',unit_amount:null,unit_amount_decimal:'0.08',up_to:null}]},{id:'v3-enterprise-eur-year',currency:'eur',product:{id:'prod_GukXSrRcH6AU9m'},recurring:{interval:'year'},unit_amount_decimal:'399900',tiers:null},{id:'v3-enterprise-eur-month',currency:'eur',product:{id:'prod_GukXSrRcH6AU9m'},recurring:{interval:'month'},unit_amount_decimal:'39900',tiers:null},{id:'v3-enterprise-gbp-year',currency:'gbp',product:{id:'prod_GukXSrRcH6AU9m'},recurring:{interval:'year'},unit_amount_decimal:'399900',tiers:null},{id:'v3-enterprise-gbp-month',currency:'gbp',product:{id:'prod_GukXSrRcH6AU9m'},recurring:{interval:'month'},unit_amount_decimal:'39900',tiers:null},{id:'v3-enterprise-usd-year',currency:'usd',product:{id:'prod_GukXSrRcH6AU9m'},recurring:{interval:'year'},unit_amount_decimal:'399900',tiers:null},{id:'v3-enterprise-usd-month',currency:'usd',product:{id:'prod_GukXSrRcH6AU9m'},recurring:{interval:'month'},unit_amount_decimal:'39900',tiers:null},{id:'v3-opensource-usd-month',currency:'usd',product:{id:'v3-opensource'},recurring:{interval:'month'},unit_amount_decimal:'0',tiers:null},{id:'v3-opensource-gbp-month',currency:'gbp',product:{id:'v3-opensource'},recurring:{interval:'month'},unit_amount_decimal:'0',tiers:null},{id:'v3-opensource-usd-year',currency:'usd',product:{id:'v3-opensource'},recurring:{interval:'year'},unit_amount_decimal:'0',tiers:null},{id:'v3-opensource-eur-year',currency:'eur',product:{id:'v3-opensource'},recurring:{interval:'year'},unit_amount_decimal:'0',tiers:null},{id:'v3-opensource-gbp-year',currency:'gbp',product:{id:'v3-opensource'},recurring:{interval:'year'},unit_amount_decimal:'0',tiers:null},{id:'v3-opensource-eur-month',currency:'eur',product:{id:'v3-opensource'},recurring:{interval:'month'},unit_amount_decimal:'0',tiers:null},{id:'v3-free-usd-year',currency:'usd',product:{id:'v3-free'},recurring:{interval:'year'},unit_amount_decimal:'0',tiers:null},{id:'v3-free-gbp-year',currency:'gbp',product:{id:'v3-free'},recurring:{interval:'year'},unit_amount_decimal:'0',tiers:null},{id:'v3-free-gbp-month',currency:'gbp',product:{id:'v3-free'},recurring:{interval:'month'},unit_amount_decimal:'0',tiers:null},{id:'v3-free-eur-year',currency:'eur',product:{id:'v3-free'},recurring:{interval:'year'},unit_amount_decimal:'0',tiers:null},{id:'v3-free-usd-month',currency:'usd',product:{id:'v3-free'},recurring:{interval:'month'},unit_amount_decimal:'0',tiers:null},{id:'v3-free-eur-month',currency:'eur',product:{id:'v3-free'},recurring:{interval:'month'},unit_amount_decimal:'0',tiers:null},{id:'v3-academic-gbp-year',currency:'gbp',product:{id:'v3-academic'},recurring:{interval:'year'},unit_amount_decimal:'0',tiers:null},{id:'v3-academic-usd-year',currency:'usd',product:{id:'v3-academic'},recurring:{interval:'year'},unit_amount_decimal:'0',tiers:null},{id:'v3-academic-usd-month',currency:'usd',product:{id:'v3-academic'},recurring:{interval:'month'},unit_amount_decimal:'0',tiers:null},{id:'v3-academic-eur-year',currency:'eur',product:{id:'v3-academic'},recurring:{interval:'year'},unit_amount_decimal:'0',tiers:null},{id:'v3-academic-gbp-month',currency:'gbp',product:{id:'v3-academic'},recurring:{interval:'month'},unit_amount_decimal:'0',tiers:null},{id:'v3-academic-eur-month',currency:'eur',product:{id:'v3-academic'},recurring:{interval:'month'},unit_amount_decimal:'0',tiers:null}]},products:{data:[{id:'prod_L9QViFub93Te3N',name:'Emails',metadata:{slug:'emails'}},{id:'prod_JTa0oRB0KIDiFJ',name:'Extra widget',metadata:{slug:'extra-widget'}},{id:'prod_GukXSrRcH6AU9m',name:'Enterprise Plan',metadata:{plan:'true',slug:'enterprise'}},{id:'v3-extra-project',name:'Extra project',metadata:{slug:'extra-project'}},{id:'v3-extra-collaborator',name:'Extra collaborator',metadata:{slug:'extra-collaborator'}},{id:'v3-starter',name:'Starter Plan',metadata:{plan:'true',slug:'starter'}},{id:'v3-opensource',name:'Open Source Plan',metadata:{hidden:'true',plan:'true',slug:'opensource'}},{id:'v3-growth',name:'Growth Plan',metadata:{plan:'true',slug:'growth'}},{id:'v3-free',name:'Free Plan',metadata:{plan:'true',slug:'free'}},{id:'v3-business',name:'Business Plan',metadata:{plan:'true',slug:'business'}},{id:'v3-academic',name:'Academic Plan',metadata:{hidden:'true',plan:'true',slug:'academic'}}]}}};var G,M;!function(e){e.MONTH='month',e.YEAR='year'}(G||(G={}));class B{static from(e){return'month'===e?G.MONTH:'year'===e?G.YEAR:null}}class W{static getCurrencyAbbreviation(e){const t=W.LOCALE_CURRENCY_MAP[W.getRegionIdentifier(e).toUpperCase()];return!t||'GBP'!==t&&'EUR'!==t&&'USD'!==t?W.DEFAULT_CURRENCY_ABBREVIATION:t.toUpperCase()}static getRegionIdentifier(e){if(!e)return W.DEFAULT_REGION_IDENTIFIER;let t=e.split('_');return 2===t.length?t.pop():(t=e.split('-'),2===t.length?t.pop():e.toUpperCase())}static getPrimaryLocale(e){return e?e.split(',')[0]:W.DEFAULT_REGION_IDENTIFIER}static getCurrencySymbol(e){if(!e)return W.DEFAULT_CURRENCY_SYMBOL;switch(e.toUpperCase()){case'EUR':return'';case'GBP':return'';default:return W.DEFAULT_CURRENCY_SYMBOL}}}W.DEFAULT_CURRENCY_ABBREVIATION='USD',W.DEFAULT_CURRENCY_SYMBOL='$',W.DEFAULT_REGION_IDENTIFIER='US',W.LOCALE_CURRENCY_MAP={AD:'EUR',AE:'AED',AF:'AFN',AG:'XCD',AI:'XCD',AL:'ALL',AM:'AMD',AN:'ANG',AO:'AOA',AR:'ARS',AS:'USD',AT:'EUR',AU:'AUD',AW:'AWG',AX:'EUR',AZ:'AZN',BA:'BAM',BB:'BBD',BD:'BDT',BE:'EUR',BF:'XOF',BG:'BGN',BH:'BHD',BI:'BIF',BJ:'XOF',BL:'EUR',BM:'BMD',BN:'BND',BO:'BOB',BQ:'USD',BR:'BRL',BS:'BSD',BT:'BTN',BV:'NOK',BW:'BWP',BY:'BYR',BZ:'BZD',CA:'CAD',CC:'AUD',CD:'CDF',CF:'XAF',CG:'XAF',CH:'CHF',CI:'XOF',CK:'NZD',CL:'CLP',CM:'XAF',CN:'CNY',CO:'COP',CR:'CRC',CU:'CUP',CV:'CVE',CW:'ANG',CX:'AUD',CY:'EUR',CZ:'CZK',DE:'EUR',DJ:'DJF',DK:'DKK',DM:'XCD',DO:'DOP',DZ:'DZD',EC:'USD',EE:'EUR',EG:'EGP',EH:'MAD',ER:'ERN',ES:'EUR',ET:'ETB',FI:'EUR',FJ:'FJD',FK:'FKP',FM:'USD',FO:'DKK',FR:'EUR',GA:'XAF',GB:'GBP',GD:'XCD',GE:'GEL',GF:'EUR',GG:'GBP',GH:'GHS',GI:'GIP',GL:'DKK',GM:'GMD',GN:'GNF',GP:'EUR',GQ:'XAF',GR:'EUR',GS:'GBP',GT:'GTQ',GU:'USD',GW:'XOF',GY:'GYD',HK:'HKD',HM:'AUD',HN:'HNL',HR:'HRK',HT:'HTG',HU:'HUF',ID:'IDR',IE:'EUR',IL:'ILS',IM:'GBP',IN:'INR',IO:'USD',IQ:'IQD',IR:'IRR',IS:'ISK',IT:'EUR',JE:'GBP',JM:'JMD',JO:'JOD',JP:'JPY',KE:'KES',KG:'KGS',KH:'KHR',KI:'AUD',KM:'KMF',KN:'XCD',KP:'KPW',KR:'KRW',KW:'KWD',KY:'KYD',KZ:'KZT',LA:'LAK',LB:'LBP',LC:'XCD',LI:'CHF',LK:'LKR',LR:'LRD',LS:'LSL',LT:'EUR',LU:'EUR',LV:'EUR',LY:'LYD',MA:'MAD',MC:'EUR',MD:'MDL',ME:'EUR',MF:'EUR',MG:'MGA',MH:'USD',MK:'MKD',ML:'XOF',MM:'MMK',MN:'MNT',MO:'MOP',MP:'USD',MQ:'EUR',MR:'MRO',MS:'XCD',MT:'EUR',MU:'MUR',MV:'MVR',MW:'MWK',MX:'MXN',MY:'MYR',MZ:'MZN',NA:'NAD',NC:'XPF',NE:'XOF',NF:'AUD',NG:'NGN',NI:'NIO',NL:'EUR',NO:'NOK',NP:'NPR',NR:'AUD',NU:'NZD',NZ:'NZD',OM:'OMR',PA:'PAB',PE:'PEN',PF:'XPF',PG:'PGK',PH:'PHP',PK:'PKR',PL:'PLN',PM:'EUR',PN:'NZD',PR:'USD',PS:'ILS',PT:'EUR',PW:'USD',PY:'PYG',QA:'QAR',RE:'EUR',RO:'RON',RS:'RSD',RU:'RUB',RW:'RWF',SA:'SAR',SB:'SBD',SC:'SCR',SD:'SDG',SE:'SEK',SG:'SGD',SH:'SHP',SI:'EUR',SJ:'NOK',SK:'EUR',SL:'SLL',SM:'EUR',SN:'XOF',SO:'SOS',SR:'SRD',SS:'SSP',ST:'STD',SV:'SVC',SX:'ANG',SY:'SYP',SZ:'SZL',TC:'USD',TD:'XAF',TF:'EUR',TG:'XOF',TH:'THB',TJ:'TJS',TK:'NZD',TL:'USD',TM:'TMT',TN:'TND',TO:'TOP',TR:'TRY',TT:'TTD',TV:'AUD',TW:'TWD',TZ:'TZS',UA:'UAH',UG:'UGX',UM:'USD',US:'USD',UY:'UYU',UZ:'UZS',VA:'EUR',VC:'XCD',VE:'VEF',VG:'USD',VI:'USD',VN:'VND',VU:'VUV',WF:'XPF',WS:'WST',YE:'YER',YT:'EUR',ZA:'ZAR',ZM:'ZMW',ZW:'ZWL'};class x{constructor(e,t,i){this.code=e,this.name=t,this.symbol=i}format(e,t){return new Intl.NumberFormat(t||'en-US',{style:'currency',currency:this.code,minimumFractionDigits:0,maximumFractionDigits:0}).format(e)}}class j{static from(e){return j.values().find((t=>t.code===e.toUpperCase()))}static fromAcceptLanguage(e){return j.fromLocale(W.getPrimaryLocale(e))}static fromLocale(e){return j.from(W.getCurrencyAbbreviation(e))}static values(){return[j.EURO,j.POUND_STERLING,j.UNITED_STATES_DOLLAR]}}j.EURO=new class extends x{constructor(){super('EUR','Euro','')}},j.POUND_STERLING=new class extends x{constructor(){super('GBP','Pound Sterling','')}},j.UNITED_STATES_DOLLAR=new class extends x{constructor(){super('USD','United States Dollar','$')}},function(e){e.DEVELOPMENT='development',e.PRODUCTION='production',e.STAGING='staging'}(M||(M={}));class k{static setActive(e){k.ACTIVE='string'==typeof e?k.from(e):e}static getActive(){var e;return void 0===k.ACTIVE&&((null===(e=null===process||void 0===process?void 0:process.env)||void 0===e?void 0:e.NOTICEABLE_ENV)?k.ACTIVE=k.from(process.env.NOTICEABLE_ENV):k.ACTIVE=M.PRODUCTION),k.ACTIVE}static from(e){return'development'===e?M.DEVELOPMENT:'production'===e?M.PRODUCTION:'staging'===e?M.STAGING:null}}k.ACTIVE=void 0;class F{constructor(e){this.name=e}isSupportedBy(e){return e.includes(this)}}class V{static from(e){for(const t in V)if(t.toString()===e)return V[t];return null}}V.APPEARANCE_CUSTOMIZATION=new F('Appearance Customization'),V.AUTO_REFRESH=new F('Auto-refresh'),V.CODE_INJECTION=new F('Code Injection (CSS & JavaScript)'),V.CROSS_DEVICE_SYNCHRONIZATION=new F('Cross-Device Synchronization'),V.DASHBOARD_SINGLE_SIGN_ON=new F('Dashboard Single Sign-On'),V.DISABLE_NEWSPAGES=new F('Disable Newspages'),V.EMAIL_ACTIVITIES=new F('Email Activities'),V.EMAIL_CUSTOM_DOMAINS=new F('Custom From Email Domain'),V.EMAIL_PREFERENCE_CENTER_WIDGET=new F('Email Preference Center Widget'),V.EMAIL_SENDING=new F('Email Sending'),V.EMAIL_SUBSCRIPTION_FORM_WIDGET=new F('Email Subscription Form Widget'),V.EMOJI_REACTIONS=new F('Emoji Reactions'),V.END_USER_IDENTIFICATION=new F('End-user Identification'),V.END_USER_SINGLE_SIGN_ON=new F('End-user Single Sign-On'),V.EXPIRING_PUBLICATIONS=new F('Expiring Publications'),V.GRAPHQL_API=new F('GraphQL API'),V.IP_FILTERING=new F('IP Access Control'),V.MODAL_WIDGET=new F('Modal Widget'),V.NESTED_LABELS=new F('Nested Labels'),V.NEWSPAGE_CUSTOM_DOMAINS=new F('Newspage Custom Domain with HTTPs'),V.NEWSPAGE_EMBED_WIDGET=new F('Newspage Embed Widget'),V.PINNED_PUBLICATIONS=new F('Pinned Publications'),V.POPUP_WIDGET=new F('Popup Widget'),V.PRIVATE_LABELS=new F('Private Labels'),V.PRIVATE_NEWSPAGES=new F('Private Newspages'),V.PRIVATE_NEWSPAGES_TOKEN_AUTHENTICATION=new F('Proxy-based Authentication'),V.PROJECT_ANALYTICS=new F('Project Analytics'),V.PUBLICATION_ANALYTICS=new F('Publication Analytics'),V.PUBLICATION_COPY_TRANSLATION=new F('Publication Copy Translation'),V.PUBLICATION_SCHEDULING=new F('Publication Scheduling'),V.REDIRECTION_WIDGET=new F('Redirection Widget'),V.SEGMENTATION=new F('Publication Segmentation'),V.SINGLE_OPT_IN_SUBSCRIPTIONS=new F('Single Opt-In Subscriptions'),V.TOP_BANNER_WIDGET=new F('Top Banner Widget'),V.USER_FEEDBACK=new F('User Feedback'),V.WEB_NOTIFICATIONS=new F('Web Notifications'),V.WHITE_LABEL=new F('White Label'),V.ZAPIER_INTEGRATION=new F('Zapier Integration');class H{constructor(e,t,i,n,r){this.currency=e,this.cycle=t,this.id=i,this.tiers=n,this.value=r}isTiered(){return null===this.value||void 0===this.value}}class K{constructor(e,t,i){this.flatAmount=e,this.unitAmount=t,this.upTo=i}}class Y{constructor(e){this.tiers=e}computeGraduatedPrice(e,t){let i=0,n=0,r=e,o=t;for(const e of this.tiers){const t=null===e.upTo||void 0===e.upTo?Number.MAX_SAFE_INTEGER:e.upTo,a=r<n||r>t;if(n=t,a){if(o>0)continue;break}const s=r+o>t?t-r:o;i+=s*e.unitAmount,r+=s,o-=s}return i}}class z{static load(e){var t,i;const n=new Map,r=new Map;for(const o of U[e].prices.data){const e=o.product.id,a=null!==(t=j.from(o.currency))&&void 0!==t?t:j.UNITED_STATES_DOLLAR,s=null!==(i=B.from(o.recurring.interval))&&void 0!==i?i:G.MONTH,c=o.unit_amount_decimal?parseFloat(o.unit_amount_decimal)/100:null,l=o.tiers?new Y(o.tiers.map((e=>new K(e.flat_amount_decimal?parseFloat(e.flat_amount_decimal)/100:null,e.unit_amount_decimal?parseFloat(e.unit_amount_decimal)/100:null,e.up_to)))):null;let u=n.get(e);u||(u=new Map);const d=new H(a,s,o.id,l,c);u.set(o.id,d),n.set(e,u);let _=r.get(e);_||(_=new Map);let h=_.get(a);h||(h=new Map),h.set(s,d),_.set(a,h),r.set(e,_)}return{pricesById:n,pricesByCurrency:r}}constructor(e){this.productId=e}findById(e){var t;return null===(t=z.getPricesById().get(this.productId))||void 0===t?void 0:t.get(e)}findByCurrencyCycle(e,t){var i;const n=null===(i=z.getPricesByCurrency().get(this.productId))||void 0===i?void 0:i.get(e);return n?n.get(t):null}values(){return Array.from(z.getPricesById().get(this.productId).values())}static getPricesByCurrency(){if(k.getActive()===M.PRODUCTION){if(void 0===z.PRODUCTION_PRICES_BY_CURRENCY){const e=z.load(M.PRODUCTION);z.PRODUCTION_PRICES_BY_ID=e.pricesById,z.PRODUCTION_PRICES_BY_CURRENCY=e.pricesByCurrency}return z.PRODUCTION_PRICES_BY_CURRENCY}if(void 0===z.STAGING_PRICES_BY_CURRENCY){const e=z.load(M.STAGING);z.STAGING_PRICES_BY_ID=e.pricesById,z.STAGING_PRICES_BY_CURRENCY=e.pricesByCurrency}return z.STAGING_PRICES_BY_CURRENCY}static getPricesById(){if(k.getActive()===M.PRODUCTION){if(void 0===z.PRODUCTION_PRICES_BY_ID){const e=z.load(M.PRODUCTION);z.PRODUCTION_PRICES_BY_ID=e.pricesById,z.PRODUCTION_PRICES_BY_CURRENCY=e.pricesByCurrency}return z.PRODUCTION_PRICES_BY_ID}if(void 0===z.STAGING_PRICES_BY_ID){const e=z.load(M.STAGING);z.STAGING_PRICES_BY_ID=e.pricesById,z.STAGING_PRICES_BY_CURRENCY=e.pricesByCurrency}return z.STAGING_PRICES_BY_ID}}class J{constructor(e,t,i){this.id=e,this.metadata=i,this.prices=new z(e),this.slug=(null==i?void 0:i.slug)||t.toLocaleLowerCase().replace(/ /g,'-'),this.title=t}isFree(){return this.prices.values().every((e=>0===e.value))}}class Z{static load(){const e=new Map,t=new Map;for(const i of U[k.getActive()].products.data){const n=new J(i.id,i.name,i.metadata);e.set(i.id,n),t.set(n.slug,n)}return{productsById:e,productsBySlug:t}}static getProductsById(){if(k.getActive()===M.PRODUCTION){if(void 0===Z.PRODUCTION_PRODUCTS_BY_ID){const e=Z.load();Z.PRODUCTION_PRODUCTS_BY_ID=e.productsById,Z.PRODUCTION_PRODUCTS_BY_SLUG=e.productsBySlug}return Z.PRODUCTION_PRODUCTS_BY_ID}if(void 0===Z.STAGING_PRODUCTS_BY_ID){const e=Z.load();Z.STAGING_PRODUCTS_BY_ID=e.productsById,Z.STAGING_PRODUCTS_BY_SLUG=e.productsBySlug}return Z.STAGING_PRODUCTS_BY_ID}static getProductsBySlug(){if(k.getActive()===M.PRODUCTION){if(void 0===Z.PRODUCTION_PRODUCTS_BY_SLUG){const e=Z.load();Z.PRODUCTION_PRODUCTS_BY_ID=e.productsById,Z.PRODUCTION_PRODUCTS_BY_SLUG=e.productsBySlug}return Z.PRODUCTION_PRODUCTS_BY_SLUG}if(void 0===Z.STAGING_PRODUCTS_BY_SLUG){const e=Z.load();Z.STAGING_PRODUCTS_BY_ID=e.productsById,Z.STAGING_PRODUCTS_BY_SLUG=e.productsBySlug}return Z.STAGING_PRODUCTS_BY_SLUG}static get EMAILS(){return Z.getProductsBySlug().get('emails')}static get EXTRA_COLLABORATOR(){return Z.getProductsBySlug().get('extra-collaborator')}static get EXTRA_PROJECT(){return Z.getProductsBySlug().get('extra-project')}static get EXTRA_WIDGET(){return Z.getProductsBySlug().get('extra-widget')}static find(e){return Z.getProductsById().get(e)}static findBySlug(e){return Z.getProductsBySlug().get(e)}static getPlans(){return Array.from(this.getProductsById().values()).filter((e=>{var t;return'true'===(null===(t=e.metadata)||void 0===t?void 0:t.plan)}))}static values(){return[...this.getProductsById().values()]}}class X{constructor(e){this.name=e}}class q{constructor(e,t){this.quota=e,this.value=t}}class Q{constructor(...e){this.limits=new Map;for(const t of e)this.limits.set(t.quota,t)}get(e){return this.limits.get(e)}}class ${static getLimits(e){const t=e.items.data;let i=0,n=0,r=0,o=0;for(const e of t)try{const t=e.price.product,a=ce.find(t,null);if(null!==a)i+=a.getQuotaLimit($.ORGANIZATION_ACCESS_TOKENS).value,n+=a.getQuotaLimit($.ORGANIZATION_PROJECTS).value,r+=a.getQuotaLimit($.PROJECT_COLLABORATORS).value,o+=a.getQuotaLimit($.PROJECT_WIDGETS).value;else{const i=Z.find(t);i===Z.findBySlug('extra-collaborator')?r+=e.quantity:i===Z.findBySlug('extra-project')?n+=e.quantity:i===Z.findBySlug('extra-widget')&&(o+=e.quantity)}}catch(e){console.error(e)}return new Q(new q($.ORGANIZATION_ACCESS_TOKENS,i),new q($.ORGANIZATION_PROJECTS,n),new q($.PROJECT_COLLABORATORS,r),new q($.PROJECT_WIDGETS,o))}}$.ORGANIZATION_ACCESS_TOKENS=new X('accessTokens'),$.ORGANIZATION_PROJECTS=new X('projects'),$.PROJECT_COLLABORATORS=new X('collaborators'),$.PROJECT_WIDGETS=new X('widgets');class ee extends J{constructor(e,t,i,n,r,o,a){super(e,t,i),this.description=n,this.features=new Set,r.forEach((e=>{this.features.add(e)})),this.hidden='true'===(null==i?void 0:i.hidden),this.quicklist=o,this.trialPeriodDays=this.hidden||'free'===this.slug?0:14,this.quotaLimits=new Map,a.forEach((e=>{this.quotaLimits.set(e.quota,e)}))}getQuotaLimit(e){return this.quotaLimits.get(e)}includes(e){let t;return t='string'==typeof e?V.from(e):e,this.features.has(t)}}class te extends ee{constructor(e,t){super(e,'Academic',t,'Ideal for Academic organizations',[V.APPEARANCE_CUSTOMIZATION,V.NEWSPAGE_CUSTOM_DOMAINS,V.EMOJI_REACTIONS,V.MODAL_WIDGET,V.NEWSPAGE_EMBED_WIDGET,V.POPUP_WIDGET,V.PROJECT_ANALYTICS,V.PUBLICATION_ANALYTICS,V.PUBLICATION_SCHEDULING,V.ZAPIER_INTEGRATION],['<strong>1</strong> project','<strong>2</strong> widgets per project','<strong>2</strong> collaborators per project','Publication analytics','Publication scheduling','Emoji reactions','Custom domain with HTTPS','Noticeable watermark','Zapier integrations','Lovely support'],[new q($.ORGANIZATION_ACCESS_TOKENS,2),new q($.ORGANIZATION_PROJECTS,1),new q($.PROJECT_COLLABORATORS,2),new q($.PROJECT_WIDGETS,2)])}}class ie extends ee{constructor(e,t){super(e,'Business',t,'Ideal for companies requiring a full-featured solution',[V.APPEARANCE_CUSTOMIZATION,V.AUTO_REFRESH,V.CODE_INJECTION,V.CROSS_DEVICE_SYNCHRONIZATION,V.DISABLE_NEWSPAGES,V.EMAIL_ACTIVITIES,V.EMAIL_CUSTOM_DOMAINS,V.EMAIL_PREFERENCE_CENTER_WIDGET,V.EMAIL_SENDING,V.EMAIL_SUBSCRIPTION_FORM_WIDGET,V.EMOJI_REACTIONS,V.END_USER_IDENTIFICATION,V.END_USER_SINGLE_SIGN_ON,V.EXPIRING_PUBLICATIONS,V.GRAPHQL_API,V.MODAL_WIDGET,V.NESTED_LABELS,V.NEWSPAGE_CUSTOM_DOMAINS,V.NEWSPAGE_EMBED_WIDGET,V.PINNED_PUBLICATIONS,V.POPUP_WIDGET,V.PRIVATE_LABELS,V.PRIVATE_NEWSPAGES,V.PROJECT_ANALYTICS,V.PUBLICATION_ANALYTICS,V.PUBLICATION_SCHEDULING,V.REDIRECTION_WIDGET,V.SEGMENTATION,V.SINGLE_OPT_IN_SUBSCRIPTIONS,V.TOP_BANNER_WIDGET,V.USER_FEEDBACK,V.WEB_NOTIFICATIONS,V.WHITE_LABEL,V.ZAPIER_INTEGRATION],['<strong>3</strong> projects','<strong>3</strong> widgets per project','<strong>5</strong> collaborators per project','Auto-refresh (Newspage and Widgets)','Code injection (CSS & JavaScript)','Custom domain for sending emails','Private labels','Cross-Device Synchronization','Private Newspages','Segmentation','User feedback','Priority support'],[new q($.ORGANIZATION_ACCESS_TOKENS,5),new q($.ORGANIZATION_PROJECTS,3),new q($.PROJECT_COLLABORATORS,5),new q($.PROJECT_WIDGETS,3)])}}class ne extends ee{constructor(e,t){super(e,'Enterprise',t,'Ideal for companies with advanced needs',[V.APPEARANCE_CUSTOMIZATION,V.AUTO_REFRESH,V.CODE_INJECTION,V.CROSS_DEVICE_SYNCHRONIZATION,V.DASHBOARD_SINGLE_SIGN_ON,V.DISABLE_NEWSPAGES,V.EMAIL_ACTIVITIES,V.EMAIL_CUSTOM_DOMAINS,V.EMAIL_PREFERENCE_CENTER_WIDGET,V.EMAIL_SENDING,V.EMAIL_SUBSCRIPTION_FORM_WIDGET,V.EMOJI_REACTIONS,V.END_USER_IDENTIFICATION,V.END_USER_SINGLE_SIGN_ON,V.EXPIRING_PUBLICATIONS,V.GRAPHQL_API,V.IP_FILTERING,V.MODAL_WIDGET,V.NESTED_LABELS,V.NEWSPAGE_CUSTOM_DOMAINS,V.NEWSPAGE_EMBED_WIDGET,V.PINNED_PUBLICATIONS,V.POPUP_WIDGET,V.PRIVATE_LABELS,V.PRIVATE_NEWSPAGES,V.PRIVATE_NEWSPAGES_TOKEN_AUTHENTICATION,V.PROJECT_ANALYTICS,V.PUBLICATION_ANALYTICS,V.PUBLICATION_COPY_TRANSLATION,V.PUBLICATION_SCHEDULING,V.REDIRECTION_WIDGET,V.SEGMENTATION,V.SINGLE_OPT_IN_SUBSCRIPTIONS,V.TOP_BANNER_WIDGET,V.USER_FEEDBACK,V.WEB_NOTIFICATIONS,V.WHITE_LABEL,V.ZAPIER_INTEGRATION],['Custom number of projects and widgets','Unlimited collaborators','Unlimited publications','Single Sign-On (OIDC or SAML)','Bank wire transfers','Payment by invoice/PO','Assisted installation','24/7 support'],[new q($.ORGANIZATION_ACCESS_TOKENS,10),new q($.ORGANIZATION_PROJECTS,5),new q($.PROJECT_COLLABORATORS,-1),new q($.PROJECT_WIDGETS,5)])}}class re extends ee{constructor(e,t){super(e,'Free',t,'Ideal for getting started',[V.MODAL_WIDGET,V.NEWSPAGE_EMBED_WIDGET,V.POPUP_WIDGET],['<strong>1</strong> project','<strong>1</strong> in-app widget','Public Newspage','Custom labels','Internationalization (Newspage and Widgets)','Noticeable watermark'],[new q($.ORGANIZATION_ACCESS_TOKENS,1),new q($.ORGANIZATION_PROJECTS,1),new q($.PROJECT_COLLABORATORS,1),new q($.PROJECT_WIDGETS,1)])}}class oe extends ee{constructor(e,t){super(e,'Growth',t,'Ideal for growing brands',[V.APPEARANCE_CUSTOMIZATION,V.DISABLE_NEWSPAGES,V.EMAIL_ACTIVITIES,V.EMAIL_SENDING,V.EMAIL_SUBSCRIPTION_FORM_WIDGET,V.EMOJI_REACTIONS,V.END_USER_IDENTIFICATION,V.END_USER_SINGLE_SIGN_ON,V.EXPIRING_PUBLICATIONS,V.GRAPHQL_API,V.MODAL_WIDGET,V.NEWSPAGE_CUSTOM_DOMAINS,V.NEWSPAGE_EMBED_WIDGET,V.PINNED_PUBLICATIONS,V.POPUP_WIDGET,V.PROJECT_ANALYTICS,V.PUBLICATION_ANALYTICS,V.PUBLICATION_SCHEDULING,V.REDIRECTION_WIDGET,V.TOP_BANNER_WIDGET,V.WHITE_LABEL,V.ZAPIER_INTEGRATION],['<strong>2</strong> projects','<strong>2</strong> widgets per project','<strong>3</strong> collaborators per project','Expiring publications','GraphQL API','Pinned publications','Publication analytics','Publication scheduling','Emoji reactions'],[new q($.ORGANIZATION_ACCESS_TOKENS,3),new q($.ORGANIZATION_PROJECTS,2),new q($.PROJECT_COLLABORATORS,3),new q($.PROJECT_WIDGETS,2)])}}class ae extends ee{constructor(e,t){super(e,'Open Source',t,'Ideal for Open Source organizations',[V.APPEARANCE_CUSTOMIZATION,V.NEWSPAGE_CUSTOM_DOMAINS,V.EMOJI_REACTIONS,V.MODAL_WIDGET,V.NEWSPAGE_EMBED_WIDGET,V.POPUP_WIDGET,V.PROJECT_ANALYTICS,V.PUBLICATION_ANALYTICS,V.PUBLICATION_SCHEDULING,V.ZAPIER_INTEGRATION],['<strong>1</strong> project','<strong>2</strong> widgets per project','<strong>2</strong> collaborators per project','Publication analytics','Publication scheduling','Emoji reactions','Custom domain with HTTPS','Noticeable watermark','Zapier integrations','Lovely support'],[new q($.ORGANIZATION_ACCESS_TOKENS,2),new q($.ORGANIZATION_PROJECTS,1),new q($.PROJECT_COLLABORATORS,2),new q($.PROJECT_WIDGETS,2)])}}class se extends ee{constructor(e,t){super(e,'Starter',t,'Ideal for individuals',[V.APPEARANCE_CUSTOMIZATION,V.NEWSPAGE_CUSTOM_DOMAINS,V.DISABLE_NEWSPAGES,V.EMAIL_SENDING,V.EMAIL_SUBSCRIPTION_FORM_WIDGET,V.MODAL_WIDGET,V.NEWSPAGE_EMBED_WIDGET,V.POPUP_WIDGET,V.PROJECT_ANALYTICS,V.REDIRECTION_WIDGET,V.TOP_BANNER_WIDGET,V.WHITE_LABEL,V.ZAPIER_INTEGRATION],['<strong>1</strong> project','<strong>1</strong> in-app widget','Appearance customization','Email sending (additional fee per dispatch)','Newspage custom domain with HTTPS','Noticeable branding removal','Project analytics','Support','Unlimited views','Zapier integrations'],[new q($.ORGANIZATION_ACCESS_TOKENS,2),new q($.ORGANIZATION_PROJECTS,1),new q($.PROJECT_COLLABORATORS,1),new q($.PROJECT_WIDGETS,1)])}}class ce{static get ACADEMIC(){return ce.getPlansBySlug().get('academic')}static get BUSINESS(){return ce.getPlansBySlug().get('business')}static get ENTERPRISE(){return ce.getPlansBySlug().get('enterprise')}static get FREE(){return ce.getPlansBySlug().get('free')}static get GROWTH(){return ce.getPlansBySlug().get('growth')}static get OPENSOURCE(){return ce.getPlansBySlug().get('opensource')}static get STARTER(){return ce.getPlansBySlug().get('starter')}static find(e,t=ce.FREE){if(!e)return t;const i=ce.getPlansById().get(e);return i||t}static findBySlug(e,t=ce.FREE){if(!e)return t;const i=ce.getPlansBySlug().get(e);return i||t}static include(e,t=!1){return Array.from(ce.getPlansById().values()).filter((i=>i.hidden===t&&i.includes(e))).sort(((e,t)=>e.prices.findByCurrencyCycle(j.UNITED_STATES_DOLLAR,G.MONTH).value-t.prices.findByCurrencyCycle(j.UNITED_STATES_DOLLAR,G.MONTH).value))}static isPlan(e){return ce.getPlansById().has(e)}static values(){return Array.from(ce.getPlansById().values())}static getPlansById(){if(k.getActive()===M.PRODUCTION){if(void 0===ce.PRODUCTION_PLANS_BY_ID){const e=ce.load();ce.PRODUCTION_PLANS_BY_ID=e.plansById,ce.PRODUCTION_PLANS_BY_SLUG=e.plansBySlug}return ce.PRODUCTION_PLANS_BY_ID}if(void 0===ce.STAGING_PLANS_BY_ID){const e=ce.load();ce.STAGING_PLANS_BY_ID=e.plansById,ce.STAGING_PLANS_BY_SLUG=e.plansBySlug}return ce.STAGING_PLANS_BY_ID}static getPlansBySlug(){if(k.getActive()===M.PRODUCTION){if(void 0===ce.PRODUCTION_PLANS_BY_SLUG){const e=ce.load();ce.PRODUCTION_PLANS_BY_ID=e.plansById,ce.PRODUCTION_PLANS_BY_SLUG=e.plansBySlug}return ce.PRODUCTION_PLANS_BY_SLUG}if(void 0===ce.STAGING_PLANS_BY_SLUG){const e=ce.load();ce.STAGING_PLANS_BY_ID=e.plansById,ce.STAGING_PLANS_BY_SLUG=e.plansBySlug}return ce.STAGING_PLANS_BY_SLUG}static load(){var e;const t=new Map,i=new Map;for(const n of Z.getPlans()){switch(null===(e=n.metadata)||void 0===e?void 0:e.slug){case'academic':ce.add(n,new te(n.id,n.metadata),t,i);break;case'business':ce.add(n,new ie(n.id,n.metadata),t,i);break;case'enterprise':ce.add(n,new ne(n.id,n.metadata),t,i);break;case'free':ce.add(n,new re(n.id,n.metadata),t,i);break;case'growth':ce.add(n,new oe(n.id,n.metadata),t,i);break;case'opensource':ce.add(n,new ae(n.id,n.metadata),t,i);break;case'starter':ce.add(n,new se(n.id,n.metadata),t,i)}}return{plansById:t,plansBySlug:i}}static add(e,t,i,n){i.set(e.id,t),n.set(t.slug,t)}}class le extends Set{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;super(),n(this,'capacity',void 0),this.capacity=e}add(e){return 0===this.capacity||super.has(e)?this:(super.size<this.capacity||super.delete(this.values().next().value),super.add(e))}addAll(e){if(0===this.capacity)return this;for(const t of e)super.add(t);const t=this.values();for(;super.size>this.capacity;)super.delete(t.next().value);return this}toArray(){return Array.from(this)}}class ue extends le{constructor(e){super(99),e&&e.length>0&&this.addAll(e)}}var de={},_e={},he={};Object.defineProperty(he,'__esModule',{value:!0}),he.formatCookie=void 0;var pe=function(e){var t=e.path,i=e.domain,n=e.expires,r=e.secure,o=function(e){var t=e.sameSite;return void 0===t?null:['none','lax','strict'].indexOf(t.toLowerCase())>=0?t:null}(e);return[null==t?'':';path='+t,null==i?'':';domain='+i,null==n?'':';expires='+n.toUTCString(),void 0===r||!1===r?'':';secure',null===o?'':';SameSite='+o].join('')};he.formatCookie=function(e,t,i){return[encodeURIComponent(e),'=',encodeURIComponent(t),pe(i)].join('')};var ge={};function me(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if('undefined'==typeof Symbol||!(Symbol.iterator in Object(e)))return;var i=[],n=!0,r=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(i.push(a.value),!t||i.length!==t);n=!0);}catch(e){r=!0,o=e}finally{try{n||null==s.return||s.return()}finally{if(r)throw o}}return i}(e,t)||function(e,t){if(!e)return;if('string'==typeof e)return fe(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);'Object'===i&&e.constructor&&(i=e.constructor.name);if('Map'===i||'Set'===i)return Array.from(e);if('Arguments'===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return fe(e,t)}(e,t)||function(){throw new TypeError('Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.')}()}function fe(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}Object.defineProperty(ge,'__esModule',{value:!0}),ge.parseCookies=void 0;function ye(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,'value'in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}ge.parseCookies=function(e){if(0===e.length)return{};var t={},i=new RegExp('\\s*;\\s*');return e.split(i).forEach((function(e){var i=me(e.split('='),2),n=i[0],r=i[1],o=decodeURIComponent(n),a=decodeURIComponent(r);t[o]=a})),t},Object.defineProperty(_e,'__esModule',{value:!0}),_e.CookieStorage=void 0;var ve=he,Ee=ge,Ie=function(){function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}(this,e),this._defaultOptions=Object.assign({domain:null,expires:null,path:null,secure:!1},t),'undefined'!=typeof Proxy)return new Proxy(this,we)}var t,i,n;return t=e,(i=[{key:'clear',value:function(){var e=this,t=Ee.parseCookies(this._getCookie());Object.keys(t).forEach((function(t){return e.removeItem(t)}))}},{key:'getItem',value:function(e){var t=Ee.parseCookies(this._getCookie());return Object.prototype.hasOwnProperty.call(t,e)?t[e]:null}},{key:'key',value:function(e){var t=Ee.parseCookies(this._getCookie()),i=Object.keys(t).sort();return e<i.length?i[e]:null}},{key:'removeItem',value:function(e,t){var i=Object.assign(Object.assign(Object.assign({},this._defaultOptions),t),{expires:new Date(0)}),n=ve.formatCookie(e,'',i);this._setCookie(n)}},{key:'setItem',value:function(e,t,i){var n=Object.assign(Object.assign({},this._defaultOptions),i),r=ve.formatCookie(e,t,n);this._setCookie(r)}},{key:'_getCookie',value:function(){return'undefined'==typeof document||void 0===document.cookie?'':document.cookie}},{key:'_setCookie',value:function(e){document.cookie=e}},{key:'length',get:function(){var e=Ee.parseCookies(this._getCookie());return Object.keys(e).length}}])&&ye(t.prototype,i),n&&ye(t,n),e}();_e.CookieStorage=Ie;var we={defineProperty:function(e,t,i){return e.setItem(t.toString(),String(i.value)),!0},deleteProperty:function(e,t){return e.removeItem(t.toString()),!0},get:function(e,t,i){if('string'==typeof t&&t in e)return e[t];var n=e.getItem(t.toString());return null!==n?n:void 0},getOwnPropertyDescriptor:function(e,t){if(!(t in e))return{configurable:!0,enumerable:!0,value:e.getItem(t.toString()),writable:!0}},has:function(e,t){return'string'==typeof t&&t in e||null!==e.getItem(t.toString())},ownKeys:function(e){for(var t=[],i=0;i<e.length;i++){var n=e.key(i);null!==n&&t.push(n)}return t},preventExtensions:function(e){throw new TypeError('can\'t prevent extensions on this proxy object')},set:function(e,t,i,n){return e.setItem(t.toString(),String(i)),!0}};!function(e){Object.defineProperty(e,'__esModule',{value:!0});var t=_e;Object.defineProperty(e,'CookieStorage',{enumerable:!0,get:function(){return t.CookieStorage}});var i=he;Object.defineProperty(e,'formatCookie',{enumerable:!0,get:function(){return i.formatCookie}});var n=ge;Object.defineProperty(e,'parseCookies',{enumerable:!0,get:function(){return n.parseCookies}})}(de);var be={},Te=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,'value'in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();var Se=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}(this,e),this._keys=[],this._memory={}}return Te(e,[{key:'clear',value:function(){this._memory={},this._keys=[]}},{key:'getItem',value:function(e){return this._memory.hasOwnProperty(e)?this._memory[e]:null}},{key:'key',value:function(e){var t=this._keys[e];return void 0===t?null:t}},{key:'removeItem',value:function(e){delete this._memory[e];var t=this._keys.indexOf(e);t<0||this._keys.splice(t,1)}},{key:'setItem',value:function(e,t){this._memory[e]=t,this._keys.indexOf(e)<0&&this._keys.push(e)}},{key:'length',get:function(){return this._keys.length}}]),e}();be.SimpleMemoryStorage=Se;var Oe=be.SimpleMemoryStorage;class Ce{constructor(e,t){n(this,'lastPublicationRead',void 0),n(this,'lastPublicationSeen',void 0),this.lastPublicationRead=e,this.lastPublicationSeen=t}}class Ae{static _hasStorage(e){try{const t=window[e],i='__noticeable_storage_test';t.setItem(i,'1');const n=t.getItem(i);return t.removeItem(i),'1'===n}catch(e){return!1}}static _storage(){return window.noticeable._preferences.firstPartyCookies.localStorage?Ae._hasStorage('localStorage')?window.localStorage:Ae._hasStorage('sessionStorage')?window.sessionStorage:new Oe:new de.CookieStorage({expires:new Date(Date.now()+window.noticeable._preferences.firstPartyCookies.retentionPeriod),sameSite:'Lax'})}static deleteUserId(e){Ae.COOKIE_STORAGE.removeItem('noticeable_uid_'+e)}static deleteUserSsoToken(e){Ae.COOKIE_STORAGE.removeItem('noticeable_usso_'+e)}static deleteAllUserTraits(){for(const e in sessionStorage){const t=e.split('_');3===t.length&&'noticeable'===t[0]&&'traits'===t[1]&&sessionStorage.removeItem(e)}}static deletePublicationReadSeen(e){const t=Ae._storage();for(const i in t)(e||!i.startsWith('noticeable_lpr_')&&!i.startsWith('noticeable_lps_'))&&(!e||i!=='noticeable_lpr_'.concat(e)&&i!=='noticeable_lps_'.concat(e))||t.removeItem(i)}static deleteUserTraits(e){sessionStorage.removeItem('noticeable_traits_'+e)}static getProjectStates(){const e=new Map,t=Ae._storage();for(const i in t){const n=i.split('_');let r;if(3===n.length&&'noticeable'===n[0])if('lpr'===n[1]){r=n[2];const o=Ae.getOrCreateProjectState(e,r),a=t.getItem(i);a&&(o.lastPublicationRead=new ue(JSON.parse(a)))}else if('lps'===n[1]){r=n[2];const o=Ae.getOrCreateProjectState(e,r),a=t.getItem(i);a&&(o.lastPublicationSeen=new ue(JSON.parse(a)))}}return e}static getOrCreateProjectState(e,t){let i=e.get(t);return i||(i=new Ce(new ue,new ue),e.set(t,i)),i}static getPublicationRead(e){const t=Ae._storage().getItem('noticeable_lpr_'.concat(e));return t?new ue(JSON.parse(t)):new Set}static getPublicationSeen(e){const t=Ae._storage().getItem('noticeable_lps_'.concat(e));return t?new ue(JSON.parse(t)):new Set}static getUserId(e){return Ae.COOKIE_STORAGE.getItem('noticeable_uid_'+e)}static getUserIds(){return this._getIdCookieValueByProject('noticeable_uid')}static getUserSsoTokens(){return this._getIdCookieValueByProject('noticeable_usso')}static getAllUserTraits(){const e=new Map;for(const t in sessionStorage){const i=t.split('_');if(3===i.length&&'noticeable'===i[0]&&'traits'===i[1]){const n=sessionStorage.getItem(t);n&&e.set(i[2],JSON.parse(n))}}return e}static getUserTraits(e){const t=sessionStorage.getItem('noticeable_traits_'+e);return t?JSON.parse(t):{}}static _getIdCookieValueByProject(e){const t=Ae.COOKIE_STORAGE,i=new Map;for(const n in t)if(n.startsWith(e)){const e=n.split('_');3===e.length&&i.set(e[2],t[n])}return i}static reset(e){if(this.deletePublicationReadSeen(e),e)this.deleteUserId(e),this.deleteUserTraits(e);else{for(const e in Ae.COOKIE_STORAGE)e.startsWith('noticeable_uid_')&&Ae.COOKIE_STORAGE.removeItem(e);this.deleteAllUserTraits()}}static setPublicationSeen(e,t){Ae._storage().setItem('noticeable_lps_'.concat(e),JSON.stringify(t.toArray()))}static setPublicationRead(e,t){Ae._storage().setItem('noticeable_lpr_'.concat(e),JSON.stringify(t.toArray()))}static setUserId(e,t){Ae.COOKIE_STORAGE.setItem('noticeable_uid_'+e,t,{expires:new Date(Date.now()+window.noticeable._preferences.firstPartyCookies.retentionPeriod),sameSite:'None',secure:!0})}static setUserSsoToken(e,t){Ae.COOKIE_STORAGE.setItem('noticeable_usso_'+e,t,{expires:new Date(Date.now()+window.noticeable._preferences.firstPartyCookies.retentionPeriod),sameSite:'None',secure:!0})}static setUserTraits(e,t){t&&0!==Object.keys(t).length?sessionStorage.setItem('noticeable_traits_'+e,JSON.stringify(t)):sessionStorage.removeItem('noticeable_traits_'+e)}}let Ne;n(Ae,'COOKIE_STORAGE',new de.CookieStorage);const Re=new Uint8Array(16);function De(){if(!Ne&&(Ne='undefined'!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Ne))throw new Error('crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported');return Ne(Re)}const Pe=[];for(let e=0;e<256;++e)Pe.push((e+256).toString(16).slice(1));var Le={randomUUID:'undefined'!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function Ue(e,t,i){if(Le.randomUUID&&!t&&!e)return Le.randomUUID();const n=(e=e||{}).random||(e.rng||De)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){i=i||0;for(let e=0;e<16;++e)t[i+e]=n[e];return t}return function(e,t=0){return Pe[e[t+0]]+Pe[e[t+1]]+Pe[e[t+2]]+Pe[e[t+3]]+'-'+Pe[e[t+4]]+Pe[e[t+5]]+'-'+Pe[e[t+6]]+Pe[e[t+7]]+'-'+Pe[e[t+8]]+Pe[e[t+9]]+'-'+Pe[e[t+10]]+Pe[e[t+11]]+Pe[e[t+12]]+Pe[e[t+13]]+Pe[e[t+14]]+Pe[e[t+15]]}(n)}class Ge{constructor(e,t){n(this,'_dataRepository',void 0),n(this,'_lastPublicationRead',void 0),n(this,'_lastPublicationSeen',void 0),n(this,'_pendingIdentityUpdates',void 0),n(this,'_preferences',void 0),n(this,'_userIds',void 0),n(this,'_userSsoTokens',void 0),n(this,'_userTraits',void 0),this._dataRepository=e,this._lastPublicationRead=new Map,this._lastPublicationSeen=new Map,this._pendingIdentityUpdates=new Map,this._preferences=t,this._userIds=new Map,this._userSsoTokens=new Map,this._userTraits=new Map}initialize(){for(const[e,t]of Ae.getUserIds())this._userIds.set(e,t);for(const[e,t]of Ae.getUserSsoTokens())this._userSsoTokens.set(e,t);for(const[e,t]of Ae.getAllUserTraits())this._userTraits.set(e,t);const e=Ae.getProjectStates();for(const[t,i]of e.entries())this._lastPublicationRead.set(t,i.lastPublicationRead),this._lastPublicationSeen.set(t,i.lastPublicationSeen)}clearLastPublicationRead(){this._lastPublicationRead.clear()}clearLastPublicationSeen(){this._lastPublicationSeen.clear()}createOrExtendUserId(e){const t=this._userIds.get(e);if(t)Ae.setUserId(e,t);else{const t=Ue();this._userIds.set(e,t),Ae.setUserId(e,t)}}async setLastPublicationRead(e,t,i){var n;const r=null!==(n=this._lastPublicationRead.get(e))&&void 0!==n?n:new ue;return i.merge||r.clear(),r.addAll(t),this._lastPublicationRead.set(e,r),Ae.setPublicationRead(e,r),r.size>0&&await this._remoteStateUpdate(e,t,null,!i.merge,!1),r}async setLastPublicationSeen(e,t,i){var n;const r=null!==(n=this._lastPublicationSeen.get(e))&&void 0!==n?n:new ue;return i.merge||r.clear(),r.addAll(t),this._lastPublicationSeen.set(e,r),Ae.setPublicationSeen(e,r),r.size>0&&await this._remoteStateUpdate(e,null,t,!1,!i.merge),r}async remoteIdentityUpdate(e){if(this.createOrExtendUserId(e),await this._isIdentifyAvailable(e)){l.debug('Calling identify for project '.concat(e));try{var i,n,r,o,a,s;const _={},h=this._userTraits.get(e),p=this._userSsoTokens.get(e);var c,u,d;if(p)_.s=p;else _.t={a:null!==(c=null==h?void 0:h.avatarUrl)&&void 0!==c?c:null==h?void 0:h.avatar,d:null!==(u=null==h?void 0:h.displayName)&&void 0!==u?u:null==h?void 0:h.name,e:null==h?void 0:h.email,f:null==h?void 0:h.firstName,i:null!==(d=null==h?void 0:h.id)&&void 0!==d?d:this._userIds.get(e),l:null==h?void 0:h.lastName};const g=await fetch('https://pipeline.noticeable.io/i',{method:'POST',headers:{'content-type':'application/json'},body:JSON.stringify(t({p:e},_))}),m=await g.json();if(!g.ok)return void l.error('Identification failed. '.concat(m.message,' (').concat(m.code,')'));await this.setLastPublicationReadSeen(e,new ue(m.lpr),new ue(m.lps),!0,!0,!1);const f={avatarUrl:null===(i=m.t)||void 0===i?void 0:i.a,displayName:null===(n=m.t)||void 0===n?void 0:n.d,email:null===(r=m.t)||void 0===r?void 0:r.e,firstName:null===(o=m.t)||void 0===o?void 0:o.f,id:null===(a=m.t)||void 0===a?void 0:a.i,lastName:null===(s=m.t)||void 0===s?void 0:s.l};this._userTraits.set(e,f),Ae.setUserTraits(e,f)}catch(e){l.error('Error while calling identify endpoint',e)}}}getLastPublicationRead(e){var t;return null!==(t=this._lastPublicationRead.get(e))&&void 0!==t?t:new ue}getLastPublicationSeen(e){var t;return null!==(t=this._lastPublicationSeen.get(e))&&void 0!==t?t:new ue}getPendingIdentityUpdate(e){return this._pendingIdentityUpdates.get(e)}getUserId(e){return this._userIds.get(e)}getUserSsoToken(e){return this._userSsoTokens.get(e)}getUserTraits(e){return this._userTraits.get(e)}isRead(e,t){const i=this._lastPublicationRead.get(e);return!!i&&i.has(t)}isSeen(e,t){const i=this._lastPublicationSeen.get(e);return!!i&&i.has(t)}reset(e){if(Ae.reset(e),e)this._lastPublicationRead.delete(e),this._lastPublicationSeen.delete(e),this._userIds.delete(e),this._userSsoTokens.delete(e),this._userTraits.delete(e),this.createOrExtendUserId(e);else{const e=new Set(this._userIds.keys());this._lastPublicationRead.clear(),this._lastPublicationSeen.clear(),this._userIds.clear(),this._userSsoTokens.clear(),this._userTraits.clear();for(const t of e)this.createOrExtendUserId(t)}}async setLastPublicationReadSeen(e,t,i,n,r){let o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];if(t)if(n)this._lastPublicationRead.set(e,t),Ae.setPublicationRead(e,t);else{var a;const i=null!==(a=this._lastPublicationRead.get(e))&&void 0!==a?a:new ue;i.addAll(t.toArray()),this._lastPublicationRead.set(e,i),Ae.setPublicationRead(e,i)}if(i)if(r)this._lastPublicationSeen.set(e,i),Ae.setPublicationSeen(e,i);else{var s;const t=null!==(s=this._lastPublicationSeen.get(e))&&void 0!==s?s:new ue;t.addAll(i.toArray()),this._lastPublicationSeen.set(e,t),Ae.setPublicationSeen(e,t)}if(o)return this._remoteStateUpdate(e,t.toArray(),i.toArray(),n,r)}async update(e,t){if(this._pendingIdentityUpdates.has(e))return void l.warn('Skipping identify(\''.concat(e,'\', ').concat(JSON.stringify(t),') since another call is already in progress. Make sure you do not call \'identify\' multiple times consecutively.'));const i=this._update(e,t);return this._pendingIdentityUpdates.set(e,i),i}async _update(e,t){this.createOrExtendUserId(e),'string'==typeof t?(this._userSsoTokens.set(e,t),Ae.setUserSsoToken(e,t)):(t.id&&(this._userIds.set(e,t.id),Ae.setUserId(e,t.id)),this._userTraits.set(e,t),Ae.setUserTraits(e,t),Ae.deleteUserSsoToken(e),this._userSsoTokens.delete(e)),await this.remoteIdentityUpdate(e),this._pendingIdentityUpdates.delete(e)}async _isCrossDeviceSynchronizationEnabled(e){var t,i;const n=await this._dataRepository.getProjectData(e);if(!n)return l.warn('Skipping cross-device synchronization due to invalid project ID'),!1;const r=null==n||null===(t=n.features)||void 0===t?void 0:t.crossDeviceSynchronization;return!1===r?(l.warn('Skipping cross-device synchronization because it is disabled at project level'),!1):ce.find(null!==(i=null==n?void 0:n.planId)&&void 0!==i?i:ce.FREE.id).includes(V.CROSS_DEVICE_SYNCHRONIZATION)?!0!==r||this._userIds.get(e)||this._userSsoTokens.get(e)?!1!==this._preferences.crossDeviceSynchronization||(l.warn('Cross-device synchronization disabled at SDK preferences level'),!1):(l.warn('Skipping cross-device synchronization because no user ID or SSO token is defined'),!1):(l.warn('Skipping cross-device synchronization. You need to upgrade to the '.concat(ce.include(V.CROSS_DEVICE_SYNCHRONIZATION)[0].title,' plan or higher to get this feature')),!1)}async _isIdentifyAvailable(e){var t;const i=await this._dataRepository.getProjectData(e);return i?!!ce.find(null!==(t=null==i?void 0:i.planId)&&void 0!==t?t:ce.FREE.id).includes(V.END_USER_IDENTIFICATION)||(l.warn('Skipping end-user identification. You need to upgrade to the '.concat(ce.include(V.END_USER_IDENTIFICATION)[0].title,' plan or higher to get this feature')),!1):(l.warn('Skipping identify due to invalid project ID'),!1)}async _remoteStateUpdate(e,i,n,r,o){if(await this._isCrossDeviceSynchronizationEnabled(e)){l.debug('Calling _remoteStateUpdate for project '.concat(e));try{const l={},u=(this._userIds.get(e),this._userSsoTokens.get(e)),d=this._userTraits.get(e);var a,s,c;if(u)l.s=u;else l.t={a:null!==(a=null==d?void 0:d.avatarUrl)&&void 0!==a?a:null==d?void 0:d.avatar,d:null!==(s=null==d?void 0:d.displayName)&&void 0!==s?s:null==d?void 0:d.name,e:null==d?void 0:d.email,f:null==d?void 0:d.firstName,i:null!==(c=null==d?void 0:d.id)&&void 0!==c?c:this._userIds.get(e),l:null==d?void 0:d.lastName};fetch('https://pipeline.noticeable.io/s',{method:'PUT',headers:{'content-type':'application/json'},body:JSON.stringify(t({lpr:i||null,lps:n||null,olpr:r,olps:o,p:e},l))})}catch(e){l.error('Error while calling identify endpoint',e)}}}}let Me=function(e){return e.WIDGET='widget',e}({});const Be='#noticeable-widget';function We(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Be;e||(l.warn('You specified an invalid selector ('.concat(e,'). Falling back to the default ').concat(i,' selector')),e=i);const n=(t||window.document).querySelectorAll(e);if(0===n.length)throw new Error('Could not find element matching selector: '+e);return 1===n.length||l.warn('Your selector match several elements on this page. The first one was picked'),n.item(0)}const xe=document.createElement('div');xe.id='noticeable-lightbox',xe.innerHTML='<figure><img src="" alt=""><figcaption></figcaption></figure>',xe.onclick=function(){xe.style.display='none',xe.remove(),je.remove()};const je=document.createElement('style');je.appendChild(document.createTextNode('\n#noticeable-lightbox {\n    align-items: center;\n    background: rgb(0, 0, 0);\n    cursor: zoom-out;\n    display: none;\n    flex-direction: column;\n    height: 100%;\n    inset: 0;\n    justify-content: center;\n    left: 0;\n    margin: 0;\n    overflow: auto;\n    padding: 0;\n    position: fixed;\n    right: 0;\n    top: 0;\n    width: 100%;\n    z-index: 2147483001;\n}\n\n#noticeable-lightbox figure {\n    display: block;\n    left: 50%;\n    margin: 0;\n    max-height: 100%;\n    max-width: 100%;\n    position: absolute;\n    top: 50%;\n    transform: translate(-50%, -50%);\n}\n\n#noticeable-lightbox figure img {\n    animation-duration: 0.6s;\n    animation-name: noticeable-zoom;\n    display: block;\n    margin: 0;\n    max-width: none;\n    padding: 48px 48px 0 48px;\n    transition: all 0.3s ease 0s;\n}\n\n#noticeable-lightbox figure figcaption {\n    box-sizing: border-box;\n    color: rgb(204, 204, 204);\n    display: none;\n    margin: 0;\n    padding: 24px 48px 48px 48px;\n    text-align: center;\n    width: 100%;\n}\n\n@keyframes noticeable-zoom {\n    from {\n        transform: scale(0.3)\n    }\n    to {\n        transform: scale(1)\n    }\n}'));class ke{constructor(){n(this,'_caption',void 0),n(this,'_container',void 0),n(this,'_content',void 0),n(this,'_image',void 0),n(this,'_opened',void 0),this._caption=document.createElement('figcaption'),this._caption.style.color='#ccc',this._caption.style.display='block',this._caption.style.marginTop='24px',this._caption.style.textAlign='center',this._content=document.createElement('figure'),this._content.style.display='block',this._content.style.margin='0',this._content.style.top='50%',this._content.style.maxHeight='100%',this._content.style.maxWidth='100%',this._content.style.left='50%',this._content.style.position='absolute',this._content.style.transform='translate(-50%, -50%)',this._image=document.createElement('img'),this._image.style.display='block',this._image.style.margin='0',this._image.style.padding='48px 48px 16px 48px',this._image.style.transition='0.3s',this._container=document.createElement('div'),this._container.id='noticeable-lightbox',this._content.appendChild(this._image),this._content.appendChild(this._caption),this._container.appendChild(this._content),this._container.style.alignItems='center',this._container.style.background='rgb(0, 0, 0)',this._container.style.bottom='0',this._container.style.cursor='zoom-out',this._container.style.display='flex',this._container.style.flexDirection='column',this._container.style.height='100%',this._container.style.justifyContent='center',this._container.style.left='0',this._container.style.margin='0',this._container.style.overflow='auto',this._container.style.padding='0',this._container.style.position='fixed',this._container.style.right='0',this._container.style.top='0',this._container.style.width='100%',this._container.style.zIndex='2147483001',this._container.addEventListener('click',(()=>this.close())),this._opened=!1}close(){this._container.remove(),this._opened=!1}open(e,t){this._opened&&this.close(),this._opened=!0,this._image.src=e,t&&(t=t.trim()).length>0?(this._caption.innerHTML=t,this._caption.style.display='block',this._image.alt=t):this._caption.style.display='none',document.body.appendChild(this._container)}}var Fe,Ve,He,Ke,Ye;!function(e){e.Call='call',e.Reply='reply',e.Syn='syn',e.SynAck='synAck',e.Ack='ack'}(Fe||(Fe={})),function(e){e.Fulfilled='fulfilled',e.Rejected='rejected'}(Ve||(Ve={})),function(e){e.ConnectionDestroyed='ConnectionDestroyed',e.ConnectionTimeout='ConnectionTimeout',e.NoIframeSrc='NoIframeSrc'}(He||(He={})),function(e){e.DataCloneError='DataCloneError'}(Ke||(Ke={})),function(e){e.Message='message'}(Ye||(Ye={}));const ze={'http:':'80','https:':'443'},Je=/^(https?:)?\/\/([^/:]+)?(:(\d+))?/,Ze=['file:','data:'];const Xe=({name:e,message:t,stack:i})=>({name:e,message:t,stack:i});let qe=0;var Qe=()=>++qe;const $e=e=>e?e.split('.'):[],et=(e,t,i)=>{const n=$e(t);return n.reduce(((e,t,r)=>(void 0===e[t]&&(e[t]={}),r===n.length-1&&(e[t]=i),e[t])),e),e},tt=(e,t)=>{const i={};return Object.keys(e).forEach((n=>{const r=e[n],o=((e,t)=>{const i=$e(t||'');return i.push(e),(e=>e.join('.'))(i)})(n,t);'object'==typeof r&&Object.assign(i,tt(r,o)),'function'==typeof r&&(i[o]=r)})),i};var it=(e,t,i,n,r)=>{const{localName:o,local:a,remote:s,originForSending:c,originForReceiving:l}=t;let u=!1;r(`${o}: Connecting call sender`);const d=e=>(...t)=>{let i;r(`${o}: Sending ${e}() call`);try{s.closed&&(i=!0)}catch(e){i=!0}if(i&&n(),u){const t=new Error(`Unable to send ${e}() call due to destroyed connection`);throw t.code=He.ConnectionDestroyed,t}return new Promise(((i,n)=>{const u=Qe(),d=t=>{if(t.source!==s||t.data.penpal!==Fe.Reply||t.data.id!==u)return;if('*'!==l&&t.origin!==l)return void r(`${o} received message from origin ${t.origin} which did not match expected origin ${l}`);const c=t.data;r(`${o}: Received ${e}() reply`),a.removeEventListener(Ye.Message,d);let _=c.returnValue;c.returnValueIsError&&(_=(e=>{const t=new Error;return Object.keys(e).forEach((i=>t[i]=e[i])),t})(_)),(c.resolution===Ve.Fulfilled?i:n)(_)};a.addEventListener(Ye.Message,d);const _={penpal:Fe.Call,id:u,methodName:e,args:t};s.postMessage(_,c)}))},_=i.reduce(((e,t)=>(e[t]=d(t),e)),{});return Object.assign(e,(e=>{const t={};for(const i in e)et(t,i,e[i]);return t})(_)),()=>{u=!0}},nt=(e,t,i,n,r)=>{const{destroy:o,onDestroy:a}=n;let s,c;const l={};return n=>{if('*'!==t&&n.origin!==t)return void r(`Parent: Handshake - Received ACK message from origin ${n.origin} which did not match expected origin ${t}`);r('Parent: Handshake - Received ACK');const u={localName:'Parent',local:window,remote:n.source,originForSending:i,originForReceiving:t};s&&s(),s=((e,t,i)=>{const{localName:n,local:r,remote:o,originForSending:a,originForReceiving:s}=e;let c=!1;const l=e=>{if(e.source!==o||e.data.penpal!==Fe.Call)return;if('*'!==s&&e.origin!==s)return void i(`${n} received message from origin ${e.origin} which did not match expected origin ${s}`);const r=e.data,{methodName:l,args:u,id:d}=r;i(`${n}: Received ${l}() call`);const _=e=>t=>{if(i(`${n}: Sending ${l}() reply`),c)return void i(`${n}: Unable to send ${l}() reply due to destroyed connection`);const r={penpal:Fe.Reply,id:d,resolution:e,returnValue:t};e===Ve.Rejected&&t instanceof Error&&(r.returnValue=Xe(t),r.returnValueIsError=!0);try{o.postMessage(r,a)}catch(e){if(e.name===Ke.DataCloneError){const t={penpal:Fe.Reply,id:d,resolution:Ve.Rejected,returnValue:Xe(e),returnValueIsError:!0};o.postMessage(t,a)}throw e}};new Promise((e=>e(t[l].apply(t,u)))).then(_(Ve.Fulfilled),_(Ve.Rejected))};return r.addEventListener(Ye.Message,l),()=>{c=!0,r.removeEventListener(Ye.Message,l)}})(u,e,r),a(s),c&&c.forEach((e=>{delete l[e]})),c=n.data.methodNames;const d=it(l,u,c,o,r);return a(d),l}};var rt=e=>{let{iframe:t,methods:i={},childOrigin:n,timeout:r,debug:o=!1}=e;const a=(e=>(...t)=>{e&&console.log('[Penpal]',...t)})(o),s=((e,t)=>{const i=[];let n=!1;return{destroy(r){n||(n=!0,t(`${e}: Destroying connection`),i.forEach((e=>{e(r)})))},onDestroy(e){n?e():i.push(e)}}})('Parent',a),{onDestroy:c,destroy:l}=s;n||((e=>{if(!e.src&&!e.srcdoc){const e=new Error('Iframe must have src or srcdoc property defined.');throw e.code=He.NoIframeSrc,e}})(t),n=(e=>{if(e&&Ze.find((t=>e.startsWith(t))))return'null';const t=document.location,i=Je.exec(e);let n,r,o;return i?(n=i[1]?i[1]:t.protocol,r=i[2],o=i[4]):(n=t.protocol,r=t.hostname,o=t.port),`${n}//${r}${o&&o!==ze[n]?`:${o}`:''}`})(t.src));const u='null'===n?'*':n,d=tt(i),_=((e,t,i,n)=>r=>{if(!r.source)return;if('*'!==i&&r.origin!==i)return void e(`Parent: Handshake - Received SYN message from origin ${r.origin} which did not match expected origin ${i}`);e('Parent: Handshake - Received SYN, responding with SYN-ACK');const o={penpal:Fe.SynAck,methodNames:Object.keys(t)};r.source.postMessage(o,n)})(a,d,n,u),h=nt(d,n,u,s,a),p=new Promise(((e,i)=>{const n=((e,t)=>{let i;return void 0!==e&&(i=window.setTimeout((()=>{const i=new Error(`Connection timed out after ${e}ms`);i.code=He.ConnectionTimeout,t(i)}),e)),()=>{clearTimeout(i)}})(r,l),o=i=>{if(i.source===t.contentWindow&&i.data)if(i.data.penpal!==Fe.Syn)if(i.data.penpal!==Fe.Ack);else{const t=h(i);t&&(n(),e(t))}else _(i)};window.addEventListener(Ye.Message,o),a('Parent: Awaiting handshake'),((e,t)=>{const{destroy:i,onDestroy:n}=t,r=setInterval((()=>{e.isConnected||(clearInterval(r),i())}),6e4);n((()=>{clearInterval(r)}))})(t,s),c((e=>{window.removeEventListener(Ye.Message,o),e&&i(e)}))}));return{promise:p,destroy(){l()}}};class ot{constructor(e,t,i){n(this,'_element',void 0),n(this,'_loading',void 0),n(this,'_mouseEnterListener',void 0),n(this,'_mouseLeaveListener',void 0),n(this,'_visible',void 0),this._element=e,this._element.classList.add('noticeable-view_hidden'),this._loading=!0,this._mouseEnterListener=t,this._mouseLeaveListener=i,this._visible=!1}async alreadyRendered(e){}get element(){return this._element}destroy(){this._mouseEnterListener&&this._element.removeEventListener('mouseenter',this._mouseEnterListener),this._mouseLeaveListener&&this._element.removeEventListener('mouseleave',this._mouseLeaveListener),this._destroy()}_destroy(){}async hide(){if(this._visible)return this._visible=!1,this._hide()}async _hide(){this._element.classList.add('noticeable-view_hidden'),this._element.style.opacity='0',this._element.style.visibility='hidden'}async refresh(){return this._refresh()}async render(e){const t=await this._render(e);return this._mouseEnterListener&&this._element.addEventListener('mouseenter',this._mouseEnterListener),this._mouseLeaveListener&&this._element.addEventListener('mouseleave',this._mouseLeaveListener),t}async show(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._visible||(this._visible=!0,this._show(e))}_show(){this._element.classList.remove('noticeable-view_hidden'),this._element.style.opacity='1',this._element.style.visibility='visible'}get visible(){return this._visible}}let at=class extends ot{constructor(e,t,i,r,o){super(t,r,o),n(this,'_clickListener',void 0),n(this,'_trigger',void 0),this._clickListener=i,this._element.classList.add('noticeable-trigger-view'),this._trigger=e}destroy(){this._element.removeEventListener('click',this._clickListener),super.destroy()}dispatchEvent(e,t){this._trigger.widget.eventRegistry.dispatchEvent(this._trigger.widget.id,e,t)}async refresh(){const e=await this._refresh();return this.dispatchEvent(a.WIDGET_TRIGGER_REFRESHED),e}async render(e){const t=await super.render(e);this._element.addEventListener('click',this._clickListener),this.dispatchEvent(a.WIDGET_TRIGGER_READY,t)}_onIdentityChange(e,t,i){}};class st extends at{constructor(e){super(e,ht('Noticeable Trigger',(e=>{this._visible&&(e.target.style.opacity='1',e.target.style.visibility='visible',this._loading=!1)})),(()=>this.dispatchEvent(a.WIDGET_TRIGGER_VIEW_CLICKED)),(()=>this.dispatchEvent(a.WIDGET_TRIGGER_VIEW_MOUSE_ENTERED)),(()=>this.dispatchEvent(a.WIDGET_TRIGGER_VIEW_MOUSE_LEFT))),n(this,'_childConnection',void 0),n(this,'_child',void 0)}connectToChild(){return rt({iframe:this._element,methods:{getWidgetId:()=>this._trigger.widget.id,getWindowLocationHref:()=>window.location.href,toggle:()=>this._trigger.widget.toggle()}})}async initializeChildConnection(){var e,t;return this._child=await(null===(e=this._childConnection)||void 0===e?void 0:e.promise),null===(t=this._child)||void 0===t?void 0:t.setSdkPreferences(this._trigger.widget.preferences)}get child(){return this._child}destroy(){this._childConnection&&(this._childConnection.destroy(),this._child=void 0,this._childConnection=void 0),this._destroy(),this._element.remove()}}let ct=class extends ot{constructor(e,t){super(t,(()=>this.dispatchEvent(a.WIDGET_WIDGET_VIEW_MOUSE_ENTERED)),(()=>this.dispatchEvent(a.WIDGET_WIDGET_VIEW_MOUSE_LEFT))),n(this,'_backdrop',void 0),n(this,'_backdropClickable',void 0),n(this,'_backdropElement',void 0),n(this,'_backdropClickListener',void 0),n(this,'_widget',void 0),n(this,'_zIndex',''),this._backdrop=!1,this._backdropClickable=!1,this._backdropClickListener=()=>this._backdropClickable?this._widget.close():null,this._backdropElement=document.createElement('div'),this._backdropElement.addEventListener('click',this._backdropClickListener),this._backdropElement.id='noticeable-backdrop',this._backdropElement.style.bottom='0',this._backdropElement.style.left='0',this._backdropElement.style.position='fixed',this._backdropElement.style.right='0',this._backdropElement.style.top='0',this._backdropElement.style.zIndex='2147482999',this._element.classList.add('noticeable-widget-view'),this._element.style.zIndex='-1',this._widget=e}dispatchEvent(e,t){this._widget.eventRegistry.dispatchEvent(this._widget.id,e,t)}get publicationFetchLimit(){return 9}get aggregationMethod(){return'nspms'}async refresh(){const e=await this._refresh();return this.dispatchEvent(a.WIDGET_REFRESHED,e),e}async render(e){const t=await super.render(e);this.dispatchEvent(a.WIDGET_READY,t)}destroy(){this._backdropElement.remove(),super.destroy()}async _hide(){this._backdrop&&this._backdropElement.remove(),await super._hide(),this._element.style.zIndex='-1'}async _show(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._backdrop&&document.body.prepend(this._backdropElement),await super._show(e),this._element.style.zIndex=this._zIndex,-1!=navigator.userAgent.indexOf('Safari')&&-1==navigator.userAgent.indexOf('Chrome'))return this.refresh()}};class lt extends ct{constructor(e){super(e,ht('Noticeable Widget',(e=>{this._visible&&(e.target.style.opacity='1',e.target.style.visibility='visible',this._loading=!1)}))),n(this,'_child',void 0),n(this,'_childConnection',void 0),n(this,'_childInitializationPromise',void 0),this._element.allowFullscreen=!0}connectToChild(e){return rt({iframe:this._element,methods:t({close:()=>this._widget.close(),dispatchEvent:(e,t)=>this.dispatchEvent(e,t),getWidgetId:()=>this._widget.id,getWindowLocationHref:()=>window.location.href,openUrl:function(e,t){window.open(e,t)}},null!=e?e:{})})}async initializeChildConnection(){var e;return this._childInitializationPromise=null===(e=this._childConnection)||void 0===e?void 0:e.promise.then((e=>{var t;return this._child=e,null===(t=this._child)||void 0===t?void 0:t.setSdkPreferences(this._widget.preferences)})),this._childInitializationPromise}async ensureChildConnectionInitialized(){return this._childInitializationPromise?this._childInitializationPromise:Promise.resolve()}get child(){return this._child}destroy(){this._childConnection&&(this._childConnection.destroy(),this._child=void 0,this._childConnection=void 0),super.destroy(),this._element.remove()}get iframe(){return this._element}async _hide(){var e;return await this.ensureChildConnectionInitialized(),null===(e=this._child)||void 0===e||e.onHide(),super._hide()}async _onIdentityChange(e,t,i){var n;return await this.ensureChildConnectionInitialized(),null===(n=this._child)||void 0===n?void 0:n.onIdentityChange(e,t,i)}async _show(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return await super._show(t),await this.ensureChildConnectionInitialized(),null===(e=this._child)||void 0===e?void 0:e.onShow(t)}}class ut extends lt{constructor(e){super(e),n(this,'_windowResizeListener',void 0),this._windowResizeListener=()=>this.refresh()}_destroy(){super._destroy(),window.removeEventListener('resize',this._windowResizeListener)}async _render(e){window.addEventListener('resize',this._windowResizeListener)}}class dt extends ut{connectToChild(e){return super.connectToChild(t({getLastPublicationRead:()=>this._widget.getLastPublicationRead(),setPublicationRead:e=>this._widget.setPublicationRead([e],{merge:!0}),setPublicationSeen:e=>this._widget.setPublicationSeen([e],{merge:!0})},null!=e?e:{}))}}class _t extends dt{constructor(e){super(e),n(this,'_lightbox',void 0),this._lightbox=new ke}connectToChild(e){return super.connectToChild({zoom:(e,t)=>this._lightbox.open(e,t)})}}function ht(e,t){const i=document.createElement('iframe');return i.allowtransparency='1',i.frameBorder='1',i.height='0',i.onload=t,i.scrolling='no',i.tabIndex=-1,i.style.border='0',i.style.opacity='0',i.style.overflow='hidden',i.style.userSelect='none',i.style.visibility='hidden',i.title=e,i.width='0',i}class pt extends ut{constructor(){super(...arguments),n(this,'_email',void 0)}connectToChild(e){return super.connectToChild(t({setHeight:e=>{const t=e+'px';this.iframe.height=t,this.iframe.style.height=t}},null!=e?e:{}))}async _render(e){var t;this._element.src='https://widgets.noticeable.io/email-preference-center/index.html',this._email=null==e?void 0:e.email;const i=await this._widget.getWidgetData();return We(null!==(t=null==e?void 0:e.selector)&&void 0!==t?t:i.widgetViewSettings.selector,null==e?void 0:e.root).appendChild(this._element),this.iframe.style.width='100%',await super._render(e),this._childConnection=this.connectToChild(),await this.initializeChildConnection(),await this._widget.open(),await this.refresh()}async _refresh(){var e,t;const i=this._widget.getEmailSubscription(this._widget.projectId,null!==(e=this._email)&&void 0!==e?e:''),n=this._widget.getProjectData(),r=this._widget.getWidgetData(),o=f(),a=await i,s=await n,c=await r;return null===(t=this._child)||void 0===t?void 0:t.refresh({emailSubscription:a,isMobile:o,projectData:s,widgetId:this._widget.id,widgetSettings:c.widgetViewSettings})}}class gt extends ut{connectToChild(e){return super.connectToChild(t({setHeight:e=>{const t=e+'px';this.iframe.height=t,this.iframe.style.height=t}},null!=e?e:{}))}async _render(e){var t;this._element.src='https://widgets.noticeable.io/email-subscription-form/index.html';const i=await this._widget.getWidgetData();return We(null!==(t=null==e?void 0:e.selector)&&void 0!==t?t:i.widgetViewSettings.selector,null==e?void 0:e.root).appendChild(this._element),this.iframe.style.width='100%',await super._render(e),this._childConnection=this.connectToChild(),await this.initializeChildConnection(),await this._widget.open(),await this.refresh()}async _refresh(){var e;const t=this._widget.getProjectData(),i=this._widget.getWidgetData(),n=f(),r=await t,o=await i;return null===(e=this._child)||void 0===e?void 0:e.refresh({isMobile:n,projectData:r,widgetId:this._widget.id,widgetSettings:o.widgetViewSettings})}}class mt extends _t{constructor(e){super(e)}_destroy(){this._widget.trigger.destroy(),super._destroy()}async render(e){return await this.handleFirstTimeLoading(),super.render(e)}async handleFirstTimeLoading(){if(0===this._widget.getLastPublicationSeen().size){const e=await this._widget.getWidgetData();if(e.widgetViewSettings.firstVisitUnreadUnseenCount>=0&&e.widgetViewSettings.firstVisitUnreadUnseenCount<e.widgetViewSettings.maxPublicationCount){const t=await this._widget.getPublicationData(),i=new ue;for(let n=t.length-1;n>=e.widgetViewSettings.firstVisitUnreadUnseenCount;n--){const e=t[n];i.add(e.id),e.publicationTimestamp}await this._widget.identity.setLastPublicationReadSeen(this._widget.projectId,new ue(i.toArray()),new ue(i.toArray()),!0,!0,!0)}}const e=await this._widget.getPublicationState();this._widget.eventRegistry.dispatchEvent(this._widget.id,a.WIDGET_PUBLICATION_UNREAD_COUNT_CHANGED,{value:e.unreadCount}),this._widget.eventRegistry.dispatchEvent(this._widget.id,a.WIDGET_PUBLICATION_UNSEEN_COUNT_CHANGED,{value:e.unseenCount})}async _render(e){const t=this._widget.trigger.render({root:null==e?void 0:e.root,selector:null==e?void 0:e.selector});this._element.src='https://widgets.noticeable.io/modal/index.html',this._element.style.boxShadow='rgba(0, 0, 0, 0.16) 0 5px 40px',this._element.style.position='fixed',this._zIndex='2147482999',document.body.appendChild(this._element),await super._render(e),this._childConnection=super.connectToChild(),await this.initializeChildConnection();const i=await this.refresh();return await t,i}async _refresh(){var e,t,i;const n=this._widget.getProjectData(),r=this._widget.getPublicationData(),o=this._widget.getWidgetData(),a=f(),s=await n,c=await r,l=await o;var u,d;(null===(e=this._child)||void 0===e||e.refresh({isMobile:a,projectData:s,publicationData:c,widgetId:this._widget.id,widgetSettings:l.widgetViewSettings}),this._backdrop=null!==(t=l.widgetViewSettings.backdrop)&&void 0!==t&&t,this._backdropClickable=null!==(i=l.widgetViewSettings.backdropClickable)&&void 0!==i&&i,this._backdrop)?(this._backdropElement.style.background=null!==(u=l.widgetViewSettings.backdropColor)&&void 0!==u?u:'#00000099',this._widget.opened&&!this._backdropElement.isConnected?document.body.prepend(this._backdropElement):!this._widget.opened&&this._backdropElement.isConnected&&this._backdropElement.remove()):this._backdropElement.isConnected&&this._backdropElement.remove();a?(this._element.style.borderRadius=v(0),this._element.style.bottom=v(0),this._element.style.height='100%',this._element.style.left=v(0),this._element.style.marginLeft=v(0),this._element.style.marginTop=v(0),this._element.style.maxWidth='unset',this._element.style.minWidth='unset',this._element.style.right=v(0),this._element.style.top=v(0),this._element.style.transform='none',this._element.style.width='100%'):(this._element.style.borderRadius=v(null!==(d=l.widgetViewSettings.borderRadius)&&void 0!==d?d:8),this._element.style.height=l.widgetViewSettings.height+'%',this._element.style.left='50%',this._element.style.marginLeft=-this._element.offsetWidth/2+'px',this._element.style.marginTop=-this._element.offsetHeight/2+'px',this._element.style.maxWidth='780px',this._element.style.minWidth='480px',this._element.style.top='50%',this._element.style.width=l.widgetViewSettings.width+'%');return{publications:c}}async _show(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=await this._widget.getPublicationData();return await super._show(e),await this.refresh(),this._widget.setPublicationSeen(t.map((e=>e.id)),{merge:!0})}}class ft extends dt{constructor(e){super(e),n(this,'_containerElement',void 0),n(this,'_hashChangeListener',void 0),n(this,'_optionsUrlSuffix',''),n(this,'_mustSkipHashChangeEvent',!1),n(this,'_spinnerElement',void 0),n(this,'_styleElement',void 0),this._hashChangeListener=async e=>{const t=this._widget.getProjectData(),i=this._widget.getWidgetData(),n=await t,r=await i;this._mustSkipHashChangeEvent?this._mustSkipHashChangeEvent=!1:this._element.src=this._computeIframeUrl(n,r)},this._containerElement=document.createElement('div'),this._containerElement.style.height='100%',this._containerElement.style.position='relative',this._containerElement.style.width='100%',this.iframe.style.height='100%',this.iframe.style.width='100%',this._spinnerElement=document.createElement('div'),this._spinnerElement.classList.add('noticeable-widget-spinner'),this._spinnerElement.style.animation='noticeable-spinner 1s linear infinite',this._spinnerElement.style.border='5px solid #e1e1e1',this._spinnerElement.style.borderRadius='50%',this._spinnerElement.style.borderTop='4px solid var(--accent-color, #666)',this._spinnerElement.style.boxSizing='content-box',this._spinnerElement.style.height='22px',this._spinnerElement.style.left='50%',this._spinnerElement.style.position='absolute',this._spinnerElement.style.top='50%',this._spinnerElement.style.transform='translate(-50%, -50%)',this._spinnerElement.style.width='22px',this._styleElement=document.createElement('style'),this._styleElement.innerHTML='@keyframes noticeable-spinner { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }'}get publicationFetchLimit(){return 0}static _computeOptionsUrlSuffix(e,t){let i='?embed=true';if(e.widgetViewSettings.header||(i+='&header=false'),e.widgetViewSettings.labelsPicker||(i+='&menu=false'),null!=t&&t.segments&&t.segments.length>0)for(const e of t.segments)i=i+'&segment='+e;return null!=t&&t.token&&(i=i+'&stoken='+t.token),i}async alreadyRendered(e){var t,i;const n=await this._widget.getWidgetData(),r=null!==(t=null==e?void 0:e.selector)&&void 0!==t?t:null===(i=n.widgetViewSettings)||void 0===i?void 0:i.selector;try{const t=We(r,null==e?void 0:e.root);if(!t)return;0===t.children.length&&t.appendChild(this._containerElement)}catch(e){}}_destroy(){this._containerElement.remove(),this._styleElement.remove(),this._hashChangeListener&&window.removeEventListener('hashchange',this._hashChangeListener)}async _render(e){var t,i,n;const r=this._widget.getProjectData(),o=await this._widget.getWidgetData(),a=null!==(t=null!==(i=null==e?void 0:e.selector)&&void 0!==i?i:null===(n=o.widgetViewSettings)||void 0===n?void 0:n.selector)&&void 0!==t?t:Be,s=We(a,null==e?void 0:e.root);if(!s)return void l.warn('Could not find matching selector: '+a);null!=e&&e.root?e.root.appendChild(this._styleElement):document.head.appendChild(this._styleElement),this._containerElement.appendChild(this._spinnerElement),this._containerElement.appendChild(this._element),s.appendChild(this._containerElement),this._optionsUrlSuffix=ft._computeOptionsUrlSuffix(o,e);const c=await r;return this.iframe.addEventListener('load',(e=>{this.iframe.style.opacity='1',this.iframe.style.visibility='visible',this._spinnerElement.style.display='none',this._visible=!0})),this.iframe.src=this._computeIframeUrl(c,o),this.iframe.style.background='transparent',this.iframe.style.border='0',this.iframe.style.opacity='0',this.iframe.style.visibility='hidden',this.iframe.style.width='100%',this._childConnection=super.connectToChild({openLighbox:(e,t,i)=>{!function(e,t,i){xe.isConnected||document.body.appendChild(xe),je.isConnected||document.head.insertBefore(je,document.head.firstChild);const n=xe.getElementsByTagName('figcaption')[0],r=xe.getElementsByTagName('img')[0];xe.style.display='flex',r.alt=t.trim().length>0?t:i.trim().length>0?i:'',r.src=e,r.style.transition='all 0.3s';const o=i.trim().length>0?i:t.trim().length>0?t:void 0;o&&(n.innerHTML=o,n.style.display='block')}(e,t,i)},setHeight:e=>{this.iframe.height=e+'px',this.iframe.style.height=e+'px'},setLocation:e=>{o.widgetViewSettings.hashRouting&&(e=e.substr(1))!==window.location.hash.substr(1)&&(window.location.hash=e,this._mustSkipHashChangeEvent=!0)},setPublicationRead:async e=>{await this._widget.setPublicationRead(e,{merge:!0}),window.noticeable.refresh()},setPublicationReadSeen:async e=>{const t=this._widget.setPublicationSeen(e,{merge:!0}),i=this._widget.setPublicationRead(e,{merge:!0});await t,await i,window.noticeable.refresh()},setPublicationSeen:async e=>{await this._widget.setPublicationSeen(e,{merge:!0}),window.noticeable.refresh()}}),await this.initializeChildConnection(),o.widgetViewSettings.hashRouting&&window.addEventListener('hashchange',this._hashChangeListener,!1),this.refresh()}async _refresh(){var e;return null===(e=this.iframe.contentDocument)||void 0===e||e.location.reload(),{}}_computeIframeUrl(e,t){let i='https://'+e.newspageDomain;if(t.widgetViewSettings.hashRouting){const e=window.location.hash.substr(1);i=i+'/'+(e.startsWith('/')?e.substr(1):e)}if(i+=this._optionsUrlSuffix,this._widget.renderOptions.queryParameters&&'object'==typeof this._widget.renderOptions.queryParameters)for(const[e,t]of Object.entries(this._widget.renderOptions.queryParameters))i=i+'&'+e+'='+t;return i}}var yt,vt,Et,It,wt,bt,Tt,St,Ot,Ct,At,Nt,Rt,Dt,Pt,Lt;!function(e){e[e.READ=2]='READ',e[e.WRITE=4]='WRITE',e[e.READ_WRITE=6]='READ_WRITE'}(yt||(yt={})),function(e){e.API='api',e.SCIM='scim',e.WIDGET='widget',e.ZAPIER='zapier'}(vt||(vt={})),function(e){e.IGNORE='ignore',e.OPTIONAL='optional',e.REQUIRED='required'}(Et||(Et={})),function(e){e.API='api',e.EMAIL='email',e.NEWSPAGE='newspage',e.WIDGET='widget',e.ZAPIER='zapier'}(It||(It={})),function(e){e.CLOUDFLARE_ERROR='cloudflare-error',e.CLOUDFLARE_PENDING='cloudflare-pending',e.INVALID_CNAME='invalid-cname',e.MISSING_CNAME='missing-cname',e.VERIFIED='verified'}(wt||(wt={})),function(e){e[e.EMAIL_SENDING_DISABLED=0]='EMAIL_SENDING_DISABLED',e[e.EMAIL_SENDING_SUSPENDED=1]='EMAIL_SENDING_SUSPENDED',e[e.ORGANIZATION_NOT_FOUND=2]='ORGANIZATION_NOT_FOUND',e[e.PAYMENT_REQUIRED=3]='PAYMENT_REQUIRED',e[e.PROJECT_NOT_FOUND=4]='PROJECT_NOT_FOUND',e[e.PUBLICATION_NOT_FOUND=5]='PUBLICATION_NOT_FOUND',e[e.STRIPE_USAGE_RECORDING_FAILED=6]='STRIPE_USAGE_RECORDING_FAILED',e[e.TEMPLATE_NOT_FOUND=7]='TEMPLATE_NOT_FOUND',e[e.UPGRADE_REQUIRED=8]='UPGRADE_REQUIRED'}(bt||(bt={})),function(e){e[e.CUSTOM=0]='CUSTOM',e[e.OPT_IN_CONFIRMATION=1]='OPT_IN_CONFIRMATION',e[e.PUBLICATION=2]='PUBLICATION'}(Tt||(Tt={})),function(e){e.QUERY_PARAMETER='query-parameter',e.REQUEST_HEADER='request-header'}(St||(St={})),function(e){e.COMMENTS_PRIVATE='c',e.COMMENTS_PUBLIC='cp',e.EMAIL_COMPLAINTS='ec',e.EMAIL_CTA_CLICKS='ecc',e.EMAIL_DELIVERIES='ed',e.EMAIL_FAILURES='ef',e.EMAIL_HARD_BOUNCES='ehb',e.EMAIL_LINK_CLICKS='elc',e.EMAIL_OPENINGS='eo',e.EMAIL_REJECTIONS='er',e.EMAIL_SENDS='es',e.EMAIL_SOFT_BOUNCES='esb',e.EMAIL_SUBSCRIPTIONS_ARCHIVED='esa',e.EMAIL_SUBSCRIPTIONS_CLEANED='esc',e.EMAIL_SUBSCRIPTIONS_NON_SUBSCRIBED='esns',e.EMAIL_SUBSCRIPTIONS_SUBSCRIBED='ess',e.EMAIL_SUBSCRIPTIONS_UNSUBSCRIBED='esu',e.EMAIL_UNIQUE_LINK_CLICKS='eulc',e.EMAIL_UNIQUE_OPENINGS='euo',e.EMAIL_UNSUBSCRIBES='eu',e.NEWSPAGE_CTA_CLICKS='ncc',e.NEWSPAGE_LINK_CLICKS='nlc',e.NEWSPAGE_VIEWS='nv',e.PUBLICATION_CREATIONS='pc',e.PUSH_SUBSCRIPTIONS='ps',e.PUSH_UNSUBSCRIPTIONS='pu',e.REACTIONS_BAD='rb',e.REACTIONS_GOOD='rg',e.REACTIONS_NEUTRAL='rn',e.WIDGET_CTA_CLICKS='wcc',e.WIDGET_LINK_CLICKS='wlc',e.WIDGET_OPENINGS='wo',e.WIDGET_VIEWS='wv'}(Ot||(Ot={})),function(e){e.COMMENTS='c',e.EMAIL_COMPLAINTS='ec',e.EMAIL_CTA_CLICKS='ecc',e.EMAIL_DELIVERIES='ed',e.EMAIL_FAILURES='ef',e.EMAIL_HARD_BOUNCES='ehb',e.EMAIL_LINK_CLICKS='elc',e.EMAIL_OPENINGS='eo',e.EMAIL_REJECTIONS='er',e.EMAIL_SENDS='es',e.EMAIL_SOFT_BOUNCES='esb',e.EMAIL_UNIQUE_LINK_CLICKS='eulc',e.EMAIL_UNIQUE_OPENINGS='euo',e.EMAIL_UNSUBSCRIBES='eu',e.NEWSPAGE_CTA_CLICKS='ncc',e.NEWSPAGE_LINK_CLICKS='nlc',e.NEWSPAGE_VIEWS='nv',e.REACTIONS_BAD='rb',e.REACTIONS_GOOD='rg',e.REACTIONS_NEUTRAL='rn',e.WIDGET_CTA_CLICKS='wcc',e.WIDGET_LINK_CLICKS='wlc',e.WIDGET_VIEWS='wv'}(Ct||(Ct={})),function(e){e.DAILY='d',e.HOURLY='h'}(At||(At={})),function(e){e.DAILY='d',e.HOURLY='h'}(Nt||(Nt={})),function(e){e.MESSAGE='message',e.REDIRECT='redirect'}(Rt||(Rt={})),function(e){e.PASSWORD='password',e.TOKEN='token'}(Dt||(Dt={})),function(e){e.NONE='none',e.ZOOM_IN_ROTATE='zoom-in-rotate'}(Pt||(Pt={})),function(e){e.NOTICEONE='noticeone'}(Lt||(Lt={}));class Ut{constructor(e,...t){this.id=e,this.organizations=t&&0!=t.length?new Set(t):null,this.phrases=g.load(p.NEWSPAGE,e)}static from(e){const t=Gt[e];return t?t instanceof Function?(Gt[e]=t(),Gt[e]):t:null}getId(){return this.id}getOrganizations(){return this.organizations}getPhrases(){return this.phrases}async getPhrase(e,t){return(await this.phrases).phrase(e,t)}isAccessibleFrom(e){return null===this.organizations||this.organizations.has(e)}}const Gt={[Lt.NOTICEONE]:()=>new Ut(Lt.NOTICEONE)};var Mt,Bt,Wt,xt,jt,kt,Ft,Vt,Ht,Kt,Yt,zt,Jt,Zt,Xt,qt,Qt,$t,ei,ti,ii,ni,ri,oi,ai,si,ci,li,ui,di,_i,hi,pi,gi,mi,fi,yi,vi;!function(e){e.EMAILS='emails'}(Mt||(Mt={})),function(e){e.OIDC='oidc',e.SAML='saml'}(Bt||(Bt={})),function(e){e.BLANK='b',e.JOIN_PROJECTS_AS_ADMIN='jpaa',e.JOIN_PROJECTS_AS_EDITOR='jpae',e.JOIN_PROJECTS_AS_VIEWER='jpav'}(Wt||(Wt={})),function(e){e.DISABLED='disabled',e.PRIVATE='private',e.PUBLIC='public'}(xt||(xt={})),function(e){e.ABSOLUTE='absolute',e.HIDDEN='hidden',e.RELATIVE='relative'}(jt||(jt={})),function(e){e.DOUBLE_OPT_IN='doi',e.SINGLE_OPT_IN='soi'}(kt||(kt={})),function(e){e.API='api',e.DASHBOARD='dashboard',e.NEWSPAGE='newspage',e.WIDGET='widget',e.ZAPIER='zapier'}(Ft||(Ft={})),function(e){e.HARD_BOUNCED='hard-bounced',e.NON_SUBSCRIBED='non-subscribed',e.SPAM_COMPLAINT='spam-complaint',e.SUBSCRIBED='subscribed',e.SUPPRESSED='suppressed',e.UNSUBSCRIBED='unsubscribed'}(Vt||(Vt={})),function(e){e[e.VIEWER=1]='VIEWER',e[e.EDITOR=2]='EDITOR',e[e.ADMIN=4]='ADMIN',e[e.OWNER=7]='OWNER'}(Ht||(Ht={})),function(e){e.PUBLICATION_CTA='publication+cta',e.PUBLICATION_LINK='publication+link',e.OTHER='other'}(Kt||(Kt={})),function(e){e.EMAIL='email',e.NEWSPAGE='newspage',e.WIDGET='widget'}(Yt||(Yt={})),function(e){e.NOTICEABLE='noticeable'}(zt||(zt={})),function(e){e.EMAIL_SUBSCRIPTION_CREATE='email_subscription.create',e.EMAIL_SUBSCRIPTION_DELETE='email_subscription.delete',e.EMAIL_SUBSCRIPTION_UPDATE='email_subscription.update',e.POST_COMMENT_CREATE='post.comment.create',e.POST_CREATE='post.create',e.POST_CREATE_UPDATE='post.create_update',e.POST_DELETE='post.delete',e.POST_UPDATE='post.update'}(Jt||(Jt={})),function(e){e.HTTP='http',e.ZAPIER='zapier'}(Zt||(Zt={})),function(e){e.BOUNCE='bounce',e.NONE='none',e.PULSE='pulse',e.SHAKE='shake'}(Xt||(Xt={})),function(e){e.NONE='none',e.UNREAD_COUNT='unread',e.UNSEEN_COUNT='unseen'}(qt||(qt={})),function(e){e.END='end',e.START='start'}(Qt||(Qt={})),function(e){e.DASHED='dashed',e.DOTTED='dotted',e.SOLID='solid'}($t||($t={})),function(e){e.NONE='none',e.RECAPTCHA='recaptcha',e.TURNSTILE='turnstile'}(ei||(ei={})),function(e){e.COMPANY_NAME='company-name',e.COMPANY_WEBSITE='company-website',e.DISPLAY_NAME='display-name',e.EMAIL_ADDRESS='email-address',e.FIRST_NAME='first-name',e.LABELS='labels',e.LAST_NAME='last-name'}(ti||(ti={})),function(e){e.ALERT='alert',e.BELL='bell',e.CHAT='chat',e.CUSTOM='custom',e.FLAME='flame',e.GIFT='gift',e.MEGAPHONE='megaphone'}(ii||(ii={})),function(e){e.BOTTOM_END='bottom-end',e.BOTTOM_START='bottom-start'}(ni||(ni={})),function(e){e.W100='100',e.W200='200',e.W300='300',e.W400='400',e.W500='500',e.W600='600',e.W700='700',e.W800='800',e.W900='900'}(ri||(ri={})),function(e){e.BUBBLES='bubbles',e.LINE_IN_MOTION='line-in-motion',e.NONE='none',e.SHAPES='shapes',e.WAVES='waves'}(oi||(oi={})),function(e){e.BELL='bell',e.CUSTOM='custom',e.FLAME='flame',e.GIFT='gift',e.MEGAPHONE='megaphone'}(ai||(ai={})),function(e){e.OPEN_CTA_URL='open-cta',e.OPEN_IN_NEWSPAGE='open-newspage',e.OPEN_IN_WIDGET='open-widget'}(si||(si={})),function(e){e.AUTO='auto',e.AUTO_END='auto-end',e.AUTO_START='auto-start',e.BOTTOM='bottom',e.BOTTOM_END='bottom-end',e.BOTTOM_START='bottom-start',e.LEFT='left',e.LEFT_END='left-end',e.LEFT_START='left-start',e.RIGHT='right',e.RIGHT_END='right-end',e.RIGHT_START='right-start',e.TOP='top',e.TOP_END='top-end',e.TOP_START='top-start'}(ci||(ci={})),function(e){e.NON_SEGMENTED_PLUS_MATCHING_SEGMENTS='nspms',e.MATCHING_SEGMENTS_ONLY='mso'}(li||(li={})),function(e){e.CTA='cta',e.CUSTOM='custom',e.NEWSPAGE_PUBLICATION='newspage-publication',e.NEWSPAGE='newspage'}(ui||(ui={})),function(e){e.CENTER='center',e.END='end',e.START='start'}(di||(di={})),function(e){e.BUTTON='button',e.LINK='link'}(_i||(_i={})),function(e){e.BANNER_CLICK='banner-click',e.CLOSE_BUTTON_CLICK='close-button-click',e.CTA_CLICK='cta-click'}(hi||(hi={})),function(e){e.BOTTOM='bottom',e.BOTTOM_STICKY='bottom-sticky',e.TOP='top',e.TOP_STICKY='top-sticky'}(pi||(pi={})),function(e){e.CUSTOM='custom',e.NEWSPAGE='newspage',e.NONE='none'}(gi||(gi={})),function(e){e.LINE_THROUGH='line-through',e.UNDERLINE='underline',e.UNSET='unset'}(mi||(mi={})),function(e){e.NEVER='never',e.WHEN_ALL_READ='when-all-read',e.WHEN_ALL_SEEN='when-all-seen'}(fi||(fi={})),function(e){e.BADGE='badge',e.CUSTOM='custom',e.FLOATING_BUTTON='floating-button',e.ICON='icon',e.NONE='none'}(yi||(yi={})),function(e){e.CARD='card',e.EMAIL_PREFERENCE_CENTER='email-preference-center',e.EMAIL_SUBSCRIPTION_FORM='email-subscription-form',e.FLOATING_CARD='floating-card',e.INLINE='inline',e.MODAL='modal',e.NEWSPAGE_EMBED='newspage-embed',e.POPUP='popup',e.REDIRECTION='redirection',e.SIDE_PANEL='side-panel',e.TOP_BANNER='top-banner'}(vi||(vi={}));const Ei={[vi.CARD]:void 0,[vi.EMAIL_PREFERENCE_CENTER]:V.EMAIL_PREFERENCE_CENTER_WIDGET,[vi.EMAIL_SUBSCRIPTION_FORM]:V.EMAIL_SUBSCRIPTION_FORM_WIDGET,[vi.FLOATING_CARD]:void 0,[vi.INLINE]:void 0,[vi.MODAL]:V.MODAL_WIDGET,[vi.NEWSPAGE_EMBED]:V.NEWSPAGE_EMBED_WIDGET,[vi.POPUP]:V.POPUP_WIDGET,[vi.REDIRECTION]:V.REDIRECTION_WIDGET,[vi.SIDE_PANEL]:void 0,[vi.TOP_BANNER]:V.TOP_BANNER_WIDGET};var Ii='top',wi='bottom',bi='right',Ti='left',Si='auto',Oi=[Ii,wi,bi,Ti],Ci='start',Ai='end',Ni='clippingParents',Ri='viewport',Di='popper',Pi='reference',Li=Oi.reduce((function(e,t){return e.concat([t+'-'+Ci,t+'-'+Ai])}),[]),Ui=[].concat(Oi,[Si]).reduce((function(e,t){return e.concat([t,t+'-'+Ci,t+'-'+Ai])}),[]),Gi=['beforeRead','read','afterRead','beforeMain','main','afterMain','beforeWrite','write','afterWrite'];function Mi(e){return e?(e.nodeName||'').toLowerCase():null}function Bi(e){if(null==e)return window;if('[object Window]'!==e.toString()){var t=e.ownerDocument;return t&&t.defaultView||window}return e}function Wi(e){return e instanceof Bi(e).Element||e instanceof Element}function xi(e){return e instanceof Bi(e).HTMLElement||e instanceof HTMLElement}function ji(e){return'undefined'!=typeof ShadowRoot&&(e instanceof Bi(e).ShadowRoot||e instanceof ShadowRoot)}var ki={name:'applyStyles',enabled:!0,phase:'write',fn:function(e){var t=e.state;Object.keys(t.elements).forEach((function(e){var i=t.styles[e]||{},n=t.attributes[e]||{},r=t.elements[e];xi(r)&&Mi(r)&&(Object.assign(r.style,i),Object.keys(n).forEach((function(e){var t=n[e];!1===t?r.removeAttribute(e):r.setAttribute(e,!0===t?'':t)})))}))},effect:function(e){var t=e.state,i={popper:{position:t.options.strategy,left:'0',top:'0',margin:'0'},arrow:{position:'absolute'},reference:{}};return Object.assign(t.elements.popper.style,i.popper),t.styles=i,t.elements.arrow&&Object.assign(t.elements.arrow.style,i.arrow),function(){Object.keys(t.elements).forEach((function(e){var n=t.elements[e],r=t.attributes[e]||{},o=Object.keys(t.styles.hasOwnProperty(e)?t.styles[e]:i[e]).reduce((function(e,t){return e[t]='',e}),{});xi(n)&&Mi(n)&&(Object.assign(n.style,o),Object.keys(r).forEach((function(e){n.removeAttribute(e)})))}))}},requires:['computeStyles']};function Fi(e){return e.split('-')[0]}var Vi=Math.max,Hi=Math.min,Ki=Math.round;function Yi(){var e=navigator.userAgentData;return null!=e&&e.brands&&Array.isArray(e.brands)?e.brands.map((function(e){return e.brand+'/'+e.version})).join(' '):navigator.userAgent}function zi(){return!/^((?!chrome|android).)*safari/i.test(Yi())}function Ji(e,t,i){void 0===t&&(t=!1),void 0===i&&(i=!1);var n=e.getBoundingClientRect(),r=1,o=1;t&&xi(e)&&(r=e.offsetWidth>0&&Ki(n.width)/e.offsetWidth||1,o=e.offsetHeight>0&&Ki(n.height)/e.offsetHeight||1);var a=(Wi(e)?Bi(e):window).visualViewport,s=!zi()&&i,c=(n.left+(s&&a?a.offsetLeft:0))/r,l=(n.top+(s&&a?a.offsetTop:0))/o,u=n.width/r,d=n.height/o;return{width:u,height:d,top:l,right:c+u,bottom:l+d,left:c,x:c,y:l}}function Zi(e){var t=Ji(e),i=e.offsetWidth,n=e.offsetHeight;return Math.abs(t.width-i)<=1&&(i=t.width),Math.abs(t.height-n)<=1&&(n=t.height),{x:e.offsetLeft,y:e.offsetTop,width:i,height:n}}function Xi(e,t){var i=t.getRootNode&&t.getRootNode();if(e.contains(t))return!0;if(i&&ji(i)){var n=t;do{if(n&&e.isSameNode(n))return!0;n=n.parentNode||n.host}while(n)}return!1}function qi(e){return Bi(e).getComputedStyle(e)}function Qi(e){return['table','td','th'].indexOf(Mi(e))>=0}function $i(e){return((Wi(e)?e.ownerDocument:e.document)||window.document).documentElement}function en(e){return'html'===Mi(e)?e:e.assignedSlot||e.parentNode||(ji(e)?e.host:null)||$i(e)}function tn(e){return xi(e)&&'fixed'!==qi(e).position?e.offsetParent:null}function nn(e){for(var t=Bi(e),i=tn(e);i&&Qi(i)&&'static'===qi(i).position;)i=tn(i);return i&&('html'===Mi(i)||'body'===Mi(i)&&'static'===qi(i).position)?t:i||function(e){var t=/firefox/i.test(Yi());if(/Trident/i.test(Yi())&&xi(e)&&'fixed'===qi(e).position)return null;var i=en(e);for(ji(i)&&(i=i.host);xi(i)&&['html','body'].indexOf(Mi(i))<0;){var n=qi(i);if('none'!==n.transform||'none'!==n.perspective||'paint'===n.contain||-1!==['transform','perspective'].indexOf(n.willChange)||t&&'filter'===n.willChange||t&&n.filter&&'none'!==n.filter)return i;i=i.parentNode}return null}(e)||t}function rn(e){return['top','bottom'].indexOf(e)>=0?'x':'y'}function on(e,t,i){return Vi(e,Hi(t,i))}function an(e){return Object.assign({},{top:0,right:0,bottom:0,left:0},e)}function sn(e,t){return t.reduce((function(t,i){return t[i]=e,t}),{})}var cn={name:'arrow',enabled:!0,phase:'main',fn:function(e){var t,i=e.state,n=e.name,r=e.options,o=i.elements.arrow,a=i.modifiersData.popperOffsets,s=Fi(i.placement),c=rn(s),l=[Ti,bi].indexOf(s)>=0?'height':'width';if(o&&a){var u=function(e,t){return an('number'!=typeof(e='function'==typeof e?e(Object.assign({},t.rects,{placement:t.placement})):e)?e:sn(e,Oi))}(r.padding,i),d=Zi(o),_='y'===c?Ii:Ti,h='y'===c?wi:bi,p=i.rects.reference[l]+i.rects.reference[c]-a[c]-i.rects.popper[l],g=a[c]-i.rects.reference[c],m=nn(o),f=m?'y'===c?m.clientHeight||0:m.clientWidth||0:0,y=p/2-g/2,v=u[_],E=f-d[l]-u[h],I=f/2-d[l]/2+y,w=on(v,I,E),b=c;i.modifiersData[n]=((t={})[b]=w,t.centerOffset=w-I,t)}},effect:function(e){var t=e.state,i=e.options.element,n=void 0===i?'[data-popper-arrow]':i;null!=n&&('string'!=typeof n||(n=t.elements.popper.querySelector(n)))&&Xi(t.elements.popper,n)&&(t.elements.arrow=n)},requires:['popperOffsets'],requiresIfExists:['preventOverflow']};function ln(e){return e.split('-')[1]}var un={top:'auto',right:'auto',bottom:'auto',left:'auto'};function dn(e){var t,i=e.popper,n=e.popperRect,r=e.placement,o=e.variation,a=e.offsets,s=e.position,c=e.gpuAcceleration,l=e.adaptive,u=e.roundOffsets,d=e.isFixed,_=a.x,h=void 0===_?0:_,p=a.y,g=void 0===p?0:p,m='function'==typeof u?u({x:h,y:g}):{x:h,y:g};h=m.x,g=m.y;var f=a.hasOwnProperty('x'),y=a.hasOwnProperty('y'),v=Ti,E=Ii,I=window;if(l){var w=nn(i),b='clientHeight',T='clientWidth';if(w===Bi(i)&&'static'!==qi(w=$i(i)).position&&'absolute'===s&&(b='scrollHeight',T='scrollWidth'),r===Ii||(r===Ti||r===bi)&&o===Ai)E=wi,g-=(d&&w===I&&I.visualViewport?I.visualViewport.height:w[b])-n.height,g*=c?1:-1;if(r===Ti||(r===Ii||r===wi)&&o===Ai)v=bi,h-=(d&&w===I&&I.visualViewport?I.visualViewport.width:w[T])-n.width,h*=c?1:-1}var S,O=Object.assign({position:s},l&&un),C=!0===u?function(e,t){var i=e.x,n=e.y,r=t.devicePixelRatio||1;return{x:Ki(i*r)/r||0,y:Ki(n*r)/r||0}}({x:h,y:g},Bi(i)):{x:h,y:g};return h=C.x,g=C.y,c?Object.assign({},O,((S={})[E]=y?'0':'',S[v]=f?'0':'',S.transform=(I.devicePixelRatio||1)<=1?'translate('+h+'px, '+g+'px)':'translate3d('+h+'px, '+g+'px, 0)',S)):Object.assign({},O,((t={})[E]=y?g+'px':'',t[v]=f?h+'px':'',t.transform='',t))}var _n={passive:!0};var hn={left:'right',right:'left',bottom:'top',top:'bottom'};function pn(e){return e.replace(/left|right|bottom|top/g,(function(e){return hn[e]}))}var gn={start:'end',end:'start'};function mn(e){return e.replace(/start|end/g,(function(e){return gn[e]}))}function fn(e){var t=Bi(e);return{scrollLeft:t.pageXOffset,scrollTop:t.pageYOffset}}function yn(e){return Ji($i(e)).left+fn(e).scrollLeft}function vn(e){var t=qi(e),i=t.overflow,n=t.overflowX,r=t.overflowY;return/auto|scroll|overlay|hidden/.test(i+r+n)}function En(e){return['html','body','#document'].indexOf(Mi(e))>=0?e.ownerDocument.body:xi(e)&&vn(e)?e:En(en(e))}function In(e,t){var i;void 0===t&&(t=[]);var n=En(e),r=n===(null==(i=e.ownerDocument)?void 0:i.body),o=Bi(n),a=r?[o].concat(o.visualViewport||[],vn(n)?n:[]):n,s=t.concat(a);return r?s:s.concat(In(en(a)))}function wn(e){return Object.assign({},e,{left:e.x,top:e.y,right:e.x+e.width,bottom:e.y+e.height})}function bn(e,t,i){return t===Ri?wn(function(e,t){var i=Bi(e),n=$i(e),r=i.visualViewport,o=n.clientWidth,a=n.clientHeight,s=0,c=0;if(r){o=r.width,a=r.height;var l=zi();(l||!l&&'fixed'===t)&&(s=r.offsetLeft,c=r.offsetTop)}return{width:o,height:a,x:s+yn(e),y:c}}(e,i)):Wi(t)?function(e,t){var i=Ji(e,!1,'fixed'===t);return i.top=i.top+e.clientTop,i.left=i.left+e.clientLeft,i.bottom=i.top+e.clientHeight,i.right=i.left+e.clientWidth,i.width=e.clientWidth,i.height=e.clientHeight,i.x=i.left,i.y=i.top,i}(t,i):wn(function(e){var t,i=$i(e),n=fn(e),r=null==(t=e.ownerDocument)?void 0:t.body,o=Vi(i.scrollWidth,i.clientWidth,r?r.scrollWidth:0,r?r.clientWidth:0),a=Vi(i.scrollHeight,i.clientHeight,r?r.scrollHeight:0,r?r.clientHeight:0),s=-n.scrollLeft+yn(e),c=-n.scrollTop;return'rtl'===qi(r||i).direction&&(s+=Vi(i.clientWidth,r?r.clientWidth:0)-o),{width:o,height:a,x:s,y:c}}($i(e)))}function Tn(e,t,i,n){var r='clippingParents'===t?function(e){var t=In(en(e)),i=['absolute','fixed'].indexOf(qi(e).position)>=0&&xi(e)?nn(e):e;return Wi(i)?t.filter((function(e){return Wi(e)&&Xi(e,i)&&'body'!==Mi(e)})):[]}(e):[].concat(t),o=[].concat(r,[i]),a=o[0],s=o.reduce((function(t,i){var r=bn(e,i,n);return t.top=Vi(r.top,t.top),t.right=Hi(r.right,t.right),t.bottom=Hi(r.bottom,t.bottom),t.left=Vi(r.left,t.left),t}),bn(e,a,n));return s.width=s.right-s.left,s.height=s.bottom-s.top,s.x=s.left,s.y=s.top,s}function Sn(e){var t,i=e.reference,n=e.element,r=e.placement,o=r?Fi(r):null,a=r?ln(r):null,s=i.x+i.width/2-n.width/2,c=i.y+i.height/2-n.height/2;switch(o){case Ii:t={x:s,y:i.y-n.height};break;case wi:t={x:s,y:i.y+i.height};break;case bi:t={x:i.x+i.width,y:c};break;case Ti:t={x:i.x-n.width,y:c};break;default:t={x:i.x,y:i.y}}var l=o?rn(o):null;if(null!=l){var u='y'===l?'height':'width';switch(a){case Ci:t[l]=t[l]-(i[u]/2-n[u]/2);break;case Ai:t[l]=t[l]+(i[u]/2-n[u]/2)}}return t}function On(e,t){void 0===t&&(t={});var i=t,n=i.placement,r=void 0===n?e.placement:n,o=i.strategy,a=void 0===o?e.strategy:o,s=i.boundary,c=void 0===s?Ni:s,l=i.rootBoundary,u=void 0===l?Ri:l,d=i.elementContext,_=void 0===d?Di:d,h=i.altBoundary,p=void 0!==h&&h,g=i.padding,m=void 0===g?0:g,f=an('number'!=typeof m?m:sn(m,Oi)),y=_===Di?Pi:Di,v=e.rects.popper,E=e.elements[p?y:_],I=Tn(Wi(E)?E:E.contextElement||$i(e.elements.popper),c,u,a),w=Ji(e.elements.reference),b=Sn({reference:w,element:v,strategy:'absolute',placement:r}),T=wn(Object.assign({},v,b)),S=_===Di?T:w,O={top:I.top-S.top+f.top,bottom:S.bottom-I.bottom+f.bottom,left:I.left-S.left+f.left,right:S.right-I.right+f.right},C=e.modifiersData.offset;if(_===Di&&C){var A=C[r];Object.keys(O).forEach((function(e){var t=[bi,wi].indexOf(e)>=0?1:-1,i=[Ii,wi].indexOf(e)>=0?'y':'x';O[e]+=A[i]*t}))}return O}function Cn(e,t){void 0===t&&(t={});var i=t,n=i.placement,r=i.boundary,o=i.rootBoundary,a=i.padding,s=i.flipVariations,c=i.allowedAutoPlacements,l=void 0===c?Ui:c,u=ln(n),d=u?s?Li:Li.filter((function(e){return ln(e)===u})):Oi,_=d.filter((function(e){return l.indexOf(e)>=0}));0===_.length&&(_=d);var h=_.reduce((function(t,i){return t[i]=On(e,{placement:i,boundary:r,rootBoundary:o,padding:a})[Fi(i)],t}),{});return Object.keys(h).sort((function(e,t){return h[e]-h[t]}))}var An={name:'flip',enabled:!0,phase:'main',fn:function(e){var t=e.state,i=e.options,n=e.name;if(!t.modifiersData[n]._skip){for(var r=i.mainAxis,o=void 0===r||r,a=i.altAxis,s=void 0===a||a,c=i.fallbackPlacements,l=i.padding,u=i.boundary,d=i.rootBoundary,_=i.altBoundary,h=i.flipVariations,p=void 0===h||h,g=i.allowedAutoPlacements,m=t.options.placement,f=Fi(m),y=c||(f===m||!p?[pn(m)]:function(e){if(Fi(e)===Si)return[];var t=pn(e);return[mn(e),t,mn(t)]}(m)),v=[m].concat(y).reduce((function(e,i){return e.concat(Fi(i)===Si?Cn(t,{placement:i,boundary:u,rootBoundary:d,padding:l,flipVariations:p,allowedAutoPlacements:g}):i)}),[]),E=t.rects.reference,I=t.rects.popper,w=new Map,b=!0,T=v[0],S=0;S<v.length;S++){var O=v[S],C=Fi(O),A=ln(O)===Ci,N=[Ii,wi].indexOf(C)>=0,R=N?'width':'height',D=On(t,{placement:O,boundary:u,rootBoundary:d,altBoundary:_,padding:l}),P=N?A?bi:Ti:A?wi:Ii;E[R]>I[R]&&(P=pn(P));var L=pn(P),U=[];if(o&&U.push(D[C]<=0),s&&U.push(D[P]<=0,D[L]<=0),U.every((function(e){return e}))){T=O,b=!1;break}w.set(O,U)}if(b)for(var G=function(e){var t=v.find((function(t){var i=w.get(t);if(i)return i.slice(0,e).every((function(e){return e}))}));if(t)return T=t,'break'},M=p?3:1;M>0;M--){if('break'===G(M))break}t.placement!==T&&(t.modifiersData[n]._skip=!0,t.placement=T,t.reset=!0)}},requiresIfExists:['offset'],data:{_skip:!1}};function Nn(e,t,i){return void 0===i&&(i={x:0,y:0}),{top:e.top-t.height-i.y,right:e.right-t.width+i.x,bottom:e.bottom-t.height+i.y,left:e.left-t.width-i.x}}function Rn(e){return[Ii,bi,wi,Ti].some((function(t){return e[t]>=0}))}var Dn={name:'offset',enabled:!0,phase:'main',requires:['popperOffsets'],fn:function(e){var t=e.state,i=e.options,n=e.name,r=i.offset,o=void 0===r?[0,0]:r,a=Ui.reduce((function(e,i){return e[i]=function(e,t,i){var n=Fi(e),r=[Ti,Ii].indexOf(n)>=0?-1:1,o='function'==typeof i?i(Object.assign({},t,{placement:e})):i,a=o[0],s=o[1];return a=a||0,s=(s||0)*r,[Ti,bi].indexOf(n)>=0?{x:s,y:a}:{x:a,y:s}}(i,t.rects,o),e}),{}),s=a[t.placement],c=s.x,l=s.y;null!=t.modifiersData.popperOffsets&&(t.modifiersData.popperOffsets.x+=c,t.modifiersData.popperOffsets.y+=l),t.modifiersData[n]=a}};var Pn={name:'preventOverflow',enabled:!0,phase:'main',fn:function(e){var t=e.state,i=e.options,n=e.name,r=i.mainAxis,o=void 0===r||r,a=i.altAxis,s=void 0!==a&&a,c=i.boundary,l=i.rootBoundary,u=i.altBoundary,d=i.padding,_=i.tether,h=void 0===_||_,p=i.tetherOffset,g=void 0===p?0:p,m=On(t,{boundary:c,rootBoundary:l,padding:d,altBoundary:u}),f=Fi(t.placement),y=ln(t.placement),v=!y,E=rn(f),I='x'===E?'y':'x',w=t.modifiersData.popperOffsets,b=t.rects.reference,T=t.rects.popper,S='function'==typeof g?g(Object.assign({},t.rects,{placement:t.placement})):g,O='number'==typeof S?{mainAxis:S,altAxis:S}:Object.assign({mainAxis:0,altAxis:0},S),C=t.modifiersData.offset?t.modifiersData.offset[t.placement]:null,A={x:0,y:0};if(w){if(o){var N,R='y'===E?Ii:Ti,D='y'===E?wi:bi,P='y'===E?'height':'width',L=w[E],U=L+m[R],G=L-m[D],M=h?-T[P]/2:0,B=y===Ci?b[P]:T[P],W=y===Ci?-T[P]:-b[P],x=t.elements.arrow,j=h&&x?Zi(x):{width:0,height:0},k=t.modifiersData['arrow#persistent']?t.modifiersData['arrow#persistent'].padding:{top:0,right:0,bottom:0,left:0},F=k[R],V=k[D],H=on(0,b[P],j[P]),K=v?b[P]/2-M-H-F-O.mainAxis:B-H-F-O.mainAxis,Y=v?-b[P]/2+M+H+V+O.mainAxis:W+H+V+O.mainAxis,z=t.elements.arrow&&nn(t.elements.arrow),J=z?'y'===E?z.clientTop||0:z.clientLeft||0:0,Z=null!=(N=null==C?void 0:C[E])?N:0,X=L+Y-Z,q=on(h?Hi(U,L+K-Z-J):U,L,h?Vi(G,X):G);w[E]=q,A[E]=q-L}if(s){var Q,$='x'===E?Ii:Ti,ee='x'===E?wi:bi,te=w[I],ie='y'===I?'height':'width',ne=te+m[$],re=te-m[ee],oe=-1!==[Ii,Ti].indexOf(f),ae=null!=(Q=null==C?void 0:C[I])?Q:0,se=oe?ne:te-b[ie]-T[ie]-ae+O.altAxis,ce=oe?te+b[ie]+T[ie]-ae-O.altAxis:re,le=h&&oe?function(e,t,i){var n=on(e,t,i);return n>i?i:n}(se,te,ce):on(h?se:ne,te,h?ce:re);w[I]=le,A[I]=le-te}t.modifiersData[n]=A}},requiresIfExists:['offset']};function Ln(e,t,i){void 0===i&&(i=!1);var n,r,o=xi(t),a=xi(t)&&function(e){var t=e.getBoundingClientRect(),i=Ki(t.width)/e.offsetWidth||1,n=Ki(t.height)/e.offsetHeight||1;return 1!==i||1!==n}(t),s=$i(t),c=Ji(e,a,i),l={scrollLeft:0,scrollTop:0},u={x:0,y:0};return(o||!o&&!i)&&(('body'!==Mi(t)||vn(s))&&(l=(n=t)!==Bi(n)&&xi(n)?{scrollLeft:(r=n).scrollLeft,scrollTop:r.scrollTop}:fn(n)),xi(t)?((u=Ji(t,!0)).x+=t.clientLeft,u.y+=t.clientTop):s&&(u.x=yn(s))),{x:c.left+l.scrollLeft-u.x,y:c.top+l.scrollTop-u.y,width:c.width,height:c.height}}function Un(e){var t=new Map,i=new Set,n=[];function r(e){i.add(e.name),[].concat(e.requires||[],e.requiresIfExists||[]).forEach((function(e){if(!i.has(e)){var n=t.get(e);n&&r(n)}})),n.push(e)}return e.forEach((function(e){t.set(e.name,e)})),e.forEach((function(e){i.has(e.name)||r(e)})),n}var Gn={placement:'bottom',modifiers:[],strategy:'absolute'};function Mn(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return!t.some((function(e){return!(e&&'function'==typeof e.getBoundingClientRect)}))}function Bn(e){void 0===e&&(e={});var t=e,i=t.defaultModifiers,n=void 0===i?[]:i,r=t.defaultOptions,o=void 0===r?Gn:r;return function(e,t,i){void 0===i&&(i=o);var r,a,s={placement:'bottom',orderedModifiers:[],options:Object.assign({},Gn,o),modifiersData:{},elements:{reference:e,popper:t},attributes:{},styles:{}},c=[],l=!1,u={state:s,setOptions:function(i){var r='function'==typeof i?i(s.options):i;d(),s.options=Object.assign({},o,s.options,r),s.scrollParents={reference:Wi(e)?In(e):e.contextElement?In(e.contextElement):[],popper:In(t)};var a,l,_=function(e){var t=Un(e);return Gi.reduce((function(e,i){return e.concat(t.filter((function(e){return e.phase===i})))}),[])}((a=[].concat(n,s.options.modifiers),l=a.reduce((function(e,t){var i=e[t.name];return e[t.name]=i?Object.assign({},i,t,{options:Object.assign({},i.options,t.options),data:Object.assign({},i.data,t.data)}):t,e}),{}),Object.keys(l).map((function(e){return l[e]}))));return s.orderedModifiers=_.filter((function(e){return e.enabled})),s.orderedModifiers.forEach((function(e){var t=e.name,i=e.options,n=void 0===i?{}:i,r=e.effect;if('function'==typeof r){var o=r({state:s,name:t,instance:u,options:n}),a=function(){};c.push(o||a)}})),u.update()},forceUpdate:function(){if(!l){var e=s.elements,t=e.reference,i=e.popper;if(Mn(t,i)){s.rects={reference:Ln(t,nn(i),'fixed'===s.options.strategy),popper:Zi(i)},s.reset=!1,s.placement=s.options.placement,s.orderedModifiers.forEach((function(e){return s.modifiersData[e.name]=Object.assign({},e.data)}));for(var n=0;n<s.orderedModifiers.length;n++)if(!0!==s.reset){var r=s.orderedModifiers[n],o=r.fn,a=r.options,c=void 0===a?{}:a,d=r.name;'function'==typeof o&&(s=o({state:s,options:c,name:d,instance:u})||s)}else s.reset=!1,n=-1}}},update:(r=function(){return new Promise((function(e){u.forceUpdate(),e(s)}))},function(){return a||(a=new Promise((function(e){Promise.resolve().then((function(){a=void 0,e(r())}))}))),a}),destroy:function(){d(),l=!0}};if(!Mn(e,t))return u;function d(){c.forEach((function(e){return e()})),c=[]}return u.setOptions(i).then((function(e){!l&&i.onFirstUpdate&&i.onFirstUpdate(e)})),u}}var Wn=Bn({defaultModifiers:[{name:'eventListeners',enabled:!0,phase:'write',fn:function(){},effect:function(e){var t=e.state,i=e.instance,n=e.options,r=n.scroll,o=void 0===r||r,a=n.resize,s=void 0===a||a,c=Bi(t.elements.popper),l=[].concat(t.scrollParents.reference,t.scrollParents.popper);return o&&l.forEach((function(e){e.addEventListener('scroll',i.update,_n)})),s&&c.addEventListener('resize',i.update,_n),function(){o&&l.forEach((function(e){e.removeEventListener('scroll',i.update,_n)})),s&&c.removeEventListener('resize',i.update,_n)}},data:{}},{name:'popperOffsets',enabled:!0,phase:'read',fn:function(e){var t=e.state,i=e.name;t.modifiersData[i]=Sn({reference:t.rects.reference,element:t.rects.popper,strategy:'absolute',placement:t.placement})},data:{}},{name:'computeStyles',enabled:!0,phase:'beforeWrite',fn:function(e){var t=e.state,i=e.options,n=i.gpuAcceleration,r=void 0===n||n,o=i.adaptive,a=void 0===o||o,s=i.roundOffsets,c=void 0===s||s,l={placement:Fi(t.placement),variation:ln(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:r,isFixed:'fixed'===t.options.strategy};null!=t.modifiersData.popperOffsets&&(t.styles.popper=Object.assign({},t.styles.popper,dn(Object.assign({},l,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:a,roundOffsets:c})))),null!=t.modifiersData.arrow&&(t.styles.arrow=Object.assign({},t.styles.arrow,dn(Object.assign({},l,{offsets:t.modifiersData.arrow,position:'absolute',adaptive:!1,roundOffsets:c})))),t.attributes.popper=Object.assign({},t.attributes.popper,{'data-popper-placement':t.placement})},data:{}},ki,Dn,An,Pn,cn,{name:'hide',enabled:!0,phase:'main',requiresIfExists:['preventOverflow'],fn:function(e){var t=e.state,i=e.name,n=t.rects.reference,r=t.rects.popper,o=t.modifiersData.preventOverflow,a=On(t,{elementContext:'reference'}),s=On(t,{altBoundary:!0}),c=Nn(a,n),l=Nn(s,r,o),u=Rn(c),d=Rn(l);t.modifiersData[i]={referenceClippingOffsets:c,popperEscapeOffsets:l,isReferenceHidden:u,hasPopperEscaped:d},t.attributes.popper=Object.assign({},t.attributes.popper,{'data-popper-reference-hidden':u,'data-popper-escaped':d})}}]});window.process={env:{NODE_ENV:'production'}};class xn extends _t{constructor(e){super(e),n(this,'_popper',void 0)}_destroy(){this._widget.trigger.destroy(),super._destroy()}async render(e){return await this.handleFirstTimeLoading(),super.render(e)}async handleFirstTimeLoading(){if(0===this._widget.getLastPublicationSeen().size){const e=await this._widget.getWidgetData();if(e.widgetViewSettings.firstVisitUnreadUnseenCount>=0&&e.widgetViewSettings.firstVisitUnreadUnseenCount<e.widgetViewSettings.maxPublicationCount){const t=await this._widget.getPublicationData(),i=new ue;for(let n=t.length-1;n>=e.widgetViewSettings.firstVisitUnreadUnseenCount;n--){const e=t[n];i.add(e.id),e.publicationTimestamp}await this._widget.identity.setLastPublicationReadSeen(this._widget.projectId,new ue(i.toArray()),new ue(i.toArray()),!0,!0,!0)}}const e=await this._widget.getPublicationState();this._widget.eventRegistry.dispatchEvent(this._widget.id,a.WIDGET_PUBLICATION_UNREAD_COUNT_CHANGED,{value:e.unreadCount}),this._widget.eventRegistry.dispatchEvent(this._widget.id,a.WIDGET_PUBLICATION_UNSEEN_COUNT_CHANGED,{value:e.unseenCount})}async _render(e){var t;const i=this._widget.trigger.render({root:null==e?void 0:e.root,selector:null==e?void 0:e.selector});this._element.src='https://widgets.noticeable.io/popup/index.html',this._element.style.boxShadow='rgba(0, 0, 0, 0.16) 0 5px 40px',this._element.style.position='fixed',this._zIndex='2147482999',document.body.appendChild(this._element),await super._render(e),this._childConnection=super.connectToChild(),await this.initializeChildConnection();const n=await this.refresh();return await i,null===(t=this._popper)||void 0===t||t.forceUpdate(),n}async _refresh(){var e,t,i,n,r,o;const a=this._widget.getProjectData(),s=this._widget.getPublicationData(),c=this._widget.getWidgetData(),l=f(),u=await a,d=await s,_=await c;null===(e=this._child)||void 0===e||e.refresh({isMobile:l,projectData:u,publicationData:d,widgetId:this._widget.id,widgetSettings:_.widgetViewSettings});const h=_.triggerView;var p;(this._backdrop=null!==(t=_.widgetViewSettings.backdrop)&&void 0!==t&&t,this._backdropClickable=null!==(i=_.widgetViewSettings.backdropClickable)&&void 0!==i&&i,this._backdrop)?(this._backdropElement.style.background=null!==(p=_.widgetViewSettings.backdropColor)&&void 0!==p?p:'#00000099',this._widget.opened&&!this._backdropElement.isConnected?document.body.prepend(this._backdropElement):!this._widget.opened&&this._backdropElement.isConnected&&this._backdropElement.remove()):this._backdropElement.isConnected&&this._backdropElement.remove();this._element.style.borderRadius=v(null!==(n=_.widgetViewSettings.borderRadius)&&void 0!==n?n:8),this._element.style.height=v(null!==(r=_.widgetViewSettings.height)&&void 0!==r?r:520),this._element.style.width=v(null!==(o=_.widgetViewSettings.width)&&void 0!==o?o:420);const g=null==_?void 0:_.triggerViewSettings;let m=null==g?void 0:g.placement;if(g&&y(u.language)&&(m=g.placement===ni.BOTTOM_END?ni.BOTTOM_START:ni.BOTTOM_END),l)this._popper&&(this._popper.destroy(),this._popper=void 0),this._element.style.width='100%',this._element.style.borderRadius=v(0),this._element.style.bottom=v(0),this._element.style.height='100%',this._element.style.left=v(0),this._element.style.position='fixed',this._element.style.right=v(0),this._element.style.top=v(0),this._element.style.transform='none';else if(yi.BADGE===h||yi.CUSTOM===h||yi.ICON===h){let e=this._widget.trigger.view.element;yi.BADGE===h&&(e=this._widget.trigger.view.container);const t={modifiers:[{name:'offset',options:{offset:()=>[_.widgetViewSettings.horizontalOffset,_.widgetViewSettings.verticalOffset]}}],placement:_.widgetViewSettings.placement};this._popper?await this._popper.setOptions(t):this._popper=Wn(e,this._element,t)}else if(yi.FLOATING_BUTTON===h){var E,I;this._element.style.bottom=v(82+_.widgetViewSettings.verticalOffset),this._element.style.left=m===ni.BOTTOM_END?'unset':v(null!==(E=(null==g?void 0:g.horizontalOffset)+_.widgetViewSettings.horizontalOffset)&&void 0!==E?E:20),this._element.style.overflow='hidden',this._element.style.right=m===ni.BOTTOM_START?'unset':v(null!==(I=(null==g?void 0:g.horizontalOffset)+_.widgetViewSettings.horizontalOffset)&&void 0!==I?I:20),this._element.style.top='unset'}return{publications:d}}async _show(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=await this._widget.getPublicationData();return await super._show(e),await this.refresh(),this._widget.setPublicationSeen(t.map((e=>e.id)),{merge:!0})}}class jn extends dt{constructor(e){super(e),n(this,'_displayAfterTimeout',void 0),this._element.style.display='none'}get publicationFetchLimit(){return 1}_destroy(){super._destroy(),this._displayAfterTimeout&&(clearTimeout(this._displayAfterTimeout),this._displayAfterTimeout=void 0)}async _hide(){return this._element.style.display='none',super._hide()}async _render(e){var t,i;this._element.height='0',this._element.src='https://widgets.noticeable.io/top-banner/index.html',this._element.width='100%';const n=await this._widget.getWidgetData();let r=null!==(t=null==e?void 0:e.selector)&&void 0!==t?t:null==n||null===(i=n.widgetViewSettings)||void 0===i?void 0:i.selector;r||(r='body');const o=We(r,null==e?void 0:e.root);if(o)return'bottom'===n.widgetViewSettings.position?(this._element.style.bottom='0',this._element.style.position='relative',this._element.style.top='unset',o.appendChild(this._element)):'bottom-sticky'===n.widgetViewSettings.position?(this._element.style.bottom='0',this._element.style.position='sticky',this._element.style.top='unset',this._element.style.zIndex='2147483646',o.appendChild(this._element)):'top'===n.widgetViewSettings.position?(this._element.style.bottom='unset',this._element.style.position='relative',this._element.style.top='0',o.insertBefore(this._element,o.firstChild)):(this._element.style.bottom='unset',this._element.style.position='sticky',this._element.style.top='0',this._element.style.zIndex='2147483646',o.insertBefore(this._element,o.firstChild)),await super._render(e),this._childConnection=super.connectToChild({closeAndMarkPublicationRead:e=>{this._widget.setPublicationRead([e],{merge:!0}),this._widget.close()},setHeight:e=>this._element.height=e?v(e):'0'}),await this.initializeChildConnection(),this.refresh()}async _refresh(){var e;const t=this._widget.getProjectData(),i=this._widget.getPublicationData(),n=this._widget.getWidgetData(),r=f(),o=await t,a=await i,s=await n;null===(e=this._child)||void 0===e||e.refresh({isMobile:r,projectData:o,publicationData:a,widgetId:this._widget.id,widgetSettings:s.widgetViewSettings});const c=s.widgetViewSettings.displayAfter;if(!a||a.length<=0)return void l.info('Widget '.concat(this._widget.id,' not opening because there are no publications to display'));const u=a[0].id;if(this._widget.getLastPublicationRead().has(u)||!s.widgetViewSettings.mobile&&f())await this._widget.close();else if(!this._widget.opened){if(c<=0)return this._widget.open();this._displayAfterTimeout=setTimeout((()=>this._widget.open()),c)}}async _show(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=await this._widget.getPublicationData();return this._element.style.display='block',await super._show(e),this._widget.setPublicationSeen([t[0].id],{merge:!0})}}class kn extends st{constructor(e){super(e),n(this,'_container',void 0),n(this,'_containerOldStyles',void 0),this._clickListener=()=>{this.dispatchEvent(a.WIDGET_TRIGGER_VIEW_CLICKED),this._trigger.widget.toggle()}}get container(){return this._container}_destroy(){this._container&&(this._containerOldStyles&&(this._container.style.cursor=this._containerOldStyles.cursor,this._container.style.display=this._containerOldStyles.display,this._container.style.paddingLeft=this._containerOldStyles.paddingLeft,this._container.style.paddingRight=this._containerOldStyles.paddingRight,this._container.style.position=this._containerOldStyles.position,this._container.style.userSelect=this._containerOldStyles.userSelect,this._containerOldStyles=void 0),this._container=void 0)}async _render(e){var t,i;const n=await this._trigger.getSettings(),r=null!==(t=null!==(i=e.selector)&&void 0!==i?i:n.selector)&&void 0!==t?t:Be;this._container=We(r,e.root),this._container.addEventListener('click',this._clickListener),this._container.classList.remove('noticeable-badge_visible'),this._containerOldStyles={cursor:this._container.style.cursor,display:this._container.style.display,paddingLeft:this._container.style.paddingLeft,paddingRight:this._container.style.paddingRight,position:this._container.style.position,userSelect:this._container.style.userSelect},this._container.style.cursor='pointer',this._container.style.display='inline-block',this._container.style.position='relative',this._container.style.userSelect='none',this._element.src='https://widgets.noticeable.io/triggers/badge/index.html',this._element.height='0',this._element.width='0','start'===n.placement?this._container.prepend(this._element):this._container.appendChild(this._element),this._childConnection=super.connectToChild(),await this.initializeChildConnection(),await this.refresh()}async _refresh(){var e,t,i,n;const r=this._trigger.widget.getProjectLanguage(),o=this._trigger.getPublicationState(),a=this._trigger.getSettings(),s=getComputedStyle(this._container),c=parseFloat(null!==(e=null===(t=s.fontSize)||void 0===t?void 0:t.replace('px',''))&&void 0!==e?e:16),l=Math.round(c+.25*c),u=await r,d=await a;let _=d.placement;y(u)&&(_=d.placement===Qt.START?Qt.END:Qt.START);const h=null!==(i=d.horizontalOffset)&&void 0!==i?i:0;this._element.style.bottom='0',this._element.style.margin='auto 0',this._element.style.position='absolute',this._element.style.top='0';const p=this._container;let g,m;switch(d.animation){case Xt.BOUNCE:g=Math.ceil(.2*l),m=2*(6+.2*(l+6)),this._element.height=l+m+'px',this._element.width=l+g+'px',_===Qt.END?(this._element.style.left='unset',this._element.style.right='0',p.style.paddingLeft=this._containerOldStyles.paddingLeft,p.style.paddingRight=h+l+g+this._containerOldStyles.paddingRight+'px'):_===Qt.START&&(this._element.style.left='0',this._element.style.right='unset',p.style.paddingLeft=h+l+g+this._containerOldStyles.paddingLeft+'px',p.style.paddingRight=this._containerOldStyles.paddingRight);break;case Xt.PULSE:g=Math.ceil(1.5*l),m=Math.ceil(1.5*l),this._element.height=l+m+'px',this._element.width=l+g+'px',_===Qt.END?(this._element.style.left='unset',this._element.style.right='0',p.style.paddingLeft=this._containerOldStyles.paddingLeft,p.style.paddingRight=h+l+g/2+this._containerOldStyles.paddingRight+'px'):_===Qt.START&&(this._element.style.left='0',this._element.style.right='unset',p.style.paddingLeft=h+l+g/2+this._containerOldStyles.paddingLeft+'px',p.style.paddingRight=this._containerOldStyles.paddingRight);break;case Xt.NONE:this._element.height=l+'px',this._element.width=l+'px',_===Qt.END?(this._element.style.left='unset',this._element.style.right='0',p.style.paddingLeft=this._containerOldStyles.paddingLeft,p.style.paddingRight=h+l+this._containerOldStyles.paddingRight+'px'):_===Qt.START&&(this._element.style.left='0',this._element.style.right='unset',p.style.paddingLeft=h+l+this._containerOldStyles.paddingLeft+'px',p.style.paddingRight=this._containerOldStyles.paddingRight);break;case Xt.SHAKE:this._element.height=l+'px',this._element.width=l+6+'px',_===Qt.END?(this._element.style.left='unset',this._element.style.right='0',p.style.paddingLeft=this._containerOldStyles.paddingLeft,p.style.paddingRight=h+l+6+this._containerOldStyles.paddingRight+'px'):_===Qt.START&&(this._element.style.left='0',this._element.style.right='unset',p.style.paddingLeft=h+l+6+this._containerOldStyles.paddingLeft+'px',p.style.paddingRight=this._containerOldStyles.paddingRight)}d.fontSize=c,d.size=l;const f=await o;if(d.hideBehavior===fi.WHEN_ALL_READ&&0===f.unreadCount||d.hideBehavior===fi.WHEN_ALL_SEEN&&0===f.unseenCount?await this.hide():await this.show(),this.setBadgeVisibilityClass(),await(null===(n=this._child)||void 0===n?void 0:n.refresh({projectLanguage:u,publicationState:f,triggerSettings:d})),f.openWidgets)return this._trigger.widget.open({widgetOpenedByPublicationId:f.mostRecentPublicationId})}setBadgeVisibilityClass(){var e;const t=null===(e=this._container)||void 0===e?void 0:e.classList;t&&(this._visible?(null==t||t.add('noticeable-badge_visible'),null==t||t.remove('noticeable-badge_hidden')):(null==t||t.add('noticeable-badge_hidden'),null==t||t.remove('noticeable-badge_visible')))}async _hide(){await super._hide(),this.setBadgeVisibilityClass()}async _show(){await super._show(),this.setBadgeVisibilityClass()}}class Fn extends at{constructor(e){super(e,document.createElement('div'),(()=>{this._trigger.eventRegistry.hasListener(this._trigger.widget.id,a.WIDGET_TRIGGER_VIEW_CLICKED)?this.dispatchEvent(a.WIDGET_TRIGGER_VIEW_CLICKED):this._trigger.widget.toggle()}),(()=>this.dispatchEvent(a.WIDGET_TRIGGER_VIEW_MOUSE_ENTERED)),(()=>this.dispatchEvent(a.WIDGET_TRIGGER_VIEW_MOUSE_LEFT)))}_destroy(){var e;null===(e=this._element)||void 0===e||e.removeEventListener('click',this._clickListener)}async _render(e){var t,i;const n=await this._trigger.getSettings(),r=null!==(t=null!==(i=e.selector)&&void 0!==i?i:n.selector)&&void 0!==t?t:Be;return this._element=We(r,e.root),this._element.addEventListener('click',this._clickListener),await this.refresh()}async _refresh(){const e=await this._trigger.getPublicationState();e.openWidgets&&await this._trigger.widget.open({widgetOpenedByPublicationId:e.mostRecentPublicationId})}}class Vn extends st{async _render(e){this._element.src='https://widgets.noticeable.io/triggers/floating-button/index.html',this._element.style.height='124px',this._element.style.position='fixed',this._element.style.width='124px',this._element.style.zIndex='2147483000',document.body.appendChild(this._element),this._childConnection=super.connectToChild(),await this.initializeChildConnection(),await this.refresh()}async _refresh(){var e,t,i;const n=this._trigger.widget.getProjectLanguage(),r=this._trigger.getSettings(),o=this._trigger.widget.getWidgetData();(await o).widgetViewSettings.mobile?this._element.style.zIndex='2147482999':this._element.style.zIndex='2147483000';const a=await n,s=await r;let c=null==s?void 0:s.placement;y(a)&&(c=(null==s?void 0:s.placement)===ni.BOTTOM_START?ni.BOTTOM_END:ni.BOTTOM_START),this._element.style.bottom=null!=s&&s.verticalOffset?v(-32+s.verticalOffset):v(-32),this._element.style.left=c===ni.BOTTOM_START?v(-32+(null!==(e=null==s?void 0:s.horizontalOffset)&&void 0!==e?e:20)):'unset',this._element.style.right=c===ni.BOTTOM_END?v(-32+(null!==(t=null==s?void 0:s.horizontalOffset)&&void 0!==t?t:20)):'unset';const l=await this._trigger.getPublicationState();s.hideBehavior===fi.WHEN_ALL_READ&&0===l.unreadCount||s.hideBehavior===fi.WHEN_ALL_SEEN&&0===l.unseenCount?await this.hide():await this.show(),await(null===(i=this._child)||void 0===i?void 0:i.refresh({projectLanguage:a,publicationState:l,triggerSettings:s})),l.openWidgets&&await this._trigger.widget.open({widgetOpenedByPublicationId:l.mostRecentPublicationId})}}var Hn='object'==typeof global&&global&&global.Object===Object&&global,Kn='object'==typeof self&&self&&self.Object===Object&&self,Yn=Hn||Kn||Function('return this')(),zn=Yn.Symbol,Jn=Object.prototype,Zn=Jn.hasOwnProperty,Xn=Jn.toString,qn=zn?zn.toStringTag:void 0;var Qn=Object.prototype.toString;var $n='[object Null]',er='[object Undefined]',tr=zn?zn.toStringTag:void 0;function ir(e){return null==e?void 0===e?er:$n:tr&&tr in Object(e)?function(e){var t=Zn.call(e,qn),i=e[qn];try{e[qn]=void 0;var n=!0}catch(e){}var r=Xn.call(e);return n&&(t?e[qn]=i:delete e[qn]),r}(e):function(e){return Qn.call(e)}(e)}function nr(e){return null!=e&&'object'==typeof e}var rr=Array.isArray;function or(e){var t=typeof e;return null!=e&&('object'==t||'function'==t)}function ar(e){return e}var sr='[object AsyncFunction]',cr='[object Function]',lr='[object GeneratorFunction]',ur='[object Proxy]';function dr(e){if(!or(e))return!1;var t=ir(e);return t==cr||t==lr||t==sr||t==ur}var _r,hr=Yn['__core-js_shared__'],pr=(_r=/[^.]+$/.exec(hr&&hr.keys&&hr.keys.IE_PROTO||''))?'Symbol(src)_1.'+_r:'';var gr=Function.prototype.toString;function mr(e){if(null!=e){try{return gr.call(e)}catch(e){}try{return e+''}catch(e){}}return''}var fr=/^\[object .+?Constructor\]$/,yr=Function.prototype,vr=Object.prototype,Er=yr.toString,Ir=vr.hasOwnProperty,wr=RegExp('^'+Er.call(Ir).replace(/[\\^$.*+?()[\]{}|]/g,'\\$&').replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,'$1.*?')+'$');function br(e){return!(!or(e)||(t=e,pr&&pr in t))&&(dr(e)?wr:fr).test(mr(e));var t}function Tr(e,t){var i=function(e,t){return null==e?void 0:e[t]}(e,t);return br(i)?i:void 0}var Sr=Tr(Yn,'WeakMap'),Or=Object.create,Cr=function(){function e(){}return function(t){if(!or(t))return{};if(Or)return Or(t);e.prototype=t;var i=new e;return e.prototype=void 0,i}}();function Ar(e,t){var i=-1,n=e.length;for(t||(t=Array(n));++i<n;)t[i]=e[i];return t}var Nr=Date.now;var Rr,Dr,Pr,Lr=function(){try{var e=Tr(Object,'defineProperty');return e({},'',{}),e}catch(e){}}(),Ur=Lr?function(e,t){return Lr(e,'toString',{configurable:!0,enumerable:!1,value:(i=t,function(){return i}),writable:!0});var i}:ar,Gr=(Rr=Ur,Dr=0,Pr=0,function(){var e=Nr(),t=16-(e-Pr);if(Pr=e,t>0){if(++Dr>=800)return arguments[0]}else Dr=0;return Rr.apply(void 0,arguments)});var Mr=9007199254740991,Br=/^(?:0|[1-9]\d*)$/;function Wr(e,t){var i=typeof e;return!!(t=null==t?Mr:t)&&('number'==i||'symbol'!=i&&Br.test(e))&&e>-1&&e%1==0&&e<t}function xr(e,t,i){'__proto__'==t&&Lr?Lr(e,t,{configurable:!0,enumerable:!0,value:i,writable:!0}):e[t]=i}function jr(e,t){return e===t||e!=e&&t!=t}var kr=Object.prototype.hasOwnProperty;function Fr(e,t,i){var n=e[t];kr.call(e,t)&&jr(n,i)&&(void 0!==i||t in e)||xr(e,t,i)}function Vr(e,t,i,n){var r=!i;i||(i={});for(var o=-1,a=t.length;++o<a;){var s=t[o],c=n?n(i[s],e[s],s,i,e):void 0;void 0===c&&(c=e[s]),r?xr(i,s,c):Fr(i,s,c)}return i}var Hr=Math.max;function Kr(e,t){return Gr(function(e,t,i){return t=Hr(void 0===t?e.length-1:t,0),function(){for(var n=arguments,r=-1,o=Hr(n.length-t,0),a=Array(o);++r<o;)a[r]=n[t+r];r=-1;for(var s=Array(t+1);++r<t;)s[r]=n[r];return s[t]=i(a),function(e,t,i){switch(i.length){case 0:return e.call(t);case 1:return e.call(t,i[0]);case 2:return e.call(t,i[0],i[1]);case 3:return e.call(t,i[0],i[1],i[2])}return e.apply(t,i)}(e,this,s)}}(e,t,ar),e+'')}var Yr=9007199254740991;function zr(e){return'number'==typeof e&&e>-1&&e%1==0&&e<=Yr}function Jr(e){return null!=e&&zr(e.length)&&!dr(e)}var Zr=Object.prototype;function Xr(e){var t=e&&e.constructor;return e===('function'==typeof t&&t.prototype||Zr)}function qr(e){return nr(e)&&'[object Arguments]'==ir(e)}var Qr=Object.prototype,$r=Qr.hasOwnProperty,eo=Qr.propertyIsEnumerable,to=qr(function(){return arguments}())?qr:function(e){return nr(e)&&$r.call(e,'callee')&&!eo.call(e,'callee')},io=to;var no='object'==typeof exports&&exports&&!exports.nodeType&&exports,ro=no&&'object'==typeof module&&module&&!module.nodeType&&module,oo=ro&&ro.exports===no?Yn.Buffer:void 0,ao=(oo?oo.isBuffer:void 0)||function(){return!1},so={};function co(e){return function(t){return e(t)}}so['[object Float32Array]']=so['[object Float64Array]']=so['[object Int8Array]']=so['[object Int16Array]']=so['[object Int32Array]']=so['[object Uint8Array]']=so['[object Uint8ClampedArray]']=so['[object Uint16Array]']=so['[object Uint32Array]']=!0,so['[object Arguments]']=so['[object Array]']=so['[object ArrayBuffer]']=so['[object Boolean]']=so['[object DataView]']=so['[object Date]']=so['[object Error]']=so['[object Function]']=so['[object Map]']=so['[object Number]']=so['[object Object]']=so['[object RegExp]']=so['[object Set]']=so['[object String]']=so['[object WeakMap]']=!1;var lo='object'==typeof exports&&exports&&!exports.nodeType&&exports,uo=lo&&'object'==typeof module&&module&&!module.nodeType&&module,_o=uo&&uo.exports===lo&&Hn.process,ho=function(){try{var e=uo&&uo.require&&uo.require('util').types;return e||_o&&_o.binding&&_o.binding('util')}catch(e){}}(),po=ho&&ho.isTypedArray,go=po?co(po):function(e){return nr(e)&&zr(e.length)&&!!so[ir(e)]},mo=Object.prototype.hasOwnProperty;function fo(e,t){var i=rr(e),n=!i&&io(e),r=!i&&!n&&ao(e),o=!i&&!n&&!r&&go(e),a=i||n||r||o,s=a?function(e,t){for(var i=-1,n=Array(e);++i<e;)n[i]=t(i);return n}(e.length,String):[],c=s.length;for(var l in e)!t&&!mo.call(e,l)||a&&('length'==l||r&&('offset'==l||'parent'==l)||o&&('buffer'==l||'byteLength'==l||'byteOffset'==l)||Wr(l,c))||s.push(l);return s}function yo(e,t){return function(i){return e(t(i))}}var vo=yo(Object.keys,Object),Eo=Object.prototype.hasOwnProperty;function Io(e){return Jr(e)?fo(e):function(e){if(!Xr(e))return vo(e);var t=[];for(var i in Object(e))Eo.call(e,i)&&'constructor'!=i&&t.push(i);return t}(e)}var wo=Object.prototype.hasOwnProperty;function bo(e){if(!or(e))return function(e){var t=[];if(null!=e)for(var i in Object(e))t.push(i);return t}(e);var t=Xr(e),i=[];for(var n in e)('constructor'!=n||!t&&wo.call(e,n))&&i.push(n);return i}function To(e){return Jr(e)?fo(e,!0):bo(e)}var So=Tr(Object,'create');var Oo=Object.prototype.hasOwnProperty;var Co=Object.prototype.hasOwnProperty;function Ao(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var n=e[t];this.set(n[0],n[1])}}function No(e,t){for(var i=e.length;i--;)if(jr(e[i][0],t))return i;return-1}Ao.prototype.clear=function(){this.__data__=So?So(null):{},this.size=0},Ao.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Ao.prototype.get=function(e){var t=this.__data__;if(So){var i=t[e];return'__lodash_hash_undefined__'===i?void 0:i}return Oo.call(t,e)?t[e]:void 0},Ao.prototype.has=function(e){var t=this.__data__;return So?void 0!==t[e]:Co.call(t,e)},Ao.prototype.set=function(e,t){var i=this.__data__;return this.size+=this.has(e)?0:1,i[e]=So&&void 0===t?'__lodash_hash_undefined__':t,this};var Ro=Array.prototype.splice;function Do(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var n=e[t];this.set(n[0],n[1])}}Do.prototype.clear=function(){this.__data__=[],this.size=0},Do.prototype.delete=function(e){var t=this.__data__,i=No(t,e);return!(i<0)&&(i==t.length-1?t.pop():Ro.call(t,i,1),--this.size,!0)},Do.prototype.get=function(e){var t=this.__data__,i=No(t,e);return i<0?void 0:t[i][1]},Do.prototype.has=function(e){return No(this.__data__,e)>-1},Do.prototype.set=function(e,t){var i=this.__data__,n=No(i,e);return n<0?(++this.size,i.push([e,t])):i[n][1]=t,this};var Po=Tr(Yn,'Map');function Lo(e,t){var i,n,r=e.__data__;return('string'==(n=typeof(i=t))||'number'==n||'symbol'==n||'boolean'==n?'__proto__'!==i:null===i)?r['string'==typeof t?'string':'hash']:r.map}function Uo(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var n=e[t];this.set(n[0],n[1])}}function Go(e,t){for(var i=-1,n=t.length,r=e.length;++i<n;)e[r+i]=t[i];return e}Uo.prototype.clear=function(){this.size=0,this.__data__={hash:new Ao,map:new(Po||Do),string:new Ao}},Uo.prototype.delete=function(e){var t=Lo(this,e).delete(e);return this.size-=t?1:0,t},Uo.prototype.get=function(e){return Lo(this,e).get(e)},Uo.prototype.has=function(e){return Lo(this,e).has(e)},Uo.prototype.set=function(e,t){var i=Lo(this,e),n=i.size;return i.set(e,t),this.size+=i.size==n?0:1,this};var Mo=yo(Object.getPrototypeOf,Object),Bo='[object Object]',Wo=Function.prototype,xo=Object.prototype,jo=Wo.toString,ko=xo.hasOwnProperty,Fo=jo.call(Object);function Vo(e){var t=this.__data__=new Do(e);this.size=t.size}Vo.prototype.clear=function(){this.__data__=new Do,this.size=0},Vo.prototype.delete=function(e){var t=this.__data__,i=t.delete(e);return this.size=t.size,i},Vo.prototype.get=function(e){return this.__data__.get(e)},Vo.prototype.has=function(e){return this.__data__.has(e)},Vo.prototype.set=function(e,t){var i=this.__data__;if(i instanceof Do){var n=i.__data__;if(!Po||n.length<199)return n.push([e,t]),this.size=++i.size,this;i=this.__data__=new Uo(n)}return i.set(e,t),this.size=i.size,this};var Ho='object'==typeof exports&&exports&&!exports.nodeType&&exports,Ko=Ho&&'object'==typeof module&&module&&!module.nodeType&&module,Yo=Ko&&Ko.exports===Ho?Yn.Buffer:void 0,zo=Yo?Yo.allocUnsafe:void 0;function Jo(e,t){if(t)return e.slice();var i=e.length,n=zo?zo(i):new e.constructor(i);return e.copy(n),n}function Zo(){return[]}var Xo=Object.prototype.propertyIsEnumerable,qo=Object.getOwnPropertySymbols,Qo=qo?function(e){return null==e?[]:(e=Object(e),function(e,t){for(var i=-1,n=null==e?0:e.length,r=0,o=[];++i<n;){var a=e[i];t(a,i,e)&&(o[r++]=a)}return o}(qo(e),(function(t){return Xo.call(e,t)})))}:Zo;var $o=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)Go(t,Qo(e)),e=Mo(e);return t}:Zo;function ea(e,t,i){var n=t(e);return rr(e)?n:Go(n,i(e))}function ta(e){return ea(e,Io,Qo)}function ia(e){return ea(e,To,$o)}var na=Tr(Yn,'DataView'),ra=Tr(Yn,'Promise'),oa=Tr(Yn,'Set'),aa='[object Map]',sa='[object Promise]',ca='[object Set]',la='[object WeakMap]',ua='[object DataView]',da=mr(na),_a=mr(Po),ha=mr(ra),pa=mr(oa),ga=mr(Sr),ma=ir;(na&&ma(new na(new ArrayBuffer(1)))!=ua||Po&&ma(new Po)!=aa||ra&&ma(ra.resolve())!=sa||oa&&ma(new oa)!=ca||Sr&&ma(new Sr)!=la)&&(ma=function(e){var t=ir(e),i='[object Object]'==t?e.constructor:void 0,n=i?mr(i):'';if(n)switch(n){case da:return ua;case _a:return aa;case ha:return sa;case pa:return ca;case ga:return la}return t});var fa=ma,ya=Object.prototype.hasOwnProperty;var va=Yn.Uint8Array;function Ea(e){var t=new e.constructor(e.byteLength);return new va(t).set(new va(e)),t}var Ia=/\w*$/;var wa=zn?zn.prototype:void 0,ba=wa?wa.valueOf:void 0;function Ta(e,t){var i=t?Ea(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.length)}var Sa='[object Boolean]',Oa='[object Date]',Ca='[object Map]',Aa='[object Number]',Na='[object RegExp]',Ra='[object Set]',Da='[object String]',Pa='[object Symbol]',La='[object ArrayBuffer]',Ua='[object DataView]',Ga='[object Float32Array]',Ma='[object Float64Array]',Ba='[object Int8Array]',Wa='[object Int16Array]',xa='[object Int32Array]',ja='[object Uint8Array]',ka='[object Uint8ClampedArray]',Fa='[object Uint16Array]',Va='[object Uint32Array]';function Ha(e,t,i){var n,r,o,a=e.constructor;switch(t){case La:return Ea(e);case Sa:case Oa:return new a(+e);case Ua:return function(e,t){var i=t?Ea(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.byteLength)}(e,i);case Ga:case Ma:case Ba:case Wa:case xa:case ja:case ka:case Fa:case Va:return Ta(e,i);case Ca:return new a;case Aa:case Da:return new a(e);case Na:return(o=new(r=e).constructor(r.source,Ia.exec(r))).lastIndex=r.lastIndex,o;case Ra:return new a;case Pa:return n=e,ba?Object(ba.call(n)):{}}}function Ka(e){return'function'!=typeof e.constructor||Xr(e)?{}:Cr(Mo(e))}var Ya=ho&&ho.isMap,za=Ya?co(Ya):function(e){return nr(e)&&'[object Map]'==fa(e)};var Ja=ho&&ho.isSet,Za=Ja?co(Ja):function(e){return nr(e)&&'[object Set]'==fa(e)},Xa=1,qa=2,Qa=4,$a='[object Arguments]',es='[object Function]',ts='[object GeneratorFunction]',is='[object Object]',ns={};function rs(e,t,i,n,r,o){var a,s=t&Xa,c=t&qa,l=t&Qa;if(i&&(a=r?i(e,n,r,o):i(e)),void 0!==a)return a;if(!or(e))return e;var u=rr(e);if(u){if(a=function(e){var t=e.length,i=new e.constructor(t);return t&&'string'==typeof e[0]&&ya.call(e,'index')&&(i.index=e.index,i.input=e.input),i}(e),!s)return Ar(e,a)}else{var d=fa(e),_=d==es||d==ts;if(ao(e))return Jo(e,s);if(d==is||d==$a||_&&!r){if(a=c||_?{}:Ka(e),!s)return c?function(e,t){return Vr(e,$o(e),t)}(e,function(e,t){return e&&Vr(t,To(t),e)}(a,e)):function(e,t){return Vr(e,Qo(e),t)}(e,function(e,t){return e&&Vr(t,Io(t),e)}(a,e))}else{if(!ns[d])return r?e:{};a=Ha(e,d,s)}}o||(o=new Vo);var h=o.get(e);if(h)return h;o.set(e,a),Za(e)?e.forEach((function(n){a.add(rs(n,t,i,n,e,o))})):za(e)&&e.forEach((function(n,r){a.set(r,rs(n,t,i,r,e,o))}));var p=u?void 0:(l?c?ia:ta:c?To:Io)(e);return function(e,t){for(var i=-1,n=null==e?0:e.length;++i<n&&!1!==t(e[i],i,e););}(p||e,(function(n,r){p&&(n=e[r=n]),Fr(a,r,rs(n,t,i,r,e,o))})),a}ns[$a]=ns['[object Array]']=ns['[object ArrayBuffer]']=ns['[object DataView]']=ns['[object Boolean]']=ns['[object Date]']=ns['[object Float32Array]']=ns['[object Float64Array]']=ns['[object Int8Array]']=ns['[object Int16Array]']=ns['[object Int32Array]']=ns['[object Map]']=ns['[object Number]']=ns[is]=ns['[object RegExp]']=ns['[object Set]']=ns['[object String]']=ns['[object Symbol]']=ns['[object Uint8Array]']=ns['[object Uint8ClampedArray]']=ns['[object Uint16Array]']=ns['[object Uint32Array]']=!0,ns['[object Error]']=ns[es]=ns['[object WeakMap]']=!1;var os,as=function(e,t,i){for(var n=-1,r=Object(e),o=i(e),a=o.length;a--;){var s=o[os?a:++n];if(!1===t(r[s],s,r))break}return e};function ss(e,t,i){(void 0!==i&&!jr(e[t],i)||void 0===i&&!(t in e))&&xr(e,t,i)}function cs(e,t){if(('constructor'!==t||'function'!=typeof e[t])&&'__proto__'!=t)return e[t]}function ls(e,t,i,n,r,o,a){var s=cs(e,i),c=cs(t,i),l=a.get(c);if(l)ss(e,i,l);else{var u,d=o?o(s,c,i+'',e,t,a):void 0,_=void 0===d;if(_){var h=rr(c),p=!h&&ao(c),g=!h&&!p&&go(c);d=c,h||p||g?rr(s)?d=s:nr(u=s)&&Jr(u)?d=Ar(s):p?(_=!1,d=Jo(c,!0)):g?(_=!1,d=Ta(c,!0)):d=[]:function(e){if(!nr(e)||ir(e)!=Bo)return!1;var t=Mo(e);if(null===t)return!0;var i=ko.call(t,'constructor')&&t.constructor;return'function'==typeof i&&i instanceof i&&jo.call(i)==Fo}(c)||io(c)?(d=s,io(s)?d=function(e){return Vr(e,To(e))}(s):or(s)&&!dr(s)||(d=Ka(c))):_=!1}_&&(a.set(c,d),r(d,c,n,o,a),a.delete(c)),ss(e,i,d)}}function us(e,t,i,n,r){e!==t&&as(t,(function(o,a){if(r||(r=new Vo),or(o))ls(e,t,a,i,us,n,r);else{var s=n?n(cs(e,a),o,a+'',e,t,r):void 0;void 0===s&&(s=o),ss(e,a,s)}}),To)}var ds,_s=(ds=function(e,t,i,n){us(e,t,i,n)},Kr((function(e,t){var i=-1,n=t.length,r=n>1?t[n-1]:void 0,o=n>2?t[2]:void 0;for(r=ds.length>3&&'function'==typeof r?(n--,r):void 0,o&&function(e,t,i){if(!or(i))return!1;var n=typeof t;return!!('number'==n?Jr(i)&&Wr(t,i.length):'string'==n&&t in i)&&jr(i[t],e)}(t[0],t[1],o)&&(r=n<3?void 0:r,n=1),e=Object(e);++i<n;){var a=t[i];a&&ds(e,a,i,r)}return e})));class hs extends st{constructor(e){super(e),n(this,'_container',void 0),n(this,'_containerOldStyles',void 0)}get container(){return this._container}_destroy(){this._container&&(this._containerOldStyles&&(this._container.style.position=this._containerOldStyles.position,this._containerOldStyles=void 0),this._container=void 0)}async _render(e){var t,i;const n=await this._trigger.getSettings(),r=null!==(t=null!==(i=e.selector)&&void 0!==i?i:n.selector)&&void 0!==t?t:Be;this._container=We(r,e.root),this._containerOldStyles={position:this._container.style.position},this._element.src='https://widgets.noticeable.io/triggers/icon/index.html',this._container.style.position='relative',this._container.appendChild(this._element),this._childConnection=super.connectToChild(),await this.initializeChildConnection(),await this.refresh()}async _refresh(){var e,t;const i=this._trigger.widget.getProjectLanguage(),n=this._trigger.getPublicationState(),r=this._trigger.getSettings();let o,a=0,s=0,c=0;const l=rs(await r,5);const u=await i;let d=l.badge.placement;y(u)&&(d=l.badge.placement===Qt.START?Qt.END:Qt.START);const _=l.badge.horizontalOffset,h=l.badge.verticalOffset,p=l.badge.counter===qt.NONE?10:20;let g=0,m=0,f=0,E=0,I=0;switch(l.badge.animation){case Xt.BOUNCE:a=1,o=Math.ceil((1.2*p-p)/2),s=o,c=Math.ceil(1.2*p+6.001-p),g=hs.computeHeight(l.size,p,a,c,h),E=Math.max(0,h+c),I=hs.computeWidth(l.size,d,p,s,o,_);break;case Xt.PULSE:a=Math.ceil(1.5*(1.625*p-p)/2+2),o=a,s=a,c=a,g=hs.computeHeight(l.size,p,a,c,h),E=Math.max(0,h+c),I=hs.computeWidth(l.size,d,p,s,o,_);break;case Xt.NONE:a=0,o=0,s=0,c=0,g=hs.computeHeight(l.size,p,a,c,h),E=Math.max(0,h+c),I=hs.computeWidth(l.size,d,p,0,0,_);break;case Xt.SHAKE:a=0,o=3,s=2,c=0,g=hs.computeHeight(l.size,p,a,c,h),E=Math.max(0,h+c),I=hs.computeWidth(l.size,d,p,s,o,_)}const w=l.size-p+_-s;d===Qt.END?w<0?(m=-w,f=0):(m=0,f=_-s):d===Qt.START&&(w<0?(m=0,f=0):(m=_+s,f=0));const b=h-p-a,T=h+c;let S=0;T>0&&(S-=T),b<-l.size&&(S+=-l.size-b),null!==(e=this._element)&&void 0!==e&&null!==(e=e.parentElement)&&void 0!==e&&e.style&&(this._element.parentElement.style.marginTop='0px'),this._element.style.height=v(g),this._element.style.marginTop=v(S),this._element.style.width=v(I),this._element.style.zIndex='2147482942',l.marginLeft=m,l.marginRight=f,l.marginTop=E;const O=await n;l.hideBehavior===fi.WHEN_ALL_READ&&0===O.unreadCount||l.hideBehavior===fi.WHEN_ALL_SEEN&&0===O.unseenCount?await this.hide():await this.show(),await(null===(t=this._child)||void 0===t?void 0:t.refresh({projectLanguage:u,publicationState:O,triggerSettings:l})),O.openWidgets&&await this._trigger.widget.open({widgetOpenedByPublicationId:O.mostRecentPublicationId})}static computeHeight(e,t,i,n,r){const o=r-t-i,a=r+n,s=-e;return Math.max(a,0)-Math.min(o,s)}static computeWidth(e,t,i,n,r,o){let a=e-i+o+i+r,s=e-i+o-n;t===Qt.START&&(a=-o+i+r,s=-o-n);const c=e;return Math.max(a,c)-Math.min(s,0)}}class ps extends at{constructor(e){super(e,document.createElement('div'),(()=>{}),(()=>{}),(()=>{}))}async _render(e){return this.refresh()}async _refresh(){if(!(this._trigger.widget.view instanceof ft||this._trigger.widget.view instanceof jn)){const e=await this._trigger.getPublicationState();e.openWidgets&&await this._trigger.widget.open({widgetOpenedByPublicationId:e.mostRecentPublicationId})}return{}}}class gs{constructor(e,t){n(this,'_view',void 0),n(this,'_widget',void 0),this._view=this._createView(t.widgetView,t.triggerView),this._widget=e}async areAllPublicationRead(){return this._widget.areAllPublicationRead()}destroy(){this._view.destroy()}get eventRegistry(){return this._widget.eventRegistry}get view(){return this._view}get widget(){return this._widget}async getPublicationState(){return this._widget.getPublicationState()}async getSettings(){return(await this._widget.getWidgetData()).triggerViewSettings}hide(){this._view.hide()}async render(e){await this._view.render(e)}show(){this._view.show()}get visible(){return this._view.visible}_createView(e,t){if(e===vi.EMAIL_PREFERENCE_CENTER||e===vi.EMAIL_SUBSCRIPTION_FORM||e===vi.NEWSPAGE_EMBED||e===vi.TOP_BANNER)return new ps(this);switch(t){case'badge':return new kn(this);case'custom':return new Fn(this);case'floating-button':return new Vn(this);case'icon':return new hs(this);case'none':return new ps(this);default:throw new Error('Unknown trigger type: '.concat(t))}}}class ms{constructor(e,t,i,r,o,a){n(this,'_dataRepository',void 0),n(this,'_eventRegistry',void 0),n(this,'_id',void 0),n(this,'_identity',void 0),n(this,'_loading',void 0),n(this,'_opened',void 0),n(this,'_preferences',void 0),n(this,'_projectId',void 0),n(this,'_publicationFetchOptions',void 0),n(this,'_renderOptions',void 0),n(this,'_trigger',void 0),n(this,'_view',void 0),this._dataRepository=i,this._eventRegistry=r,this._id=e,this._identity=o,this._loading=!1,this._opened=!1,this._preferences=a,this._projectId=t.projectId,this._renderOptions={},this._trigger=new gs(this,t),this._view=this._createView(t.widgetView)}async alreadyRendered(e){return await this._trigger.view.alreadyRendered(e),this._view.alreadyRendered(e)}async areAllPublicationRead(){const e=await this.getPublicationData(),t=await this.getLastPublicationRead();return e.every((e=>t.has(e.id)))}async close(){this._opened&&(this._opened=!1,await this.hide(),this.eventRegistry.dispatchEvent(this.id,a.WIDGET_CLOSED))}destroy(){(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&this._eventRegistry.removeListeners(this._id),this._trigger.destroy(),this._view.destroy()}get eventRegistry(){return this._eventRegistry}get identity(){return this._identity}get opened(){return this._opened}get preferences(){return this._preferences}get view(){return this._view}get visible(){return this._trigger.visible&&this._view.visible}async getEmailSubscription(e,t){return this._dataRepository.getEmailSubscription(e,t)}async getProjectLanguage(){return(await this.getProjectData()).language}getLastPublicationRead(){return this._identity.getLastPublicationRead(this._projectId)}getLastPublicationSeen(){return this._identity.getLastPublicationSeen(this._projectId)}async getProjectData(){const e=await this._dataRepository.getProjectData(this._projectId);if(!e)throw new Error('Error while retrieving project data: '+this._projectId);return e.id=this._projectId,e}async getPublicationData(){const e=await this._dataRepository.getPublicationData(this._projectId,this._publicationFetchOptions);if(!e)throw new Error('Error while retrieving publication data for project '+this._projectId);return e}async getPublicationState(){var e,t,i,n,r;const o=this.getPublicationData(),a=this.getWidgetData(),s=this.getLastPublicationRead(),c=this.getLastPublicationSeen();let l=null,u=0,d=0;const _=await a,h=(null==_||null===(e=_.widgetViewSettings)||void 0===e?void 0:e.maxPublicationCount)||9,p=await o;let g=0;for(const e of p){var m;if(g>=h)break;(null==l||null!==(m=e.publicationTimestamp>l.publicationTimestamp)&&void 0!==m&&m)&&(l=e),s.has(e.id)||u++,c.has(e.id)||d++,g++}const f=null!==(t=null===(i=l)||void 0===i?void 0:i.openWidgets)&&void 0!==t&&t;return{lastPublicationRead:s,lastPublicationSeen:c,mostRecentPublicationId:null===(n=l)||void 0===n?void 0:n.id,openWidgets:f&&d>0,publicationIds:p.map((e=>e.id)),unreadCount:Math.min(u,h),unseenCount:c.has(null===(r=l)||void 0===r?void 0:r.id)?0:Math.min(d,h)}}async getTriggerSettings(){return(await this.getWidgetData()).triggerViewSettings}async getWidgetData(){const e=await this._dataRepository.getWidgetData(this._id);if(!e)throw new Error('Error while retrieving widget data: '+this._id);return e}async hide(){this._view.visible&&(await this._view.hide(),this.eventRegistry.dispatchEvent(this.id,a.WIDGET_HIDDEN))}get id(){return this._id}async open(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._opened||(this._opened=!0,await this.show(e),this.eventRegistry.dispatchEvent(this.id,a.WIDGET_OPENED))}get projectId(){return this._projectId}async toggle(){this._opened?await this.close():await this.open()}get trigger(){return this._trigger}async render(e){var t,i,n;const r=await this.getWidgetData();if(this._publicationFetchOptions={limit:this._view.publicationFetchLimit},null!=e&&e.labels)this._publicationFetchOptions.labels=e.labels;else if(null!==(t=r.widgetViewSettings)&&void 0!==t&&t.labels){var o;this._publicationFetchOptions.labels=null===(o=r.widgetViewSettings)||void 0===o?void 0:o.labels}null!=e&&e.segments?this._publicationFetchOptions.segments=e.segments:null!==(i=r.widgetViewSettings)&&void 0!==i&&i.segments&&(this._publicationFetchOptions.segments=r.widgetViewSettings.segments),this._publicationFetchOptions.segments?this._publicationFetchOptions.segments=[...this._publicationFetchOptions.segments,'Noticeable:Widgets:'.concat(this._id)]:this._publicationFetchOptions.segments=['Noticeable:Widgets:'.concat(this._id)],null!=e&&e.aggregation?this._publicationFetchOptions.aggregation=e.aggregation:null!==(n=r.widgetViewSettings)&&void 0!==n&&n.aggregation?this._publicationFetchOptions.aggregation=r.widgetViewSettings.aggregation:this._view.aggregationMethod&&(this._publicationFetchOptions.aggregation=this._view.aggregationMethod),this._renderOptions=e||{},await this._view.render(e)}async refresh(){if(this._opened){const e=await this.trigger.getPublicationState();e.unseenCount>0&&await this.setPublicationSeen(e.publicationIds,{merge:!0})}await Promise.allSettled([this.trigger.view.refresh(),this._view.refresh()])}get renderOptions(){return this._renderOptions}async reset(){return this.destroy(!1),this.render(this._renderOptions)}async setPublicationRead(e,t){const i=await this.getPublicationState(),n=this._identity.setLastPublicationRead(this._projectId,e,t),r=this.trigger.view.refresh();await Promise.allSettled([n,r]);const o=await this.getPublicationState();return i.unreadCount!==o.unreadCount&&this._eventRegistry.dispatchEvent(this.id,a.WIDGET_PUBLICATION_UNREAD_COUNT_CHANGED,{value:o.unreadCount}),n}async setPublicationSeen(e,t){const i=await this.getPublicationState(),n=this._identity.setLastPublicationSeen(this._projectId,e,t),r=this.trigger.view.refresh();await Promise.allSettled([n,r]);const o=await this.getPublicationState();return i.unseenCount!==o.unseenCount&&this._eventRegistry.dispatchEvent(this.id,a.WIDGET_PUBLICATION_UNSEEN_COUNT_CHANGED,{value:o.unseenCount}),n}async show(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._view.visible||(await this._view.show(e),this.eventRegistry.dispatchEvent(this.id,a.WIDGET_VISIBLE))}async updateTriggerViewSettings(e,t){const i=await this._dataRepository.getWidgetData(e);i&&(i.triggerViewSettings=_s(i.triggerViewSettings,t,((e,t)=>{if(rr(e)&&rr(t))return t})))}async updateWidgetViewSettings(e,t){const i=await this._dataRepository.getWidgetData(e);i&&(i.widgetViewSettings=_s(i.widgetViewSettings,t,((e,t)=>{if(rr(e)&&rr(t))return t})))}_createView(e){switch(e){case'email-preference-center':return new pt(this);case'email-subscription-form':return new gt(this);case'modal':return new mt(this);case'newspage-embed':return new ft(this);case'popup':return new xn(this);case'top-banner':return new jn(this);default:throw new Error('Unknown view type: '.concat(e))}}_updateViewsWithNewIdentity(){const e=this.identity.getUserId(this._projectId),t=this.identity.getUserSsoToken(this._projectId),i=this.identity.getUserTraits(this._projectId);this._trigger.view._onIdentityChange(e,t,i),this._view._onIdentityChange(e,t,i)}}class fs{constructor(){n(this,'version','3.2.1 (commit ef6a5a4)'),n(this,'_autoRefresher',void 0),n(this,'_dataRepository',void 0),n(this,'_eventRegistry',void 0),n(this,'_identity',void 0),n(this,'_preferences',void 0),n(this,'_renderedWidgets',void 0),n(this,'_widgets',void 0),k.setActive('production'),this._eventRegistry=new s,this._preferences={crossDeviceSynchronization:void 0,endpoints:{forms:'https://forms.noticeable.io',pipeline:'https://pipeline.noticeable.io',widgetsData:'https://data.widgets.noticeable.ipregistry.co'},firstPartyCookies:{localStorage:!0,retentionPeriod:31536e6}},this._renderedWidgets=new Set,this._widgets=new Map,this._autoRefresher=new d(this._widgets),this._dataRepository=new E(this._autoRefresher,this._preferences.endpoints),this._identity=new Ge(this._dataRepository,this._preferences)}static _checkCommandArity(e,t,i,n){void 0===n&&(n=i),(t.length<i||t.length>n)&&o('Invalid arity for command \''.concat(e,'\': expected between ').concat(i,' and ').concat(n,' arguments but received ').concat(t.length))}static _checkCommandParameterType(e,t,i,n){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0;const a=typeof t;i>=n||void 0!==r&&a!==r&&o('Invalid argument type at index '.concat(i,' for command \'').concat(e,'\': expected ').concat(r,' but received ').concat(a))}async initialize(e){if(/baidu|bing|bot|duckduckbot|exabot|facebook|google|ia_archiver|msn|qwant|teoma|slurp|sogou|yandex/i.test(navigator.userAgent))return void l.warn('Noticeable SDK initialization aborted because the request seems to come from a bot.');window.noticeable=this;const t=[];for(const i of e)'set'===i[0]&&'preferences'===i[1]?(i.shift(),await this._reifySetCommand(i)):t.push(i);this._identity.initialize();const i=[];let n;for(const e of t)'ready'===e[0]?(void 0!==n&&l.warn('Multiple \'ready\' callback registered. Only the last one before the SDK initialization will be used'),e.shift(),n=fs._reifyReadyCommand(e)):i.push(e);void 0!==n&&n();for(const e of i)await this._reifyCommand(e)}debug(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];fs._checkCommandParameterType('debug',e,0,1,'boolean'),l.setLevel(e?c.DEBUG:c.INFO),l.info('Debug mode '.concat(e?'enabled':'disabled'))}async destroy(e,t){fs._checkCommandParameterType('destroy',e,0,2,'string'),fs._checkCommandParameterType('destroy',t,1,2,'string'),l.debug('Calling destroy('.concat(e,', ').concat(t,')')),e!==Me.WIDGET?o('Unknown component: '.concat(e)):await this._destroyWidget(t)}do(e,t){var i,n,r,a,s,c;switch(fs._checkCommandParameterType('do',e,0,2,'string'),fs._checkCommandParameterType('do',t,1,2),Object.values(R).includes(e)||o('Unknown \'do\' action: '.concat(e)),l.debug('Calling do('.concat(e,', ').concat(JSON.stringify(t),')')),e){case R.IDENTITY_PUBLICATION_READ_INVALIDATE:return void this._identity.clearLastPublicationRead();case R.IDENTITY_PUBLICATION_SEEN_INVALIDATE:return void this._identity.clearLastPublicationSeen();case R.PROJECT_DATA_INVALIDATE:return void this._dataRepository.invalidateProjectData(t);case R.PUBLICATION_DATA_INVALIDATE:return void this._dataRepository.invalidatePublicationData(t);case R.WIDGET_DATA_INVALIDATE:return void this._dataRepository.invalidateWidgetData(t);case R.WIDGET_CLOSE:return void(null===(i=this._getWidget(t,'do',e))||void 0===i||i.close());case R.WIDGET_HIDE:return void(null===(n=this._getWidget(t,'do',e))||void 0===n||n.hide());case R.WIDGET_OPEN:return void(null===(r=this._getWidget(t,'do',e))||void 0===r||r.open());case R.WIDGET_REFRESH:return void(null===(a=this._getWidget(t,'do',e))||void 0===a||a.refresh());case R.WIDGET_SHOW:return void(null===(s=this._getWidget(t,'do',e))||void 0===s||s.show());case R.WIDGET_TOGGLE:return void(null===(c=this._getWidget(t,'do',e))||void 0===c||c.toggle())}l.warn('Unknown property for \'do\' action: '.concat(e))}help(){l.info('Visit the next page to learn more about the Noticeable JavaScript SDK:\nhttps://help.noticeable.io/en-us/article/how-to-use-noticeable-javascript-sdk-7k5kc2')}async get(e,t){var i,n,r,o;let a;switch(fs._checkCommandParameterType('is',e,0,2,'string'),fs._checkCommandParameterType('is',t,1,2,'string'),l.debug('Calling get('.concat(e,', ').concat(t,')')),e){case D.WIDGET_PUBLICATION_READ:return null===(i=this._getWidget(t,'get',e))||void 0===i?void 0:i.getLastPublicationRead();case D.WIDGET_PUBLICATION_SEEN:return null===(n=this._getWidget(t,'get',e))||void 0===n?void 0:n.getLastPublicationSeen();case D.WIDGET_PUBLICATION_UNREAD_COUNT:return a=await(null===(r=this._getWidget(t,'get',e))||void 0===r?void 0:r.getPublicationState()),a.unreadCount;case D.WIDGET_PUBLICATION_UNSEEN_COUNT:return a=await(null===(o=this._getWidget(t,'get',e))||void 0===o?void 0:o.getPublicationState()),a.unseenCount}return l.warn('Unknown get action: '.concat(e)),null}async identify(e,t){l.debug('Calling identity('.concat(e,', ').concat(JSON.stringify(t),')')),fs._checkCommandParameterType('identify',e,0,2,'string'),'string'==typeof t?fs._checkCommandParameterType('identify',t,1,2,'string'):fs._checkCommandParameterType('identify',t,1,2,'object'),await this._identity.update(e,t);for(const e of this._widgets.values())e._updateViewsWithNewIdentity()}is(e,t){var i,n,r,o,a,s,c,u;switch(fs._checkCommandParameterType('is',e,0,2,'string'),fs._checkCommandParameterType('is',t,1,2,'string'),l.debug('Calling is('.concat(e,', ').concat(t,')')),e){case P.WIDGET_CLOSED:return null!==(i=!(null!==(n=this._getWidget(t,'is',e))&&void 0!==n&&n.opened))&&void 0!==i&&i;case P.WIDGET_HIDDEN:return null!==(r=!(null!==(o=this._getWidget(t,'is',e))&&void 0!==o&&o.visible))&&void 0!==r&&r;case P.WIDGET_OPENED:return null!==(a=null===(s=this._getWidget(t,'is',e))||void 0===s?void 0:s.opened)&&void 0!==a&&a;case P.WIDGET_VISIBLE:return null!==(c=null===(u=this._getWidget(t,'is',e))||void 0===u?void 0:u.visible)&&void 0!==c&&c}return l.warn('Unknown property for is action: '.concat(e)),!1}off(e,t){if(e||t)return e&&t?(l.debug('Calling off('.concat(e,', ').concat(t,')')),void this._eventRegistry.removeListener(t,e)):e&&!t?(l.debug('Calling off('.concat(e,')')),void this._eventRegistry.removeListenersByEventType(e)):(l.debug('Calling off('.concat(e,', ').concat(t,')')),void this._eventRegistry.removeListeners(t));l.debug('Calling off()');for(let e of this._widgets.keys())this._eventRegistry.removeListeners(e)}on(e,t,i){fs._checkCommandParameterType('on',e,0,3,'string'),fs._checkCommandParameterType('on',t,1,3,'string'),fs._checkCommandParameterType('on',i,2,3,'function'),l.debug('Calling on('.concat(e,', ').concat(t,', callback)')),this._eventRegistry.setListener(e,t,i)}ready(e){fs._checkCommandParameterType('ready',e,0,1,'function'),l.warn('Skipping ready callback invoked after SDK initialization')}async render(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};fs._checkCommandParameterType('render',e,0,3,'string'),fs._checkCommandParameterType('render',t,1,3,'string'),fs._checkCommandParameterType('render',i,2,3,'object'),l.debug('Calling render(%s, %s, %o)',e,t,i),e!==Me.WIDGET?o('Unknown component: '.concat(e)):await this._renderWidget(t,i)}async refresh(){const e=[];for(let t of this._widgets)e.push(t[1].refresh());return Promise.all(e)}async reset(e){l.debug('Calling reset()'),this._identity.reset(e);const t=[];for(const[i,n]of this._widgets)e&&n.projectId!==e||t.push(n.reset());return Promise.all(t)}safe(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];fs._checkCommandParameterType('debug',e,0,1,'boolean'),l.debug('Calling safe('.concat(e,')')),l.setLevel(c.ERROR)}async set(e,t,i,n){var r,o,a,s,u,d,_,h;let p;switch(fs._checkCommandParameterType('set',t,1,4),l.debug('Calling set(%s, %s, %o)',e,t,i),e){case L.LOG_LEVEL:const I=t;'string'==typeof I&&['debug','info','warning','error'].includes(I)||l.error('Unknown log level: '+I+'. Must be debug, info, warning or error'),l.setLevel('error'===I?c.ERROR:'warning'===I?c.WARNING:'info'===I?c.INFO:c.DEBUG);break;case L.PREFERENCES:if('boolean'==typeof(null==t||null===(r=t.cacheControl)||void 0===r?void 0:r.projects)&&this._dataRepository.setProjectCacheControl(t.cacheControl.projects),'boolean'==typeof(null==t||null===(o=t.cacheControl)||void 0===o?void 0:o.publications)&&this._dataRepository.setPublicationCacheControl(t.cacheControl.publications),'boolean'==typeof(null==t||null===(a=t.cacheControl)||void 0===a?void 0:a.widgets)&&this._dataRepository.setWidgetCacheControl(t.cacheControl.widgets),'boolean'==typeof(null==t?void 0:t.crossDeviceSynchronization)&&(this._preferences.crossDeviceSynchronization=t.crossDeviceSynchronization),'string'==typeof(null==t||null===(s=t.endpoints)||void 0===s?void 0:s.forms)){this._preferences.endpoints.forms=t.endpoints.forms;for(let e of this._widgets.values()){var g,m;if(e.trigger.view instanceof st)null===(g=e.trigger.view)||void 0===g||null===(g=g.child)||void 0===g||g.setSdkPreferences(this._preferences);if(e.view instanceof lt)null===(m=e.view)||void 0===m||null===(m=m.child)||void 0===m||m.setSdkPreferences(this._preferences)}}if('string'==typeof(null==t||null===(u=t.endpoints)||void 0===u?void 0:u.pipeline)&&(this._preferences.endpoints.pipeline=t.endpoints.pipeline),'string'==typeof(null==t||null===(d=t.endpoints)||void 0===d?void 0:d.widgetsData)){this._preferences.endpoints.widgetsData=t.endpoints.widgetsData;for(let e of this._widgets.values()){var f,y;if(e.trigger.view instanceof st)null===(f=e.trigger.view)||void 0===f||null===(f=f.child)||void 0===f||f.setSdkPreferences(this._preferences);if(e.view instanceof lt)null===(y=e.view)||void 0===y||null===(y=y.child)||void 0===y||y.setSdkPreferences(this._preferences)}}return'boolean'==typeof(null==t||null===(_=t.firstPartyCookies)||void 0===_?void 0:_.localStorage)&&(this._preferences.firstPartyCookies.localStorage=t.firstPartyCookies.localStorage),void('number'==typeof(null==t||null===(h=t.firstPartyCookies)||void 0===h?void 0:h.retentionPeriod)&&(this._preferences.firstPartyCookies.retentionPeriod=t.firstPartyCookies.retentionPeriod));case L.WIDGET_PUBLICATION_READ:case L.WIDGET_PUBLICATION_SEEN:if('string'==typeof i&&(i=[i]),'string'!=typeof i&&!Array.isArray(i))return void l.error('Invalid value \''.concat(i,'\' set for action \'').concat(e,'\''));if(p=this._getWidget(t,'set',e),p){var v;if(e===L.WIDGET_PUBLICATION_READ)await p.setPublicationRead(i,{merge:null!==(v=null==n?void 0:n.merge)&&void 0!==v&&v});else if(e===L.WIDGET_PUBLICATION_SEEN){var E;await p.setPublicationSeen(i,{merge:null!==(E=null==n?void 0:n.merge)&&void 0!==E&&E})}return p.refresh()}return;case L.WIDGET_TRIGGER_VIEW_SETTINGS:return p=this._getWidget(t,'set',e),p?(await p.updateTriggerViewSettings(t,i),p.refresh()):void 0;case L.WIDGET_WIDGET_VIEW_SETTINGS:return p=this._getWidget(t,'set',e),p?(await p.updateWidgetViewSettings(t,i),p.refresh()):void 0}l.warn('Unknown set action \''.concat(e,'\''))}async _destroyWidget(e){const t=this._widgets.get(e);t?(await t.destroy(),this._widgets.delete(e),this._renderedWidgets.delete(e)):l.warn('Could not find widget '.concat(e,' for destruction'))}_getWidget(e,t,i){const n=this._widgets.get(e);if(n)return n;l.debug('Could not find widget '.concat(e,' for ').concat(t,' ').concat(i))}async _renderWidget(e,t){if(t.segments){Array.isArray(t.segments)||o('Incorrect segments value for widget \''.concat(e,'\': expected array, received ')+typeof t.segments);for(const i of t.segments)'string'!=typeof i&&o('Invalid segment value for widget \''.concat(e,'\': expected string, received ')+typeof i)}if(this._renderedWidgets.has(e)){var i;null===(i=this._widgets.get(e))||void 0===i||i.alreadyRendered(t)}else{this._renderedWidgets.add(e);const i=await this._dataRepository.getWidgetData(e);if(!i)return void this.abortWidgetRendering(e,'Skipping widget rendering due to missing widget data for ID '.concat(e,'. Are you sure your widget ID is correct?'),r.WIDGET_DATA_MISSING);if(!i.enabled)return void this.abortWidgetRendering(e,'Skipping rendering because widget '.concat(e,' is disabled'),r.WIDGET_DISABLED);if('boolean'==typeof i.widgetViewSettings.mobile&&!i.widgetViewSettings.mobile&&f())return void this.abortWidgetRendering(e,'Skipping rendering for widget '.concat(e,' because the current device is detected as a mobile and the widget is configured to not display on such devices'),r.WIDGET_DISABLED_MOBILE);const o=await this._dataRepository.getProjectData(i.projectId);if(!o)return void this.abortWidgetRendering(e,'Skipping rendering due to missing project data for widget '.concat(e),r.PROJECT_DATA_MISSING);const a=(n=i.widgetView,Ei[n]);if(!ce.find(o.planId).includes(a))return void this.abortWidgetRendering(e,'Skipping rendering for widget '.concat(e,' of type ').concat(i.widgetView,' because you need to upgrade to the ').concat(ce.include(a)[0].title,' plan or higher to get this widget working.'),r.PLAN_UPGRADE_REQUIRED);const s=new ms(e,i,this._dataRepository,this._eventRegistry,this._identity,this._preferences);this._widgets.set(e,s);const c=this._identity.getPendingIdentityUpdate(i.projectId);c?await c:this._identity.createOrExtendUserId(i.projectId),await s.render(t),s._updateViewsWithNewIdentity()}var n}abortWidgetRendering(e,t,i){l.warn(t),this._renderedWidgets.delete(e),this._eventRegistry.dispatchEvent(e,a.WIDGET_RENDERING_ABORTED,{reason:i})}async _reifyCommand(e){const t=e[0];switch(e.shift(),t){case'debug':this._reifyDebugCommand(e);break;case'destroy':this._reifyDestroyCommand(e);break;case'do':this._reifyDoCommand(e);break;case'help':this._reifyHelpCommand(e);break;case'identify':this._reifyIdentifyCommand(e);break;case'off':this._reifyOffCommand(e);break;case'on':this._reifyOnCommand(e);break;case'ready':fs._reifyReadyCommand(e);break;case'render':await this._reifyRenderCommand(e);break;case'reset':this._reifyResetCommand(e);break;case'safe':this._reifySafeCommand(e);break;case'set':this._reifySetCommand(e);break;default:l.error('Unknown command:',t)}}_reifyDebugCommand(e){fs._checkCommandArity('debug',e,0,1),0===e.length?this.debug():this.debug(e[0])}_reifyDestroyCommand(e){fs._checkCommandArity('destroy',e,2),this.destroy(e[0],e[1])}_reifyDoCommand(e){fs._checkCommandArity('do',e,2),this.do(e[0],e[1])}_reifyHelpCommand(e){fs._checkCommandArity('help',e,0),this.help()}_reifyIdentifyCommand(e){fs._checkCommandArity('identify',e,2),this.identify(e[0],e[1])}_reifyIsCommand(e){fs._checkCommandArity('is',e,2),this.is(e[0],e[1])}_reifyOffCommand(e){fs._checkCommandArity('off',e,0,2),0!==e.length?1!==e.length?this.off(e[0],e[1]):this.off(e[0]):this.off()}_reifyOnCommand(e){fs._checkCommandArity('on',e,3),this.on(e[0],e[1],e[2])}static _reifyReadyCommand(e){return fs._checkCommandArity('ready',e,1),e[0]}async _reifyRenderCommand(e){return fs._checkCommandArity('render',e,2,3),this.render(e[0],e[1],3===e.length?e[2]:void 0)}_reifyResetCommand(e){return fs._checkCommandArity('reset',e,0,1),0===e.length?this.reset():this.reset(e[0])}_reifySafeCommand(e){fs._checkCommandArity('safe',e,0,1),0===e.length?this.safe():this.safe(e[0])}_reifySetCommand(e){return fs._checkCommandArity('set',e,2,4),this.set(e[0],e[1],e[2],e[3])}}if(window.noticeable instanceof fs)console.error('Noticeable SDK included twice');else{const e=window.noticeable;(new fs).initialize(e)}}();
